(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1:function(e,t,n){"use strict";t.a={TYPE_ERR:0,TYPE_TEXT:1,TYPE_HTML:2,TYPE_JSON:3,TYPE_XML:4,TYPE_FEED:5,TYPE_FORM:6,TYPE_PDF_HTML:7,TYPE_DOC:8,TYPE_RULE:1,TYPE_RULE_GROUP:2,OP_AND:1,OP_OR:2,CONTENT_TYPE_TEXT:1,CONTENT_TYPE_CHANGED_TEXT:2,CONTENT_TYPE_OLD_TEXT:3,RULE_NOT_EMPTY:1,RULE_HAS_TEXT:2,RULE_HAS_TEXT_NOT:3,RULE_HAS_NUMBER_LT:4,RULE_HAS_NUMBER_GT:5,RULE_HAS_NUMBER_DECR_MIN:6,RULE_HAS_NUMBER_INCR_MIN:7,RULE_MATCH_REGEX:8,RULE_HAS_NUMBER_DECR_PERCENT_MIN:9,RULE_HAS_NUMBER_INCR_PERCENT_MIN:10,STATE_DEFAULT:0,STATE_NEW:10,STATE_INIT:20,STATE_UNAUTHORIZED:30,STATE_AUTHORIZED:35,STATE_READY:40,STATE_PAUSED:45,STATE_RESTRICTED:50,STATE_DISCARD:90,STATE_DEL:100,STATE_DONE:100,STATE_PLAN_PUBLIC:0,STATE_PLAN_PRIVATE:70,STATE_ATTR_VERIFY:10,STATE_ATTR_VERIFY_INIT:20,STATE_ATTR_VERIFY_WAIT:30,STATE_ATTR_VERIFY_DONE:40,ACTION_EMAIL:1,ACTION_SMS:2,ACTION_PUSH:3,ACTION_MACRO:4,ACTION_WEBHOOK:5,ACTION_SLACK:6,ACTION_DISCORD:7,ACTION_LOCAL_AUDIO:101,ACTION_LOCAL_POPUP:102,ACTION_LOCAL_OPEN_TAB:103,RUN_STATE_INIT:1,RUN_STATE_WAIT:2,RUN_STATE_WIP:3,LOCAL_STATE_SYNCED:0,LOCAL_STATE_POST:1,LOCAL_STATE_PUT:2,LOCAL_STATE_DEL:3,CLIENT_FF:10,CLIENT_CR:11,CLIENT_OP:12,CLIENT_FFWX:13,CLIENT_MAC:20,CLIENT_WEBFF:50,CLIENT_DEDI:51,IMPORT_SOURCE_SITEMAP:1,TIME_INFINITE:2592e3}},11:function(e,t,n){"use strict";var s=n(6),a=n(33);const i=window._;if(!i)throw new Error("ADD _");const r=window.Backbone;if(!r)throw new Error("ADD Backbone");function o(e,t,n){if(!s.a.api)return void s.a.on("init",(function(){o(e,t,n)}));const a=i.result(t,"url")||l();let r=n.data;null!=r||!t||"create"!==e&&"update"!==e&&"patch"!==e||(r=n.attrs||t.toJSON(n));const c=n.xhr=s.a.api(a,e,r,(function(e,t){e?n.error&&n.error(e):n.success&&n.success(t)}));return t.trigger("request",t,c,n),c}var l=function(){throw new Error('A "url" property or function must be specified')};const c=r.Model.prototype.fetch;r.Model.prototype.fetch=async function(e){return e||(e={}),new Promise((t,n)=>{c.call(this,{error:function(...t){e.error&&e.error(...t),n(t)},success:function(...n){e.success&&e.success(...n),t(n)}})})};const u=r.Model.extend({sync:o,encodedFields:[],clone:function(){const e=this.toJSON();return new this.constructor(e,{parse:!0})},parse:function(e){return i.each(this.encodedFields,(function(t){const n=e[t];if(i.isString(n)){let s=null;try{s=JSON.parse(n)}catch(e){console.error("Invalid model json attribute:",t,n,e)}e[t]=s}})),e},prop:function(e,t){if(this.props||(this.props={}),2!=arguments.length)return i.result(this.props,e);{const n=i.result(this.props,e);if(n===t)return;this.props[e]=t,this.trigger("prop:"+e,t,n),this.collection&&this.collection.trigger("prop:"+e,t,n,this)}},toJSON:function(){const e=r.Model.prototype.toJSON.call(this);return i.each(this.encodedFields,(function(t){const n=e[t];i.isEmpty(n)||(e[t]=JSON.stringify(n))})),e}});t.a={sync:o,syncBatch:function(e,t){const n=i.map(e.dels,(function(e){return{method:"DELETE",url:i.result(e,"url")||l()}})),a=i.map(e.posts,(function(e){return{method:"POST",url:i.result(e,"url")||l(),body:e.toJSON()}})),r=i.map(e.puts,(function(e){return{method:"PUT",url:i.result(e,"url")||l(),body:i.pick(...[e.toJSON()].concat(i.keys(e.changedAttributes())))}})),o=[].concat(n,a,r);return 0!=o.length&&(DBG&&console.log("syncBatch: requests:",o),s.a.batch(o,t))},Model:u,Collection:r.Collection.extend({model:u,parse:function(e){return e.data},sync:o}),PagedCollection:a.a.requestPager.extend({model:r.Model.extend(),paginator_core:{},paginator_ui:{currentPage:0,perPage:2},server_api:{_opt:function(){return{limit:this.perPage,offset:this.currentPage*this.perPage}}},parse:function(e){return this.offset=e.offset,this.totalPages=Math.ceil(e.count/this.perPage),this.totalRecords=e.total_count,e.data}})}},13:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var s=n(31);n.d(t,"b",(function(){return s.a})),n.d(t,"c",(function(){return s.b}));class a{constructor(e={},t){Object.assign(this,t),this.el=this.el||document.createElement(this.tag),this.el.setAttribute("viewclass",this._getCName()),this.state=new Proxy(e,{set:(e,t,n)=>(e[t]!==n&&(e[t]=n,!this._renderTimeout&&this._render()),!0),deleteProperty:(e,t)=>t in e&&(delete e[t],!this._renderTimeout&&this._render(),!0)}),this.views=new Proxy({},{set:(e,t,n)=>(e[t]!==n&&(e[t]=n,this._render()),!0)}),this.init(),this._render()}createTpl(){throw new Error("View should implement createTpl(state)")}init(){}_render(){this._renderTimeout&&clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>{delete this._renderTimeout,Object(s.b)(this.createTpl(this.state),this.el),this.afterRender()},1)}afterRender(){}setState(e){for(const t in e)this.state[t]!==e[t]&&(this.state[t]=e[t])}_getCName(){return this.constructor.name}}a.prototype.tag="div"},17:function(e,t,n){"use strict";var s=n(1);const a=[{type:s.a.RULE_NOT_EMPTY,label:"l_not_empty",params:[]},{type:s.a.RULE_HAS_TEXT,label:"l_has",params:[{label:"l_text",must:!0,name:"input",type:"text"}]},{type:s.a.RULE_HAS_TEXT_NOT,label:"l_has_not",params:[{label:"l_text",must:!0,name:"input",type:"text"}]},{type:s.a.RULE_HAS_NUMBER_LT,label:"l_has_num_lt",params:[{label:"l_num",must:!0,name:"input",type:"number"}]},{type:s.a.RULE_HAS_NUMBER_GT,label:"l_has_num_gt",params:[{label:"l_num",must:!0,name:"input",type:"number"}]},{type:s.a.RULE_HAS_NUMBER_DECR_MIN,label:"l_has_num_decr_min",params:[{label:"l_num",must:!0,name:"input",type:"number"}]},{type:s.a.RULE_HAS_NUMBER_INCR_MIN,label:"l_has_num_incr_min",params:[{label:"l_num",must:!0,name:"input",type:"number"}]},{type:s.a.RULE_HAS_NUMBER_DECR_PERCENT_MIN,label:"l_has_num_decr_percent_min",params:[{label:"l_num",must:!0,name:"input",type:"number"}]},{type:s.a.RULE_HAS_NUMBER_INCR_PERCENT_MIN,label:"l_has_num_incr_percent_min",params:[{label:"l_num",must:!0,name:"input",type:"number"}]},{type:s.a.RULE_MATCH_REGEX,label:"l_match_regex",params:[{label:"l_regex",must:!0,name:"input",type:"regexp"}]}],i=[{type:s.a.CONTENT_TYPE_TEXT,label:"l_text"},{type:s.a.CONTENT_TYPE_CHANGED_TEXT,label:"l_added_text"},{type:s.a.CONTENT_TYPE_OLD_TEXT,label:"l_text_old"}];t.a={ContentList:i,DescList:a}},33:function(e,t,n){"use strict";var s=n(6);const a=window.Backbone;if(!a)throw new Error("ADD Backbone");const i=window._;if(!i)throw new Error("ADD _");const r=window.jQuery;if(!r)throw new Error("ADD jQuery");const o={version:"0.6.0"};o.requestPager=a.Collection.extend({sync:function(e,t,n){const a=this,r=n.data||{},o=i.result(t,"url");a.setDefaults();const l={};i.each(i.result(a,"server_api"),(function(e,t){i.isFunction(e)&&(e=e.call(a)),l[t]=e})),r._opt=i.extend(l._opt||{},r._opt),i.extend(l,r);const c=s.a.api(o,e,l,(function(e,t){e?n.error&&n.error(e):n.success&&n.success(t)}));return t&&t.trigger&&t.trigger("request",t,c,n),c},setDefaults:function(){const e=this;i.defaults(e.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4}),i.each(e.paginator_ui,(function(t,n){i.isUndefined(e[n])&&(e[n]=e.paginator_ui[n])}))},requestNextPage:function(e){const t=this.info();if(!(t.currentPage+1>=t.totalPages)){if(void 0!==this.currentPage)return this.currentPage+=1,this.pager(e);{const e=new r.Deferred;return e.reject(),e.promise()}}e.error&&e.error("Cannot go past last page")},requestPreviousPage:function(e){if(!(this.currentPage<=0)){if(void 0!==this.currentPage)return this.currentPage-=1,this.pager(e);{const e=new r.Deferred;return e.reject(),e.promise()}}e.error&&e.error("Cannot go before first page")},goTo:function(e,t){if(void 0!==e)return this.currentPage=parseInt(e,10),this.pager(t);{const e=new r.Deferred;return e.reject(),e.promise()}},howManyPer:function(e){void 0!==e&&(this.currentPage=this.firstPage,this.perPage=e,this.pager())},info:function(){const e={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};return this.currentPage>1&&(e.previous=this.currentPage-1),this.currentPage<e.totalPages&&(e.next=this.currentPage+1),e.hasNext=e.next,e.hasPrevious=e.next,e.pageSet=this.setPagination(e),this.information=e,e},setPagination:function(e){const t=[];let n=0,s=0;const a=2*this.pagesInRange,i=Math.ceil(e.totalRecords/e.perPage);if(i>1)if(i<=1+a)for(n=1,s=i;n<=s;n++)t.push(n);else if(e.currentPage<=this.pagesInRange+1)for(n=1,s=2+a;n<s;n++)t.push(n);else if(i-this.pagesInRange>e.currentPage&&e.currentPage>this.pagesInRange)for(n=e.currentPage-this.pagesInRange;n<=e.currentPage+this.pagesInRange;n++)t.push(n);else for(n=i-a;n<=i;n++)t.push(n);return t},pager:function(e){return this.fetch(e||{})},bootstrap:function(e){return i.extend(this,e),this.setDefaults(),this.info(),this}}),o.requestPager.prototype.nextPage=o.requestPager.prototype.requestNextPage,o.requestPager.prototype.prevPage=o.requestPager.prototype.requestPreviousPage,t.a=o},37:function(e,t,n){"use strict";var s=n(2),a=n(0),i=n(4),r=n(3);if(!window.domo)throw new Error("ADD domo");const o=window.jQuery;if(!o)throw new Error("ADD jQuery");const l=window._;if(!l)throw new Error("ADD _");const c=window.Backbone;if(!c)throw new Error("ADD Backbone");i.a.Base.extend({name:"LoginView",getCredentials:function(e){return{user:this.form.id.value,password:this.form.password.value}[e]},postInit:function(e={}){const t=this;this.model=new c.Model({name:USER.name||""}),window.addEventListener("message",e=>{"event"==e.data.type&&this.trigger("frame:"+e.data.data)}),this.on("frame:ready",()=>{console.log("frame:ready"),o(".xloading").remove(),o(".xdevice-manager").show(),this.postMessage({type:"request",data:{action:"login",name:t.getCredentials("user"),password:t.getCredentials("password")}})}),this.on("frame:done",()=>{this.saveToken()}),this.on("frame:cancel",()=>{o(".xlogin").show(),o(".xdevice-manager").remove()})},postMessage:function(e){this.iframe.contentWindow.postMessage(e,s.a.CFG.URL.ROOT)},events:{submit:"submit"},showErrMsg(e){switch(e.status){case 400:return Object(a.a)("e_auth_400");case 403:return Object(a.a)("e_auth_403");case 402:return Object(a.a)("e_auth_402");default:return Object(a.a)("e_auth_5xx")}},saveToken:function(){const e={name:this.form.id.value,password:this.form.password.value};l.isEmpty(e.name)||l.isEmpty(e.password)?r.a.error(Object(a.a)("e_auth_400")):(this.$(".xsubmit").button("loading"),s.a.auth.saveToken(e,e=>{this.$(".xsubmit").button("reset"),e?(console.error("checkLogin:err?",e),r.a.error(this.showErrMsg(e)),402==e.status&&this.renderLoading()):(r.a.reset(),this.options.onLogin())}))},submit:function(e){e.preventDefault(),this.saveToken()},getMargin:function(){return this.options.isPopup?"40px":"100px"},showHeader:function(){return this.options.isPopup?"hide":""},getStyle:function(){return this.options.isPopup?"display:block;":`box-shadow: 5px 5px 10px #999; margin: auto;\n        margin-top: ${this.options.isPopup?"0px":"100px"};\n        overflow:hidden; max-width: 600px;`},renderLoading:function(){o(".xlogin").hide(),this.$el.append(DIV({class:"xloading",style:"margin: 50% auto; font-size: 3em; text-align: center;"},I({class:"fa fa-spin fa-spinner"})," ",Object(a.a)("l_loading"))),this.renderDevice(),o(".xdevice-manager").hide()},renderDevice:function(){const e=this.options.isPopup?"100vh":"calc(90vh - 100px)";this.$el.append(DIV({class:"xdevice-manager",style:`${this.getStyle()}`},this.iframe=IFRAME({src:s.a.CFG.URL.ROOT+"/frame-devices",style:`\n          width: 100%;\n          height: ${e};\n          margin-top: ${e};\n          transition: margin-top 300ms ease\n          `,frameborder:"none"}))),setTimeout(()=>this.iframe.style.marginTop=0,300)},render:function(){return this.$el.empty().append(DIV({class:`xpopup-heading xheader xheader-ext ${this.showHeader()}`,style:"width: 300px; margin: auto"},H2({class:"text-center"},Object(a.a)("a_signin"))),this.form=FORM({class:"xlogin",style:"width: 300px; margin: auto"},DIV({class:"xdistill-icon-container",style:`\n          margin-top: ${this.getMargin()};`},IMG({src:"ui/img/distill_128.png",style:"\n          display:block;\n          margin: auto;\n          border: solid 1px #ccc;\n          width: 150px;\n          height: 150px;\n          padding: 15px;\n          border-radius: 50%;\n          background-color: #fff;\n          box-shadow: 0px 3px 8px #aaa, inset 0px 2px 3px #fff;\n          background-image: -webkit-gradient(linear, left top, left bottom, from(#f7f7f7), to(#e7e7e7));\n          background-image: -webkit-linear-gradient(top, #f7f7f7, #e7e7e7); ",title:"Distill"})),DIV({style:"margin-top: 50px;"},A({class:"xurl btn btn-primary btn-block",style:"margin-left: 10px;",href:`${s.a.CFG.URL.ROOT}/service-login?redirect=app://ui/inbox.html#inbox`},Object(a.a)("a_login"))),DIV({style:"margin-top: 20px;"},A({class:"xurl btn btn-default btn-block",style:"margin-left: 10px;",href:`${s.a.CFG.URL.ROOT}/register`},Object(a.a)("a_register"))),DIV({class:"text-center",style:"margin-top: 25px"},A({class:"xurl",href:`${s.a.CFG.URL.ROOT}/account/forgot_password`},Object(a.a)("a_forgot_pass"))))),this.focus(),this}})},38:function(e,t,n){"use strict";var s=n(0),a=n(9),i=n(2),r=(n(6),n(3),n(4));n(37),n(10);const o=window.jQuery;if(!o)throw new Error("ADD jQuery");const l=window._;if(!l)throw new Error("ADD _");const c=window.Backbone;if(!c)throw new Error("ADD Backbone");var u=r.a.SimpleForm.extend({name:"SignInForm",fields:[{must:!0,name:"name",type:"text",label:"l_username"},{must:!0,name:"password",type:"password",label:"l_password"}],render:function(){return u.__super__.render.call(this),this.$el.append(DIV({class:"control-group"},this.msg=SMALL({class:"help"}))),this},showMsg:function(e,t){this.msg.textContent=e?Object(s.a)(e):"",o(this.msg)[t?"addClass":"removeClass"]("error")},submit:function(){return this.trigger("submit"),!1}}),d=r.a.SaveDiscardModal.extend({name:"SignInModal",action_discard:function(){this.remove()},action_save:function(){this.view.onSubmit()},initialize:function(e){this.model=new c.Model({name:USER.name||""}),l.defaults(e,{a_save:"a_signin",title:"l_account",width:600,view:new u({parent:e.parent,model:this.model})}),d.__super__.initialize.call(this,e),this.listenTo(this.view,"submit",this.saveToken)},renderFooter:function(){const e=d.__super__.renderFooter.call(this);return o(e).append(A({href:i.a.CFG.URL.ROOT+"/register?client="+i.a.CFG.CLIENT.NAME,target:"_blank"},Object(s.a)("a_register"))),e},saveToken:function(){const e=this,t=this.model.pick("name","password");l.isEmpty(t.name)||l.isEmpty(t.password)||(this.showProgress(!0),e.view.showMsg("l_loading"),i.a.auth.saveToken(t,(function(t){e.showProgress(!1),t?e.view.showMsg(t.response.code+" : "+(t.response.msg||t.msg||t.message||"e_signin_invalid"),!0):(e.view.showMsg("m_login_success"),setTimeout((function(){e.remove(),e.options.onSignIn&&e.options.onSignIn()}),100))})))}});const p=r.a.ActionProvider.extend({name:"SettingsGeneral",actions:{"settings signout":{fn:"action_signout"},"settings close":{fn:"closeLoginForm"}},events:{change:"event_change","click .xclose":"closeLoginForm"},closeLoginForm:function(){this.loginView.remove(),o(this.elLoginCt).remove(),this.updateUser()},action_signout:function(){i.a.auth.logout(),location.href=i.a.CFG.URL.ROOT+"/logout"},event_change:function(){this.saveValues()},load:function(e){this.setValues(),e()},render:function(){return this.$el.attr({id:"general",class:"hide"}).append(DIV({class:"panel panel-default"},HEADER({class:"panel-heading"},H3("General")),DIV({class:"panel-body"},DIV({class:"form-group"},H4(Object(s.a)("l_account")),A({class:"btn btn-primary",href:`${i.a.CFG.URL.ROOT}/service-login?redirect=app://ui/inbox.html#inbox`,"data-action":"settings signin"}),BUTTON({class:"btn btn-default",style:"margin-left: 20px;","data-action":"settings signout"},Object(s.a)("a_signout"))),DIV(Object(s.a)("m_ext_signin"))))),this.elSignIn=this.$('[data-action="settings signin"]'),this.elSyncInfo=this.$(".alert"),this},saveValues:function(){this.$el.find("input,select").each((function(){const e=this;"checkbox"==e.type?i.a.store.Prefs.set(e.name,e.checked):i.a.store.Prefs.set(e.name,e.value)}))},setValues:function(){this.$el.find("input,select").each((function(){const e=this;"checkbox"==e.type?e.checked=i.a.store.Prefs.get(e.name):e.value=i.a.store.Prefs.get(e.name)})),this.showCred()},showCred:function(){USER.name?this.elSignIn.text(Object(a.a)("l_signed_in_as",`${USER.name} (${USER.email})`)):this.elSignIn.text(Object(s.a)("a_signin"))},updateUser:function(){i.a.auth.getUser((e,t)=>{l.extend(USER,t),this.showCred()})}});t.a={SignInModal:d,View:p}},5:function(e,t,n){"use strict";var s=n(2);t.a={user:1,email:1,phone:0,isSignedIn:function(){return null!=s.a.auth.getToken()},agents:{local:1,type:s.a.CFG.CLIENT.TYPE,version:s.a.CFG.VERSION},actions:{popup:!0},tabForDynamic:s.a.Supports.tabForDynamic,tabForXFrame:s.a.Supports.tabForXFrame}},6:function(e,t,n){"use strict";const s=window._;if(!s)throw new Error("ADD _");function a(e){s.extend(this,e,this.parse(e.path))}function i(e){this.routes=s.map(e.routes,(function(e){return new a(e)}),this)}function r(e){try{return decodeURIComponent(e)}catch(t){return e}}s.extend(a.prototype,{match:function(e){const t=this.keys,n=this.params={},s=this.regexp.exec(e);if(!s)return!1;for(let a=1,i=s.length;a<i;++a){const i=t[a-1],o="string"==typeof s[a]?r(s[a]):s[a];if(!i)throw new Error("Nameless param not supported, path:"+e);n[i.name]=o}return!0},parse:function(e){const t=[];return e=e.concat("").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,(function(e,n,s,a,i,r,o){return t.push({name:a,optional:!!r}),n=n||"",(r?"":n)+"(?:"+(r?n:"")+(s||"")+(i||s&&"([^/.]+?)"||"([^/]+?)")+")"+(r||"")+(o?"(/*)?":"")})).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),{keys:t,regexp:new RegExp("^"+e+"$","i")}}}),s.extend(i.prototype,{find:function(e){return s.find(this.routes,(function(t){return t.match(e)}))}});var o=i,l=n(1),c=n(2);if(!window.qs)throw new Error("ADD qs");if(!window.jQuery)throw new Error("ADD jQuery");const u=window._;if(!u)throw new Error("ADD _");const d=window.async;if(!d)throw new Error("ADD async");const p={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"},h={version:"0.0.1",api:(_=g,function(){const e=[...arguments];if("function"!=typeof e[e.length-1])return new Promise((e,t)=>{_(...arguments,(function(n,s){n?t(n):e(s)}))});_(...arguments)}),batch:function(e,t){d.mapSeries(e,(function(e,t){g(e.url,e.method,e.body,(function(n,s){n&&console.error("Error handling request:",e),t(n,s)}))}),t)},init:function(e){e()}};var _;const f=new o({routes:[{list:!0,path:"/clients",store:c.a.store.ClientStore},{path:"/clients/:id",store:c.a.store.ClientStore},{list:!0,path:"/sieves",store:c.a.store.SieveStore},{path:"/sieves/:id",store:c.a.store.SieveStore},{list:!0,path:"/sieves/:sieve_id/actions",store:c.a.store.ActionStore},{path:"/sieves/:sieve_id/actions/:id",store:c.a.store.ActionStore},{list:!0,path:"/sieves/:sieve_id/data",store:c.a.store.SieveDataProxy},{path:"/sieves/:sieve_id/data/:id",store:c.a.store.SieveDataStore},{list:!0,path:"/sieves/:key/works/local",store:c.a.store.WorkStore},{list:!0,path:"/rules",store:c.a.store.RuleStore},{path:"/rules/:id",store:c.a.store.RuleStore},{list:!0,path:"/tags",store:c.a.store.TagStore},{list:!0,path:"/tags/:id",store:c.a.store.TagStore},{list:!0,path:"/users/attrs",store:c.a.store.AttrStore},{path:"/users/attrs/:id",store:c.a.store.AttrStore}]});function g(e,t,n,s){n=n||{},t=p[t]||t||"GET";delete n._state;const a=f.find(e);return a?function(e,t,n,s){const a=e.path,i=e.store,r=i.hasField("user_id"),o=window.USER?USER.id:c.a.auth.getId(),d=function(e,n){e?console.error("API:err",a,t,e):"GET"!=t&&c.a.service.syncStore(i),n&&(n=JSON.parse(JSON.stringify(n))),s(e,n)};switch(t){case"DELETE":i.update(e.params,{state:l.a.STATE_DEL,_state:l.a.LOCAL_STATE_DEL},d);break;case"GET":var p=e.params;if(r&&(p.$and={$or:[["user_id",o],["user_id",null]]}),e.list){const e=n._opt;p=u.extend(u.omit(n,"_opt"),p),i.find(p,e,d)}else i.findOne(p,d);break;case"PATCH":case"PUT":p=e.params;var h=n;i.update(p,h,d);break;case"POST":h=u.extend(n,e.params);i.create(h,d);break;default:d({msg:"API: Unknown method:"+t})}}(a,t,n,s):c.a.api(e,t,n,s)}t.a=h},8:function(e,t,n){"use strict";var s=n(2),a=(n(38),n(12)),i=n(0),r=(n(9),n(11)),o=(n(33),n(17)),l=(n(14),n(3),n(1)),c=n(10),u=n(4),d=n(6);const p=r.a.Model,h=r.a.Collection,f=p.extend({urlRoot:"/users/attrs"});var g={UserAttr:f,UserAttrs:h.extend({model:f,url:"/users/attrs"})},m=n(5),T=n(13);let E,w,b,y,x=e=>e;const v=window.Backbone;if(!v)throw new Error("ADD Backbone");const S=window.moment;if(!S)throw new Error("ADD moment");const O=r.a.Model,N=r.a.Collection;var D=v.Model.extend({defaults:function(){return{type:"INTERVAL",params:new O({interval:10800})}},getFrequencyClass:function(){const{params:e,type:t}=this.attributes;e||(e=this.defaults());const n=e.attributes.interval;let s="";return n?s=n<60?"xfreq-xh":n<600?"xfreq-hi":"xfreq":"LIVE"==t&&(s="xfreq-hi"),s},getShortDisplayText:function(){const e=this.attributes,t=e.params&&e.params.attributes,n=t.interval;return"LIVE"==e.type?Object(i.a)("l_schedule_live"):"RANDOM"==e.type?this.formatInterval(t.min,!0)+"-"+this.formatInterval(t.max,!0):"CRON"==e.type?"cron":n?this.formatInterval(n):Object(i.a)("m_never")},formatInterval:function(e,t){let n,s;if(e<60)n="second",s=e;else if(e<3600)n="minute",s=e/60;else if(e<86400)n="hour",s=e/3600;else{if(!(e<2592e3))return Object(i.a)("m_never");n="day",s=e/86400}return s=Math.round(s),t?s+n[0]:a.a.translate("m_1_"+n).ifPlural(s,Object(i.a)("m_n_"+n)).fetch(s)},parse:function(e){return e.params=new v.Model({...e.params},{parse:!0}),e},toJSON:function(){const e=D.__super__.toJSON.call(this);return e.params=e.params.toJSON(),e}});const R=v.Model.extend({defaults:{type:"xpath"},toJSON:function(){const e=L.__super__.toJSON.call(this);return delete e.id,e}}),C=v.Collection.extend({model:R,initialize:function(e,t){this.frame=t.frame}});var L=v.Model.extend({parse:function(e){return e.excludes=new C(e.excludes,{parse:!0,frame:this}),e.includes=new C(e.includes,{parse:!0,frame:this}),e},toJSON:function(){const e=L.__super__.toJSON.call(this);return e.excludes=e.excludes.toJSON(),e.includes=e.includes.toJSON(),0===e.index&&(delete e.title,delete e.uri),e}});const U=v.Collection.extend({model:L});var M=v.Model.extend({defaults:{dynamic:!0,delay:0},addLocator:function(e,t,n){const s=this.get("frames");let a=s.findWhere({index:e.index});const i=new R(n);return a||(a=new L(e,{parse:!0}),s.add(a)),"EXCLUDE"==t?a.get("excludes").add(i):a.get("includes").add(i),i},createDefaultSelection:function(){this.addLocator({index:0},"INCLUDE",{type:"css",expr:"body"})},getLocator:function(e,t){const n=this.get("frames").findWhere({index:e});return n.get("excludes").get(t)||n.get("includes").get(t)},isEmpty:function(){const e=this.get("frames").at(0);return!e||0===e.get("includes").length},parse:function(e){return e.frames=new U(e.frames,{parse:!0}),e},removeLocator:function(e,t){const n=this.get("frames").findWhere({index:e}),s=n.get("excludes"),a=n.get("includes");let i;if(i=s.get(t))s.remove(i);else{if(!(i=a.get(t)))throw new Error("Frame does not contain selection with id: "+t);a.remove(i)}},toJSON:function(){const e=M.__super__.toJSON.call(this);return e.frames=e.frames.toJSON(),delete e.title,delete e.uri,e}});const k=v.Collection.extend({model:M}),F=O.extend({isEmpty:function(){return!this.get("uri")}}),j=F.extend(),H=F.extend(),V=F.extend({defaults:{ignoreEmptyText:!0,dataAttr:"text"}}),J=F.extend({defaults:{ignoreEmptyText:!0,dataAttr:"text"}});var Y=O.extend({__structure__:{includeStyle:!1,includeScript:!1,selections:[{title:"Distill",uri:"https://distill.io",frames:[{index:0,uri:"https://distill.io",excludes:[{type:"xpath",expr:""}],includes:[{}]}]}]},defaults:{ignoreEmptyText:!0,includeStyle:!1,dataAttr:"text"},createDefaultPage:function(){const e=new M({frames:[{index:0}],dynamic:!0},{parse:!0});e.createDefaultSelection(),this.set("selections",new k([e]))},getExcludes:function(){const e=this.get("selections").toJSON();return _.chain(e).pluck("frames").flatten().pluck("excludes").flatten().value()},getIncludes:function(){const e=this.get("selections").toJSON();return _.chain(e).pluck("frames").flatten().pluck("includes").flatten().value()},getPage:function(){const e=this.get("selections");return e&&e.at(0)},isEmpty:function(){return 0==this.getIncludes().length},parse:function(e){return e.selections=new k(e.selections,{parse:!0}),_.isString(e.regexp)&&(e.regexp={expr:e.regexp,flags:"gim"}),e},toJSON:function(){const e=Y.__super__.toJSON.call(this);return e.selections=e.selections.toJSON(),e}}),G=O.extend({encodedFields:["config","schedule"],urlRoot:"/sieves",clone:function(){return new G(this.toJSON(),{parse:!0})},defaults:function(){return{schedule:new D}},getExcludes:function(){const e=this.get("config");return e&&e.getExcludes()||[]},getIncludes:function(){const e=this.get("config");return e&&e.getIncludes()||[]},getPage:function(){const e=this.get("config");return e&&e.getPage()},getTags:function(e){let t;const n=[],s=(this.get("tags")||"").split(",");return _.each(s,(function(s){(t=e&&e.get(s))&&n.push(t)})),n},isDynamic:function(){const e=this.get("config");if(e){const t=e.get("selections");if(t&&t.length>0){return!0===t.at(0).attributes.dynamic}}return!1},isEmpty:function(){const e=this.get("config");return!e||e.isEmpty()},isRead:function(){return S(this.get("ts_view"))>=S(this.get("ts_data"))},parse:function(e){if((e=G.__super__.parse.call(this,e)).config)if(e.content_type==l.a.TYPE_FEED)e.config=new j(e.config);else if(e.content_type==l.a.TYPE_HTML)e.config=new Y(e.config,{parse:!0});else if(e.content_type==l.a.TYPE_PDF_HTML)e.config=new H(e.config,{parse:!0});else if(e.content_type==l.a.TYPE_XML)e.config=new V(e.config,{parse:!0});else{if(e.content_type!=l.a.TYPE_DOC)throw new Error("Unknown content_type: "+e.content_type);e.config=new J(e.config,{parse:!0})}return e.schedule&&(e.schedule=new D(e.schedule,{parse:!0})),e},save:function(){const e=this.get("config").get("meta")||{};if(!this.id&&e.tplId){const t=this;this.once("sync",(function(){d.a.api("/tpls/sieves/usage","POST",{tpl_id:e.tplId,sieve_id:t.id,uri:t.get("uri")},(function(e,t){}))}))}G.__super__.save.apply(this,arguments)}});const q=r.a.PagedCollection.extend({model:G,paginator_ui:{currentPage:0,perPage:50},url:"/sieves"}),X=r.a.PagedCollection.extend({initialize:function(e,t){this.parent=t.parent},url:function(){return["/sieves",this.parent.id,"data"].join("/")}}),W=O.extend({encodedFields:["config"],urlRoot:"/rules",defaults:function(){return{config:{type:o.a.TYPE_RULE_GROUP,op:o.a.OP_AND,rules:[]}}},isEmpty:function(){const e=this.get("config");return!(e&&e.rules.length>0)}}),z=O.extend({encodedFields:["err","data"]}),Q=N.extend({model:z,initialize:function(e,t){this.parent=t.parent,this.on("add",this.onAdd,this)},onAdd:function(e){e.parent=this.parent},url:function(){let e="works";this.parent.get("client_id"),App.clients.defaultId;return m.a.agents.local&&(e="works/local"),["/sieves",this.parent.id,e].join("/")}});class K extends T.a{constructor(e){super({name:e,available:!1,list:[],loading:!0,newValue:""}),this.fetch()}async fetch(){"0"!==(await d.a.api("/users/constraints")).plan_id[0]&&(this.state.available=!0);let e=await d.a.api("/users/attrs",{name:this.state.name,"state.in":[10,40]});this.state.loading=!1,this.state.list=e.data}createTpl({loading:e,available:t,list:n,name:s}){return e?Object(T.b)(E||(E=x`Loading`)):t?Object(T.b)(b||(b=x`
      <ul class='list-group'>
      ${0}
      </ul>
      <div class='input-group'>
        <input class='form-control' type='text' placeholder='Enter new ${0}' 
          @input=${0}
          .value=${0}
          >
        <span class='input-group-btn'>
          <button @click=${0} class='btn btn-primary'>Add</button>
        </span>
      </div>
      `),n.map(e=>e.value==USER.email?"":Object(T.b)(y||(y=x`<li class='list-group-item' id=${0}>
        <span>${0}</span>
        <div class='right'>
          <button class='btn btn-default btn-xs' @click=${0}>
            Delete
          </button>
        <div>
        </li>`),e.id,e.value,t=>this.onDel(e.id))),s,e=>this.state.newValue=e.target.value,this.state.newValue,e=>this.onAdd()):Object(T.b)(w||(w=x`It is currently only available for paid customers.`))}async onAdd(){let e=this.state.newValue.trim();e.length>0&&(await d.a.api("/users/attrs","POST",{name:this.state.name,value:e}),this.fetch()),this.state.newValue=""}async onDel(e){await d.a.api(`/users/attrs/${e}`,"DELETE"),this.fetch()}}var Z=c.a.SelectOptionsPlugin.extend({action_edit:function(){const e=new u.a.Base({el:new K(this.param.name).el}),t=new u.a.Modal({title:"Manage List",parent:this.editor.getRoot(),view:e});t.show(),this.listenTo(t,"discard",()=>this.fetch())},fetch:function(){this.attrs.fetch({data:{name:this.param.name,"state.in":[10,40],_opt:{order:["ts"]}}})},getOptionLabel:function(e){return e.get(this.attrLabel)+(10==e.get("state")?" - unverified":"")},load:function(){this.attrs=new g.UserAttrs,this.listenTo(this.editor,"reset",_.bind(this.fetch,this)),this.listenTo(this.attrs,"sync",_.bind(this.loadData,this)),this.fetch(),$(this.separator).attr("label",Object(i.a)("l_loading"))},onSync:function(){const e=this;s.a.service.SyncMan._syncStore(s.a.store.AttrStore,(function(){e.fetch()}))},render:function(){if(Z.__super__.render.call(this),m.a.agents.local&&m.a.isSignedIn()){let e;$(this.select).after(" ",e=BUTTON({class:"btn xbtn-light",title:Object(i.a)("l_sync")},I({class:"fa fa-refresh"}))),e.onclick=this.onSync.bind(this)}},renderActions(){"email"==this.param.name&&this.select.appendChild(OPTION({value:"action:edit"},"Manage List"))},unload:function(){Z.__super__.unload.call(this),this.attrs.reset()}});const ee=c.a.Plugin.extend({onSignIn:function(){window.location.href=s.a.service.serviceLoginUrl},render:function(){m.a.agents.local&&!m.a.isSignedIn()&&(this.a=A({href:"javascript:void 0"},B(Object(i.a)("a_signin"))),$(this.editor.field).hide().after(this.a),this.a.onclick=_.bind(this.onSignIn,this))}}),te=c.a.Plugin.extend({play:function(){const e=this.editor.field,t=AUDIO(),n=e.value;function a(e){t.src=e,t.play()}$(e).after(t),0==n.indexOf("tone:")?s.a.store.KVStore.findOne(n,(function(e,t){a(t.value)})):a(n)},render:function(){const e=this.editor.field,t=A({href:"javascript:void 0"},Object(i.a)("a_play"));$(e).after(" ",t),t.onclick=_.bind(this.play,this)}}),ne=[{type:l.a.ACTION_EMAIL,label:"l_action_email",icon:"fa-envelope-o",addByDefault:function(e){return e.user&&e.email},params:[{label:"l_email",must:!0,name:"email",type:"email",plugins:[Z,ee]}]},{type:l.a.ACTION_PUSH,label:"l_action_push",icon:"fa-mobile",paid:1,single:!0,addByDefault:function(e){return!1},params:[],plugin:function(e){const t=new g.UserAttrs;t.fetch({data:{"name.in":["fcm_id","gcm_id","apns_id"],"state.in":[0,40],_opt:{order:["ts"],limit:1}},success:function(){0==t.length&&e.$el.append(P({class:"error",style:"padding:5px"},"App not installed. Install one to get push notifications."))}})}},{type:l.a.ACTION_SMS,label:"l_action_sms",icon:"fa-mobile",paid:1,addByDefault:function(e){return!1},params:[{label:"l_phone",must:!0,name:"phone",type:"phone",plugins:[Z,ee]}]},{type:l.a.ACTION_DISCORD,label:"l_action_discord",icon:"fa-terminal",paid:1,addByDefault:function(e){return!1},params:[{label:"l_discord",must:!0,name:"discord",type:"url",plugins:[ee]}]},{type:l.a.ACTION_SLACK,label:"l_action_slack",icon:"fa-slack",paid:1,addByDefault:function(e){return!1},params:[{label:"l_slack",must:!0,name:"slack",type:"url",plugins:[ee]}]},{type:l.a.ACTION_WEBHOOK,label:"l_action_webhook",icon:"fa-terminal",paid:1,addByDefault:function(e){return!1},defaults:{data:{id:"{{sieve.id}}",name:"{{sieve.name}}",uri:"{{sieve.uri}}",text:"{{sieve_data.text}}"}},params:[{label:"l_url",must:!0,name:"url",type:"url",values:[{name:"sieve.id",help:"Monitor's UUID."}],plugins:[ee]},{label:"l_data",fieldLabel:"l_field",must:!1,name:"data",type:"request_data",values:[{name:"sieve.id",help:"Monitor's UUID."},{name:"sieve_data.data",help:"Data fetched from source. HTML for pages and XML for feeds."},{name:"sieve_data.text",help:"Readable text extracted from source data."}]},{label:"l_headers",fieldLabel:"l_header",must:!1,name:"headers",type:"request_headers",values:[]}]},{type:l.a.ACTION_LOCAL_OPEN_TAB,label:"l_action_local_open_tab",icon:"fa-file-o",local:!0,single:!0,addByDefault:function(){return!1},params:[]},{type:l.a.ACTION_LOCAL_POPUP,label:"l_action_local_popup",icon:"fa-comment-o",local:!0,single:!0,addByDefault:function(e){return e.agents.local},params:[]},{type:l.a.ACTION_LOCAL_AUDIO,label:"l_action_local_audio",icon:"fa-volume-up",local:!0,single:!0,addByDefault:function(e){return e.agents.local},params:[{label:"l_tone",name:"tone",type:"enum",must:!0,list:function(){const e=[{label:"l_bell_strike",value:"/skin/media/bell_strike.ogg"},{label:"l_asian_koel",value:"/skin/media/asian_koel.ogg"},{label:"l_ding_dong",value:"/skin/media/ding_dong.ogg"},{label:"l_buzzer",value:"/skin/media/buzzer.ogg"}];return m.a.agents.local&&s.a.store.KVStore.findOne("tones",(function(t,n){if(n){const t=JSON.parse(n.value);_.each(t,(function(t){e.push(t)}))}})),e}(),plugins:[te]}]}],se=O.extend({encodedFields:["config"],parent:null,defaults:function(){const e=this.desc,t={type:e.type};return e.defaults&&(t.config=_.result(e,"defaults")),t},initialize:function(e,t){this.parent=t&&t.parent},urlRoot:function(){const e=this.parent;if(null==e)throw new Error("Parent sieve not set for action");return"/sieves/"+e.id+"/actions"}}),ae=se.extend({desc:{type:l.a.ACTION_NONE,label:"l_action_none",single:!0,addByDefault:function(e){return!1},params:[]}});var ie=N.extend({initialize:function(e,t){this.parent=t.parent,this.on("add",this.onAdd,this)},onAdd:function(e){e.parent=this.parent},parse:function(e){return e=ie.__super__.parse.call(this,e),_.map(e,(function(e){return new(se[e.type]||ae)(e,{parse:!0,parent:this.parent})}),this)},url:function(){return["/sieves",this.parent.id,"actions"].join("/")}});m.a.agents.local&&ne.slice(0).forEach((function(e,t){e.local&&(ne.splice(t,1),ne.splice(0,0,e))})),_.each(ne,(function(e){se[e.type]=se.extend({desc:e},{desc:e})}));t.a={LocatorDescList:[{type:"css",label:"l_css_selector",params:[{label:"l_css_selector",help:"h_css_selelctor",must:!0,name:"expr",type:"css"}]},{type:"js",label:"l_js",params:[{label:"l_js",help:"h_js",must:!0,name:"expr",type:"js"}]},{type:"xpath",label:"l_xpath",params:[{label:"l_xpath",help:"h_xpath",must:!0,name:"expr",type:"xpath"}]}],Frame:L,Frames:U,Page:M,Pages:k,Schedule:D,Sieve:G,SieveConfigFeed:j,SieveConfigHTML:Y,Sieves:q,SieveDataPager:X,SieveRule:W,SieveActionDescList:ne,SieveAction:se,SieveActions:ie,Works:Q,ACTION_EMAIL:l.a.ACTION_EMAIL,ACTION_SMS:l.a.ACTION_SMS,ACTION_PUSH:l.a.ACTION_PUSH}},9:function(e,t,n){"use strict";var s=n(12),a=n(0);const i=window._;if(!i)throw new Error("ADD _");t.a=function(e){let t=i.toArray(arguments).slice(1);return t=i.map(t,(function(e){return i.isString(e)?Object(a.a)(e):e})),s.a.sprintf(...[Object(a.a)(e)].concat(t))}}}]);
//# sourceMappingURL=2.js.map