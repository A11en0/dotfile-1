var backgroundPage=chrome.extension.getBackgroundPage();var imports=["require","isWhitelisted","extractHostFromURL","refreshIconAndContextMenu"];for(var i=0;i<imports.length;i++)window[imports[i]]=backgroundPage[imports[i]];var require=backgroundPage.require;var getStats=require("stats").getStats;var FilterNotifier=require("filterNotifier").FilterNotifier;var Filter=require("filterClasses").Filter;var FilterStorage=require("filterStorage").FilterStorage;var Prefs=require("prefs").Prefs;var Cscript=require("cscript").Cscript;with(require("subscriptionClasses")){this.Subscription=Subscription;this.DownloadableSubscription=DownloadableSubscription}$(function(){var currentTabId;var tab=null;function initBlockState(){chrome.tabs.query({active:true,windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){if(tabs.length>0){currentTabId=tabs[0].id;updateStats();FilterNotifier.addListener(onNotify)}});window.addEventListener("unload",function(){FilterNotifier.removeListener(onNotify)},false)}function updateStats(){var blockedPage=getStats("blocked",currentTabId).toLocaleString();$(".current-block-ad").html(blockedPage);var blockedTotal=getStats("blocked").toLocaleString();$(".total-block-ad").html(blockedTotal)}function onNotify(action,item){if(action=="filter.hitCount")updateStats()}function initPopupState(){chrome.windows.getCurrent(function(w){chrome.tabs.getSelected(w.id,function(t){tab=t;if(!isWhitelisted(tab.url)){$("#enable-block").addClass("checked");$("#enable-block-text").show();$("#disable-block-text").hide()}chrome.tabs.sendMessage(tab.id,{reqtype:"get-clickhide-state"},function(response){if(!response){return}if(!!response.active){$(".main-menu").hide(0);$(".click-block").show(0)}})})});var s=Cscript.getScript('http://sub.adtchrome.com/videoadjs.txt');if(s!=undefined&&s.enabled){$(".block-video-icon").toggleClass("checked");$("#enable-video-block-text").toggle();$("#disable-video-block-text").toggle()}}function toggleEnabledAdblock(checked){if(checked){var filter=isWhitelisted(tab.url);while(filter){FilterStorage.removeFilter(filter);if(filter.subscriptions.length)filter.disabled=true;filter=isWhitelisted(tab.url)}}else{var host=extractHostFromURL(tab.url).replace(/^www\./,"");var filter=Filter.fromText("@@||"+host+"^$document");if(filter.subscriptions.length&&filter.disabled)filter.disabled=false;else{filter.disabled=false;FilterStorage.addFilter(filter)}}refreshIconAndContextMenu(tab)}function toggleEnabledVideoAdblock(checked){Cscript.enable("http://sub.adtchrome.com/videoadjs.txt",checked)}function activateClickBlock(){chrome.tabs.sendMessage(tab.id,{reqtype:"clickhide-activate"});$("body").bind("mouseleave",function(){window.setTimeout(window.close,500)})}function cancelClickBlock(){$("body").unbind("mouseleave");chrome.tabs.sendMessage(tab.id,{reqtype:"clickhide-deactivate"})}function onekeyshare(type){var url;var appkey="";var title="广告终结者(Ad Terminator)——功能最全面的广告屏蔽扩展";var pic="http://www.adtchrome.com/img/download-slide2.jpg";var shareLink=encodeURIComponent("http://www.adtchrome.com");switch(type){case"sina-weibo":url="http://service.weibo.com/share/share.php?url="+shareLink+"&appkey="+appkey+"&title="+title+"&pic="+pic;break;case"qq-zone":url="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+shareLink+"&desc=广告终结者(Ad Terminator)——功能最全面的广告屏蔽插件"+"&title=广告终结者(Ad Terminator)"+"&pic="+pic;break;case"tenc-weibo":url="http://share.v.t.qq.com/index.php?c=share&a=index&url="+shareLink+"&title="+title+"&appkey="+appkey+"&pic="+pic;break;case"renren":var description="广告终结者可以清除所有网页广告，恶意弹窗，视频广告，跟踪代码，加快网页加载速度 ";var message="广告终结者(Ad Terminator)——功能最全面的广告屏蔽插件";url="http://widget.renren.com/dialog/share?resourceUrl="+shareLink+"&message="+message+"&description="+description+"&pic="+pic;break}window.open(url)}function initEventBind(){$(".header").click(function(){$("#ad-statistic").show();$("#menu").hide()});$(".footer").click(function(){$("#ad-statistic").hide();$("#menu").show()});$(".checkbox-hoverhook").click(function(){$(this).find(".checkbox-green").toggleClass("checked");$("#enable-block-text").toggle();$("#disable-block-text").toggle();toggleEnabledAdblock($(this).find(".checkbox-green").hasClass("checked"))});$(".click-block-video-hook").click(function(){$(this).find(".block-video-icon").toggleClass("checked");$("#enable-video-block-text").toggle();$("#disable-video-block-text").toggle();toggleEnabledVideoAdblock($(this).find(".block-video-icon").hasClass("checked"))});$(".checkbox-hoverhook").hover(function(){$(this).find(".checkbox-green").addClass("hover")},function(){$(this).find(".checkbox-green").removeClass("hover")});$(".option-hook").click(function(){window.close();chrome.tabs.create({url:"options.html"})});$(".click-help-hook").click(function(){window.open("http://www.adtchrome.com/help/index.html")});$("#help-block").click(function(){window.open("http://www.adtchrome.com/help/help-block.html")});$(".click-block-hook").click(function(){$(".main-menu").hide();$(".click-block").show();activateClickBlock()});$("#click-block-cancel").click(function(){cancelClickBlock();$(".main-menu").show();$(".click-block").hide()});$(".sina-weibo").click(function(){onekeyshare("sina-weibo")});$(".qq-zone").click(function(){onekeyshare("qq-zone")});$(".tenc-weibo").click(function(){onekeyshare("tenc-weibo")});$(".renren").click(function(){onekeyshare("renren")})}initPopupState();initBlockState();initEventBind()});