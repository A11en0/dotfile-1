(window.webpackJsonp=window.webpackJsonp||[]).push([[10],Array(21).concat([function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(43),a=n.n(i),s=n(44),r=n.n(s),o=n(42);n.d(t,"b",(function(){return o.a})),n.d(t,"c",(function(){return o.b}));var l=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;a()(this,e),Object.assign(this,i),this.el=this.el||document.createElement(this.tag),this.el.setAttribute("viewclass",this._getCName()),this.state=new Proxy(n,{set:function(e,n,i){return e[n]!==i&&(e[n]=i,!t._renderTimeout&&t._render()),!0},deleteProperty:function(e,n){return n in e&&(delete e[n],!t._renderTimeout&&t._render(),!0)}}),this.views=new Proxy({},{set:function(e,n,i){return e[n]!==i&&(e[n]=i,t._render()),!0}}),this.init(),this._render()}return r()(e,[{key:"createTpl",value:function(){throw new Error("View should implement createTpl(state)")}},{key:"init",value:function(){}},{key:"_render",value:function(){var e=this;this._renderTimeout&&clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout((function(){delete e._renderTimeout,Object(o.b)(e.createTpl(e.state),e.el),e.afterRender()}),1)}},{key:"afterRender",value:function(){}},{key:"setState",value:function(e){for(var t in e)this.state[t]!==e[t]&&(this.state[t]=e[t])}},{key:"_getCName",value:function(){return this.constructor.name}}]),e}();l.prototype.tag="div"},,,,,function(e,t,n){"use strict";var i=n(16),a=n(1),s=i.a.Model.extend({urlRoot:"/clients",getIcon:function(){var e,t=this.get("type");return this.iconClass?this.iconClass:(e=this.id==r.webAppId?"fa fa-cloud":this.id==App.clients.defaultId?"im-pc":t==a.a.CLIENT_FF?"im-firefox":t==a.a.CLIENT_CR?"im-chrome":t==a.a.CLIENT_OP?"im-opera":t==a.a.CLIENT_FFWX?"im-firefox":"im-globe",this.iconClass=e)},getInfo:function(){var e=this.get("info")||this.get("name");return this.id==App.clients.defaultId&&(e+=" (this device)"),e},isWeb:function(){return this.id===r.webAppId}}),r=i.a.Collection.extend({model:s,url:"/clients"},{webAppId:"ffffffff-ffff-ffff-ffff-ffffffffffff"});t.a={Client:s,Clients:r}},,,,,,,,,,,,function(e,t,n){"use strict";var i=n(2),a=window._;if(!a)throw new Error("ADD _");var s=window.Backbone;if(!s)throw new Error("ADD Backbone");var r=a.extend({},s);new Date;function o(e,t){function n(){var e=a.toArray(arguments);setTimeout((function(){t.apply(this,e)}),50)}i.a.gEvents.on(e,n),window.addEventListener("unload",(function(){i.a.gEvents.off(e,n)}))}function l(e){o(e,(function(t,n){r.trigger(e,t,n)}))}function c(e,t){return function(n){setTimeout((function(){var i={name:e,id:n.id,op:t,ts_mod:n.ts_mod};r.trigger(e,i),r.trigger(e+":"+n.id,i)}),100)}}o("service:active",(function(e){r.trigger("service:state",e)})),o("change:pref:service.user_id",(function(){window.location.reload()})),o("store:clients:create",c("clients","I")),o("store:clients:update",c("clients","U")),o("store:sieve_data:create",c("sieve_data","I")),o("store:sieves:create",c("sieves","I")),o("store:sieves:update",c("sieves","U")),o("worker:sieve:state",(function(e){var t={rel:"sieves",id:e.id,ts_mod:Date.now(),doc:e};r.trigger("sieves:run_state",t),r.trigger("sieves:run_state:"+e.id,t)})),o("store:tags:create",c("tags","I")),o("store:tags:update",c("tags","U")),o("store:tags:destroy",c("tags","U")),l("change:error"),l("change:unread"),r.init=function(){var e=i.a.service.state,t=a.clone(e.attributes);e.clear(),e.set(t)},t.a=r},function(e,t,n){var i=n(56),a=n(57),s=n(58);e.exports=function(e,t){return i(e)||a(e,t)||s()}},function(e,t,n){"use strict";var i=n(16),a=(n(1),i.a.Model.extend()),s=i.a.Collection.extend({model:a}),r=i.a.Model.extend({parse:function(e){return e.entries=new s(e.entries),e}});t.a={Feed:r,FeedEntry:a,FeedEntryCollection:s}},function(e,t,n){"use strict";var i=n(4);if(!window.domo)throw new Error("ADD domo");if(!window.async)throw new Error("ADD async");var a=i.a.Base.extend({name:"FeedEntry",render:function(){var e,t=this.model.attributes;return this.$el.append(H3(A({href:t.link},t.title)),DIV({style:"color: #999; margin: -10px 0px;"},I(moment(t.date).format("MMMM DD, YYYY"))),e=DIV({class:"summary"})),$(e).html(t.description||t.summary||""),this}}),s=i.a.Collection.extend({name:"FeedEntryList",addOne:function(e){var t=new a({parent:this,model:e}).render();return this.$el.append(t.el),t}}),r=i.a.Base.extend({name:"Feed",render:function(){var e=this.model.attributes;return this.$el.append(H3(A({href:e.link},e.title)),DIV(e.description||e.summary||""),new s({parent:this,collection:this.model.get("entries")}).render().el),this}});t.a={Feed:r,FeedEntry:a,FeedEntryList:s}},,,,function(e,t,n){"use strict";var i=n(0),a=n(3),s=n(14),r=n(4),o=(n(26),window.async);if(!o)throw new Error("ADD async");var l=r.a.Base.extend({name:"ClientSelector",tagName:"select",className:"form-control xform-control-sm",onChange:function(){this.model.set("client_id",this.$el.val())},postInit:function(e){this.client_id=this.model.get("client_id")||App.clients.defaultId,this.$el.on("change",this.onChange)},render:function(){return this.$el.append(App.clients.map((function(e){return OPTION({value:e.id},e.getInfo())}))),this.$el.val(this.client_id),this}}),c=r.a.Collection.extend({name:"ClientManager",actions:{"client edit name":{fn:"action_edit_name"},"client remove":{fn:"action_remove"}},action_edit_name:function(e){var t=this,n=s.a.create("text"),i=this.collection.get(e),a=new r.a.PromptModal({title:"l_name",parent:this.getRoot(),view:n,width:500});a.show(),n.setValue(i.get("info")),$(n.field).focus(),a.on("save",(function(){var e=n.getValue();i.save({info:e},{patch:!0}),a.remove(),t.onReset(t.collection,{previousModels:t.collection.models})}))},action_remove:function(e){var t=this,n=this.collection.get(e);return e==this.collection.defaultId?alert(Object(i.a)("Can't remove self")):n.isWeb()?alert(Object(i.a)("Can't remove web app")):void(confirm(Object(i.a)("Remove "+n.get("info")+"?"))&&n.save({state:90},{wait:!0,success:function(){t.collection.remove(n)}}))},addOne:function(e){if(e.get("type")<3)return new r.a.Base;var t=e.get("info"),n=e.id==this.collection.defaultId,a=new r.a.Base({el:P(SPAN(BUTTON({class:"btn btn-default btn-xs","data-action":"client edit name","data-action-param":e.id},I({class:"fa fa-edit"}))," ",BUTTON({class:"btn btn-danger btn-xs","data-action":"client remove","data-action-param":e.id},I({class:"fa fa-trash-o"})))," ",SPAN({style:n?"font-weight: bold;":""},t,n?" ("+Object(i.a)("l_device_this")+")":""),SMALL({},moment(e.get("ts")).format(" (YYYY-MM-DD)"))),parent:this}).render();return this.$el.append(a.el),a},onSave:function(){a.a.info("l_loading"),o.eachSeries(this.collection.models,(function(e,t){e.hasChanged("info")?e.save(null,{error:function(){t(new Error("Failed to save changes"))},success:function(){t()}}):t()}),(function(e){a.a.reset()}))},renderBase:function(){}});t.a={ClientManager:c,ClientSelector:l}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(5),a=n.n(i),s=n(6),r=n.n(s),o=n(7),l=n.n(o),c=n(10),d=n(2);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(){return f.apply(this,arguments)}function f(){return(f=l()(a.a.mark((function e(){var t,n,i,s,r,o,l,h=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:0,n={isOverLimit:!1,isFlexi:!1},!(i=d.a.auth)||i.isLoggedIn()){e.next=14;break}if(!i.isLegacy()){e.next=8;break}return e.abrupt("return",n);case 8:return s=25,e.next=11,d.a.store.SieveStore.find({"state.in":[40,45]},{only:["id"],limit:1});case 11:return r=e.sent,o=r.total_count,e.abrupt("return",u({},n,{limit:s,count:o,isOverLimit:o+t>s}));case 14:return e.next=16,c.a.api("/users/sieve-count");case 16:return l=e.sent,e.abrupt("return",u({},l,{isOverLimit:!l.isFlexi&&l.count+t>l.limit}));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";var i=n(13),a=(n(3),n(4)),s=n(9);if(!window.jQuery)throw new Error("ADD jQuery");if(!window._)throw new Error("ADD _");if(!window.Backbone)throw new Error("ADD Backbone");if(!window.domo)throw new Error("ADD domo");var r=a.a.Base.extend({name:"SieveConstraints",postInit:function(){},render:function(){var e=this.options.url||"";return this.$el.empty().append(DIV({class:"xmonitor-limit"},DIV({class:"alert alert-danger"},Object(i.a)("m_monitor_constraint_1",this.model.count,this.model.limit)," ",Object(i.a)("m_monitor_constraint_2"),UL(LI(A({href:s.a.agents.local?"/ui/inbox.html":"/watchlist"},I({class:"fa fa-link"})," ",Object(i.a)("a_go_to_watchlist")),": ",Object(i.a)("m_monitor_constraint_3")),LI(A({href:e+"/settings/billing"},I({class:"fa fa-link"})," ",Object(i.a)("a_go_to_billing")),": ",Object(i.a)("m_monitor_constraint_4")))))),this}});t.a=r},function(e,t,n){"use strict";var i=n(5),a=n.n(i),s=n(7),r=n.n(s),o=n(8),l=n.n(o),c=n(24),d=n.n(c),h=n(39),u=n.n(h),p=n(6),f=n.n(p),m=n(43),v=n.n(m),g=n(44),b=n.n(g),w=n(51),y=n.n(w),x=n(52),O=n.n(x),S=n(53),D=n.n(S),T=n(2),E=n(15),k=n(0),L=n(13),j=n(1),R=n(3),N=n(4),C=n(14),V=n(23),M=n(10),U=n(16),$=n(26),F=n(12),H=n(40),Y=n(45),J=n(41),Q=n(9),q=(n(22),window.jQuery);if(!q)throw new Error("ADD jQuery");var W=window._;if(!W)throw new Error("ADD _");if(!window.domo)throw new Error("ADD domo");if(!window.async)throw new Error("ADD async");var z=N.a.ActionProvider.extend({events:{"keypress input":"event_load","click .xtbar .btn.xload":"event_loadFeed","click .xtbar .btn.xadd":"event_add"},event_add:function(e){if(this.feed){var t=this.url,n=this.feed.attributes;this.trigger("save",{name:n.title,uri:n.link,content_type:j.a.TYPE_FEED,config:{uri:t}})}else this.error("Feed could not be loaded or parsed.")},event_load:function(e){13==e.keyCode&&this.loadURL(this.$(".xurl").val())},event_loadFeed:function(e){var t=e.target.getAttribute("href");this.$(".xurl").val(t),this.$(".xtbar").empty(),this.loadURL(t)},error:function(e){this.$(".xmsg").addClass("xerror").text(e?Object(k.a)(e):"")},msg:function(e){this.$(".xmsg").removeClass("xerror").text(e?Object(k.a)(e):"")},loadURL:function(e){var t=this;this.msg(""),e.indexOf(":")<0&&(e="http://"+e),/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi.test(e)?(this.url=e,this.feedView&&this.feedView.remove(),this.$(".xtbar").empty(),this.msg("l_loading"),function(e,t){Q.a.agents.local?T.a.HTTP.get({url:e},t):q.get("/v1/http/get?url="+encodeURIComponent(e),(function(e,n,i){t(null,i.responseText,i)})).fail((function(){t("Error fetching resource: "+e)}))}(e,(function(e,n,i){if(e)t.error("e_load_source");else{var a=i.getResponseHeader("content-type");switch(a=a.split(";")[0]){case"text/html":case"application/xhtml+xml":t.msg("m_feed_finding");var s=new DOMParser,r=s.parseFromString(i.responseText,a);if(!r){var o=res.match(/<link.*\/>/gim).join("");r=s.parseFromString(o,a)}!function(e,t){if(!e)return t({code:"NULL",msg:"HTML document is null"});var n=e.querySelectorAll('link[type="application/rss+xml"],link[type="application/atom+xml"]'),i=W.map(n,(function(e){return{title:e.getAttribute("title"),href:e.getAttribute("href")}}));t(null,i)}(r,(function(e,n){if(0==n.length)t.error("e_feed_in_page_na");else if(1==n.length){var i=n[0].href;t.$(".xurl").val(i),t.loadURL(i)}else t.showFeedSelectionList(n)}));break;case"application/xml":case"text/xml":case"application/rss+xml":case"application/atom+xml":t.msg("Parsing feed..."),function(e,t,n){Q.a.agents.local?T.a.Feed.fromString(e,t,n):q.post("/v1/feed/json",{text:e},(function(e,t,i){n(200!=i.status?"Error parsing feed":null,e)}))}(i.responseText,t.url,t.onParsedFeed);break;default:t.error(Object(L.a)("e_unknown_content_type",a))}}}))):this.error("m_enter_valid_url")},onParsedFeed:function(e,t){this.msg(""),e?this.error(Object(k.a)("m_try_later")+" "+Object(k.a)("e_load_source")):(t=JSON.parse(JSON.stringify(t)),this.feed=new H.a.Feed(t,{parse:!0}),this.feedView&&this.feedView.remove(),this.feedView=new J.a.Feed({el:q("#feed")[0],model:this.feed,parent:this}).render(),this.$el.append(this.feedView.el),this.$(".xtbar").empty().append(BUTTON({class:"btn btn-primary xadd"},Object(k.a)("a_select"))))},render:function(){return this.$el.empty().append(DIV(DIV(INPUT({class:"form-control xurl",placeholder:Object(k.a)("m_enter_feed_url")})),DIV({class:"xmsg inline-block",style:"margin: 5px 0;padding: 0 5px;"}),DIV({class:"xtbar "}),DIV({class:"xpreview"}))),this},showFeedSelectionList:function(e){this.msg("m_feed_multi_selection"),this.$(".xtbar").empty().append(W.map(e,(function(e){return BUTTON({class:"btn btn-primary xload",href:e.href},Object(k.a)("Load feed")+" - "+e.title)})))}}),G=window.jQuery;if(!G)throw new Error("ADD jQuery");if(!window._)throw new Error("ADD _");if(!window.domo)throw new Error("ADD domo");if(!window.async)throw new Error("ADD async");var X=N.a.ActionProvider.extend({events:{"keypress input":"event_load","click .xtbar .btn.xadd":"event_add"},event_add:function(e){this.xml?this.trigger("save",{uri:this.url,content_type:j.a.TYPE_XML,config:{uri:this.url,selection:{excludes:[],includes:[{type:"xpath",expr:"/*"}]}}}):this.error("XML could not be loaded or parsed.")},event_load:function(e){13==e.keyCode&&this.loadURL(this.$(".xurl").val())},error:function(e){this.$(".xpreview").addClass("xerror").text(e?Object(k.a)(e):"")},msg:function(e){this.$(".xpreview").removeClass("xerror").text(e?Object(k.a)(e):"")},loadURL:function(e){var t=this;this.msg(""),e.indexOf(":")<0&&(e="http://"+e),/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi.test(e)?(this.url=e,this.$(".xtbar").empty(),this.msg("l_loading"),function(e,t){Q.a.agents.local?T.a.HTTP.get({url:e},t):G.get("/v1/http/get?url="+encodeURIComponent(e),(function(e,n,i){t(null,i.responseText,i)})).fail((function(){t("Error fetching resource: "+e)}))}(e,(function(e,n,i){if(e)t.error("e_load_source");else{var a=i.getResponseHeader("content-type");switch(a=a.split(";")[0]){case"application/xml":case"text/xml":case"application/rss+xml":case"application/atom+xml":t.msg("Parsing xml..."),t.onXML(i.responseText);break;default:t.error(Object(L.a)("e_unknown_content_type",a))}}}))):this.error("m_enter_valid_url")},onXML:function(e){var t=(new DOMParser).parseFromString(e,"text/xml");this.msg(""),t?(this.xml=t,this.$(".xpreview").text(e),this.$(".xtbar").empty().append(BUTTON({class:"btn btn-primary xadd"},Object(k.a)("a_select")))):(this.xml=null,this.error("Failed to parse XML"))},render:function(){return this.$el.empty().append(DIV(DIV(INPUT({class:"form-control xurl",placeholder:Object(k.a)("m_enter_xml_url")})),DIV({class:"xtbar "}),PRE({class:"xpreview",style:"max-height: 400px;overflow:auto;"}))),this}}),Z=n(48),K=n(47),ee=window._;if(!ee)throw new Error("ADD _");var te,ne=N.a.Base.extend({tagName:"div",events:{click:"event_click"},close:function(){this.loader&&this.loader.destroy()},event_click:function(){this.loader&&chrome.tabs.update(this.loader.tabId,{active:!0})},render:function(){return this.$el.text(Object(k.a)("h_opening_selector_in_new_tab")),setTimeout(this.renderTab,400),this},renderTab:function(){var e=this;T.a.createLoader({type:"tab",info:{active:!1,pinned:!1,after:"activeTab",url:e.model.get("uri")||"https://www.google.com"}},(function(t,n){e.loader=n,t?(console.error("err:",t),R.a.error("e_sel_na")):(e.loader=n,setTimeout((function(){chrome.tabs.update(n.tabId,{active:!0})}),600),T.a.openSelectorForTabLoader({loader:n,model:e.model.toJSON(),client:document},e.selectorCallback),e.$el.text(Object(k.a)("h_opened_selector_in_tab")))}))},selectorCallback:function(e,t){t&&(t=JSON.parse(JSON.stringify(t))),chrome.tabs.getCurrent((function(e){chrome.tabs.update(e.id,{active:!0})})),e?R.a.error(e.msg||e.message||e):t?(this.model.set(this.model.parse(t)),this.trigger("save",null,this.model),R.a.info("m_selection_saved")):(this.trigger("discard"),R.a.info("m_selection_discarded"))}}),ie=N.a.Modal.extend({name:"SelectorModal",title:Object(k.a)("l_visual_selector"),initialize:function(e){this.selector=new ne(ee.pick(e,"model","parent"));ee.defaults(e,{width:400,height:120,view:this.selector}),this.on("discard",(function(){e.onDiscard()})),N.a.Modal.prototype.initialize.call(this,e),this.listenTo(this.selector,"discard",e.onDiscard),this.listenTo(this.selector,"save",e.onSave)},remove:function(){ie.__super__.remove.call(this),this.selector.close()}}),ae={Modal:ie},se=n(38),re=function(e,t){for(var n=new RegExp(/(\"|\').*/),i=new RegExp(/.*(\"|\')$/),a=[],s=[],r=!1,o=null,l=e.split(" "),c=0;c<l.length;c++){var d=l[c];if(r){for(var h=c;h<l.length;h++)if(d=l[h],o.val=(o.val||"")+" "+d,d.match(i)){r=!1,c=h,o.val=o.val.replace('"',"");break}}else if(d.indexOf(":")>-1){null!=o&&(o.val=o.val.replace(/%22/g,'"'),s.push(o)),o={name:d.split(":")[0].trim(),val:""};var u=d.split(":")[1].trim();u&&(u.match(n)?(o.val=(o.val||"")+" "+u.match(n)[0].replace(/(\"|\')/gm,""),r=!0):o.val=(o.val||"")+" "+u)}else r?o.val=(o.val||"")+" "+u:a.push(d.replace(/%22/g,'"'))}null!=o&&(o.val=o.val.replace(/%22/g,'"'),s.push(o)),s.push({name:"keyword",val:a.join(" ")}),t(null,s)},oe=function(e,t,n){for(var i=new RegExp(/(\"|\').*/),a=new RegExp(/.*(\"|\')$/),s=[],r=[],o=!1,l=null,c=[],d=e.split(" "),h=0;h<d.length;h++){var u=d[h];if(o){for(var p=h;p<d.length;p++)if(u=d[p],l.val=(l.val||"")+" "+u,u.match(a)){o=!1,h=p,l.val=l.val.replace('"',"");break}}else if(u.indexOf(":")>-1){null!=l&&(l.val=l.val.replace(/%22/g,'"'),r.push(l)),l={name:u.split(":")[0].trim(),val:"",operator:""};var f=u.split(":")[1].trim();if(f&&(f.match(i)?(l.val=(l.val||"")+" "+f.match(i)[0].replace(/(\"|\')/gm,""),o=!0):l.val=(l.val||"")+" "+f),c.length>0){var m=c.pop();l.operator=m}}else o?l.val=(l.val||"")+" "+f:_.contains(t,u.toLowerCase())?c.push(u.replace(/%22/g,'"')):s.push(u.replace(/%22/g,'"'))}null!=l&&(l.val=l.val.replace(/%22/g,'"'),r.push(l)),r.push({name:"keyword",val:s.join(" ")}),n(null,r)},le=n(21);function ce(){var e=d()(["<span class='label label-info xlabel xlabel-small'>","</span>"]);return ce=function(){return e},e}function de(){var e=d()(["<span></span>"]);return de=function(){return e},e}function he(){var e=d()(["<span class= 'label label-danger xlabel xlabel-small'>Deleted</span>"]);return he=function(){return e},e}function ue(){var e=d()(["\n      <td data-action = 'void 0'>\n        <label class='xtd xdata xaction'>\n          <input type=\"checkbox\" style='margin:0;vertical-align:middle;'>\n        </label>\n      </td>\n      <td data-action = 'void 0'>\n        <button class='xtd xbtn xaction' style='margin: 0;' data-action= 'sieve context menu' data-action-param= '$parents [data-id]@data-id'>\n          <i class=\"fa fa-caret-down\"></i>\n        </button>\n      </td>\n      <td>\n        <a @click="," class='xtd xdata' href="," rel='noopener' target='_blank' title=",">\n          <img width= 14 src=","></img>\n          ","\n        </a>\n      </td>\n      <td data-action= 'sieve view' data-action-param=",">\n        <div class= 'xtd xdata xaction', title= 'Click to view history'>\n          <i class=\"xcaret fa fa-angle-double-down fa-lg\"></i>\n          ","\n          <span>\n            ","\n          </span>\n          <span>\n          ","\n          </span>\n        </div>\n      </td>\n      <td class= ",">\n        <a \n          class= 'xtd xdata xaction'\n          title= 'Click to edit schedule'\n          data-action= 'sieve schedule menu'\n          data-action-param= '$parents [data-id]@data-id'\n          data-toggle= 'tooltip'>\n            <small>",'</small>\n            <i class="xcaret fa fa-caret-down"></i>\n        </a>\n      </td>\n      <td>\n        <a\n        class= ',"\n        title= 'Click to view check/error log'\n        data-action= 'sieve log menu'\n        data-action-param= '$parents [data-id]@data-id'\n        data-toggle= 'tooltip'>\n          <small>","</small>\n          <i class=\"xcaret fa fa-caret-down\"></i>\n        </a>\n      </td>\n      <td style='padding: 0'>\n        <a\n        class= 'xtd xdata xaction xbtn'\n        title= 'Click to edit device'\n        data-action= 'sieve client menu'\n        data-action-param= '$parents [data-id]@data-id'\n        data-toggle= 'tooltip'\n        style= 'text-align:center'>\n          <i class=\"fa fa-lg ","\"  style= 'margin: auto;'></i>\n          <i class=\"xcaret fa fa-caret-down\"></i>\n        </a>\n      </td>\n      <td data-action= 'void 0' style= 'padding: 0'>\n        <button\n          class= ","\n          style= 'border-radius:0'\n          data-action= 'sieve switch'\n          data-action-param= '$parents [data-id]@data-id'\n          title= 'Turn monitor ON or OFF'\n          data-placement= 'left'>\n          ","\n        </button>\n      </td>\n    "]);return ue=function(){return e},e}function pe(){var e=d()(["\n                <td class='col-md-2'>\n                  <input\n                    style='width: 60px; padding: 0 10px;'\n                    .value=","\n                    placeholder=","\n                    @keyup=",">\n                  </input>\n                </td>\n                "]);return pe=function(){return e},e}function fe(){var e=d()(["<th class='col-md-2'>","</th>"]);return fe=function(){return e},e}function me(){var e=d()(["\n      <table>\n        <thead>\n          ","\n          <th></th>\n        </thead>\n        <tbody>\n          <tr>\n            ","\n            <td>\n              <div class='dropdown'>\n                <a href='#' data-toggle='dropdown'>Use Preset <i class='fa fa-caret-down'></i></a>\n                <ul class='dropdown-menu' @click=",">\n                  <li><a href='#' data-expr='0 9 * * 1-5'>Weekdays at 9am</a></li>\n                  <li><a href='#' data-expr='0 9-17 * * 1-5'>Weekdays between 9am to 5pm</a></li>\n                  <li><a href='#' data-expr='0 9 * * *'>All days at 9am</a></li>\n                  <li><a href='#' data-expr='0 9-17 * * *'>All days between 9am to 5pm</a></li>\n                </ul>\n              </div>\n            </td>\n          </tr>\n          <tr>\n            <td \n              style='width: 60px; padding: 0 12px;'\n              colspan=4><div class='help'>\n                ","\n              </div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    "]);return me=function(){return e},e}function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(n,!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be=window.diff_match_patch;if(!be)throw new Error("ADD diff_match_patch");var we=window.jQuery;if(!we)throw new Error("ADD jQuery");var _e=window._;if(!_e)throw new Error("ADD _");var ye=window.async;if(!ye)throw new Error("ADD async");if(!window.domo)throw new Error("ADD domo");var xe=window.moment;if(!xe)throw new Error("ADD moment");var Oe=window.Backbone;if(!Oe)throw new Error("ADD Backbone");var Se=window.feeddiff;if(!Se)throw new Error("ADD feeddiff");var Ie,De,Te,Ee,Ae,ke,Pe=["Sunday","Monday","Tuesday","Thursday","Friday","Saturday","Sunday"],Le=["","Jan","Feb","March","April","May","June","July","August","Sep","Oct","Nov","Dec"],je=function(e){function t(e){var n;return v()(this,t),(n=y()(this,O()(t).call(this,ge({},e.model.toJSON(),{params:e.model.get("schedule").toJSON().params})))).model=e.model,n.schedule=n.model.get("schedule"),n.el.classList.add("xtype-group"),n.el.classList.add("inline-block"),n}return D()(t,e),b()(t,[{key:"onChange",value:function(e,t){var n=["m","h","dm","mon","dw"].indexOf(e),i=ge({},this.state.params),a=i.expr.split(/\s/g);a[n]=t,i.expr=a.join(" "),this.state.params=i,5==a.length&&_e.all(a,(function(e){return e.length>0}))&&this.setModelParams(i)}},{key:"onPresetClick",value:function(e){e.preventDefault();var t=ge({},this.state.params);t.expr=e.target.dataset.expr,this.state.params=t,this.setModelParams(t)}},{key:"setModelParams",value:function(e){this.schedule.set("params",new Oe.Model(e))}},{key:"getDesc",value:function(e){var t=e.m,n=e.h,i=(e.dm,e.mon),a=e.dw;function s(e,t){if(t.includes(",")){var n=t.split(",").map((function(t){return s(e,t)})),i=n.pop();return"".concat(n.join(", ")," and ").concat(i)}if("*"==t)return"every ".concat(e);if(t.includes("-")){var a=t.split("-"),r=u()(a,2),o=r[0],l=r[1];return"month"==e&&(o=Le[o],l=Le[l]),"day-of-week"==e&&(o=Pe[o],l=Pe[l-1]),"every ".concat(e," from ").concat(o," through ").concat(l)}if(t.includes("/")){var c=t.split("/"),d=u()(c,2),h=d[0],p=d[1],f="every";if(p>1){f=p+(["","st","nd","rd"][p]||"th")}return"*"==h?h=null:"month"==e?h=Le[h]:"day-of-week"==e&&(h=Pe[h]),"every  ".concat(f," ").concat(e," ").concat(h?"from ".concat(h," through ").concat(""):"")}return"month"==e&&(t=Le[t],e=""),"day-of-week"==e&&(t=Pe[t],e=""),"".concat(e," ").concat(t)}try{return"At ".concat(s("minute",t)," past ").concat(s("hour",n)," on ").concat(s("day-of-week",a)," in ").concat(s("month",i))}catch(e){return console.error(e,arguments[0]),"Invalid expression"}}},{key:"createTpl",value:function(e){var t=this,n=e.params,i=n.expr,a=(n.tz||(new Date).getTimezoneOffset(),i.split(/\s/g)),s=u()(a,5),r={m:s[0],h:s[1],dm:s[2],mon:s[3],dw:s[4]},o=this.getDesc(r),l={m:"Minute",h:"Hour",dm:"Day",mon:"Month",dw:"Weekday"};return Object(le.b)(me(),_e.map(l,(function(e,t){return Object(le.b)(fe(),e)})),_e.map(l,(function(e,n){return Object(le.b)(pe(),r[n],e,(function(e){return t.onChange(n,e.target.value)}))})),(function(e){return t.onPresetClick(e)}),o)}},{key:"remove",value:function(){}},{key:"render",value:function(){return this}}]),t}(le.a),Re={snipped:!1,removed:!1},Ne={},Ce=N.a.Base.extend({name:"SieveRuleEditor",className:"xtype-group",postInit:function(){this.paramsModel=new Oe.Model(this.model.rule.params)},getConfig:function(){return{type:j.a.TYPE_RULE,contentType:this.getContentType(),rule:{type:this.getRuleType(),params:this.getParams()}}},getContentType:function(){return parseInt(this.selContentType.value)},getParams:function(){var e=_e.pluck(this.getRuleDesc().params,"name"),t=this.paramsModel.toJSON();return _e.pick.apply(_e,l()([t].concat(e)))},getRuleDesc:function(){return _e.findWhere(V.a.DescList,{type:this.getRuleType()})||{type:0,lable:"l_rule_unknown",params:[]}},getRuleType:function(){return parseInt(this.selRuleType.value)},onTypeChange:function(){this.renderParams()},render:function(){var e;return this.$el.append(this.selContentType=SELECT.apply(window,_e.map(V.a.ContentList,(function(e){return OPTION({value:e.type},Object(k.a)(e.label))}))),this.selRuleType=SELECT.apply(window,_e.map(V.a.DescList,(function(e){return OPTION({value:e.type},Object(k.a)(e.label))}))),e=DIV({style:"margin-top: 4px;"})),this.selContentType.value=this.model.contentType,this.selRuleType.value=this.model.rule.type,this.$elParams=we(e),this.renderParams(),we(this.selRuleType).change(this.onTypeChange),this},renderParams:function(){var e=this.$elParams,t=this.paramsModel,n=this.getRuleDesc();if(!n)throw new Error("Unknown rule desc:"+this.getRuleType());e.empty();var i=_e.map(n.params,(function(e){return C.a.create(e.type,{param:e,parent:this,model:t}).render().el}),this);e.append(i)}}),Ve=N.a.Base.extend({name:"SieveRuleGroupEditor",tagName:"fieldset",className:"xrulegroup",postInit:function(){this.editors=[]},addOne:function(e){e.type==j.a.TYPE_RULE?this.addRule(e):e.type==j.a.TYPE_RULE_GROUP&&this.addRuleGroup(e)},addEditor:function(e,t){var n,i,a=this;this.$list.append(i=DIV({class:"row"},DIV({class:"col-md-1"},n=BUTTON({class:"btn xbtn-light"},I({class:"fa fa-trash-o"}))),DIV({class:"col-md-11",style:"padding-left: 0"},e.el))),we(n).click((function(){e.remove(),i.remove(),a.editors.splice(_e.indexOf(a.editors,e),1)})),this.editors.push(e)},addRule:function(e){e||(e=this.defaultRule());var t=new Ce({model:e,parent:this}).render();this.addEditor(t,!1)},addRuleGroup:function(e){e||(e=this.defaultRuleGroup());var t=new Ve({model:e,parent:this}).render();t.setConfig(e),this.addEditor(t,!0)},defaultRule:function(){return{type:j.a.TYPE_RULE,contentType:j.a.CONTENT_TYPE_CHANGED_TEXT,rule:{type:j.a.RULE_HAS_TEXT,params:{input:""}}}},defaultRuleGroup:function(){return{type:j.a.TYPE_RULE_GROUP,op:j.a.OP_AND,rules:[this.defaultRule()]}},getConfig:function(){return{type:j.a.TYPE_RULE_GROUP,op:parseInt(this.selOp.value),rules:_e.map(this.editors,(function(e){return e.getConfig()}))}},isEmpty:function(){return 0==this.editors.length},onAddClick:function(e){var t=e.target.getAttribute("tag");t&&(t==j.a.TYPE_RULE?this.addRule():t==j.a.TYPE_RULE_GROUP&&this.addRuleGroup())},render:function(){var e,t;return this.$el.append(LEGEND(Object(k.a)("l_rule_true_if_matches_x")+" ",this.selOp=SELECT(OPTION({value:j.a.OP_AND},Object(k.a)("l_all")),OPTION({value:j.a.OP_OR},Object(k.a)("l_any")))," "+Object(k.a)("l_x_of_following_rules")+":",t=DIV({class:"btn-group xadd-rule right"},BUTTON({class:"btn btn-default btn-xs",tag:j.a.TYPE_RULE},I({class:"fa fa-plus"})," ",Object(L.a)("a_action_object","a_add","l_rule")),BUTTON({class:"btn btn-default btn-xs dropdown-toggle","data-toggle":"dropdown"},SPAN({class:"caret"})),UL({class:"dropdown-menu",role:"menu"},LI(A({tag:j.a.TYPE_RULE_GROUP,tabindex:-1,href:"javascript:void 0"},Object(L.a)("a_action_object","a_add","l_rule_group")))))),e=DIV()),we(t).click(this.onAddClick),this.$list=we(e),this},setConfig:function(e){this.selOp.value=e.op,_e.each(this.editors,(function(e){e.remove()})),this.editors=[],_e.each(e.rules,this.addOne)}}),Me=N.a.ActionProvider.extend({name:"SieveRulesEditor",actions:{add_condition:{fn:"action_add"}},action_add:function(){this.ruleView.addRule(),this.renderRules()},duplicate:function(e){var t=this,n=new F.a.SieveRule({id:e});n.fetch({success:function(){t.model.set(_e.omit(n.attributes,"id","ts","ts_mod")),t.onLoad()}})},postInit:function(e){this.model.isNew()||(this.loading=!0,this.model.fetch({success:this.onLoad,error:this.onError})),this.ruleView=new Ve({parent:this}).render()},onError:function(){this.loading=!1,this.$body.empty(),this.$body.append(Object(k.a)("e_req")," ",Object(k.a)("h_try_later"))},onLoad:function(){this.loading=!1,this.ruleView.setConfig(this.model.get("config")),this.renderRules()},render:function(){var e;return this.$el.append(e=DIV({style:"max-height: 600px; overflow-y: auto; overflow-x:hidden;"})),this.$body=we(e),this.loading?this.$body.text(Object(k.a)("l_loading")):this.renderRules(),this},renderRules:function(){var e=this.$body;e.empty(),this.ruleView.isEmpty()?e.append(A({href:"#","data-action":"add_condition"},Object(L.a)("a_action_object","a_add","l_rule"))):e.append(this.ruleView.el)},updateModel:function(){var e=this.ruleView.getConfig();this.model.set("config",e)}}),Ue=N.a.Base.extend({name:"SieveActionEditor",postInit:function(){this.listenTo(this.model,"remove",this.remove),this.paramsModel=new Oe.Model(this.model.get("config")),this.listenTo(this.paramsModel,"change",this.onEditParams)},onDelete:function(){this.model.collection.remove(this.model)},onEditParams:function(){this.model.set("config",this.paramsModel.toJSON())},render:function(){var e,t,n,i,a=this.model.desc;a.single?this.$el.css({"margin-left":30,"line-height":0}):(this.$el.append(n=A({class:"btn fa fa-trash-o xbtn-light",style:"vertical-align: top;margin-top: 5px;",href:"javascript:void 0",title:Object(k.a)("h_del_action")})),n.onclick=this.onDelete);(this.$el.append(e=DIV({style:"display:inline-block;width:80%; margin-bottom: 5px;"})).css({position:"relative",overflow:"visible"}),t=this.paramEditors=_e.map(a.params,(function(t){var n=C.a.create(t.type,{param:t,parent:this,model:this.paramsModel});return e.appendChild(n.render().el),t.must||n.$el.hide(),n}),this),_e.any(a.params,(function(e){return!e.must})))&&(e.appendChild(i=BUTTON({class:"btn btn-default btn-xs xbtn-light"},Object(k.a)("l_options"))),i.onclick=function(){_e.each(t,(function(e){e.$el.show()})),we(i).remove()});return a.plugin&&a.plugin(this),this}}),$e=N.a.Base.extend({name:"SieveActionGroup",className:"xtype-group",postInit:function(e){this.desc=e.desc,this.actions=e.actions,this.views={},this.listenTo(this.actions,"add",this.addOne),this.listenTo(this.actions,"remove",this.onActionRemove)},addOne:function(e){if(null==this.views[e.cid]&&e.desc.type==this.desc.type){var t=new Ue({model:e,parent:this}).render();this.$list.append(t.el),this.views[e.cid]=t}},isVoid:function(e){return this.desc.single||0==this.desc.params.length},onActionAdd:function(){this.actions.add(new F.a.SieveAction[this.desc.type])},onActionRemove:function(e,t){0==this.actions.where({type:this.desc.type}).length&&this.remove()},onDelete:function(){var e=this.actions.where({type:this.desc.type});_e.each(e,(function(e){this.actions.remove(e)}),this)},render:function(){var e,t,n=this.desc;return this.$list=we(DIV()),n.single&&(this.$el.append(t=BUTTON({class:"btn fa fa-trash-o xbtn-light",title:Object(k.a)("h_del_action")})),t.onclick=this.onDelete),n.single||(this.$el.append(e=BUTTON({class:"btn fa fa-plus xbtn-light pull-right"})),e.onclick=this.onActionAdd),this.$el.append(SPAN({style:""},SPAN(Object(k.a)(n.label)),this.$list[0])),this.actions.each(this.addOne),this}}),Be=N.a.ActionProvider.extend({name:"SieveActionsEditor",postInit:function(e){this.actionGroups={},this.dels=[],this.sieve=e.sieve,this.actions=e.actions,this.listenTo(this.actions,"add",this.addOne),this.listenTo(this.actions,"remove",this.onActionRemove),this.listenTo(this.actions,"reset",this.render)},addOne:function(e){var t=e.desc,n=t.type;if(this.$emptyEl.remove(),!this.actionGroups[n]){var i=this.actionGroups[n]=new $e({actions:this.actions,desc:t,parent:this}).render();this.listenTo(i,"remove",(function(){delete this.actionGroups[n]}),this),this.$list.append(i.el)}},getChanges:function(){return{dels:this.dels,posts:this.getPosts(),puts:this.getPuts()}},getPosts:function(){return this.actions.filter((function(e){return e.isNew()}))},getPuts:function(){return this.actions.filter((function(e){return!e.isNew()&&e.hasChanged()}))},onAddActionMenuClick:function(e){var t=we(e.currentTarget).attr("tag"),n=F.a.SieveAction[t];n.desc.single&&this.actions.where({type:n.desc.type}).length>0?R.a.info("m_action_can_add_only_one"):(this.actions.add(new n(null,{parent:this.sieve})),e.preventDefault())},onActionRemove:function(e){e.isNew()||this.dels.push(e)},render:function(){var e;return this.reset(),this.$emptyEl=we(DIV({class:"alert alert-warning hide"},"No action added - add one to get alerted on changes")),this.$list=we(DIV()),this.$el.empty().append(DIV({style:"position: relative;"},A({id:"menu_add_action",class:"dropdown-toggle","data-toggle":"dropdown",href:"javascript:void 0"},Object(k.a)("a_add_action")," ",B({class:"caret"}))," ",e=UL({class:"dropdown-menu",role:"menu","aria-labelledby":"menu_add_action",style:"z-index: 2000"}),DIV({class:"right",style:"margin-left:10px;"})),this.$emptyEl,DIV({style:"max-height: 360px;overflow-y:auto;overflow-x-hidden;"},this.$list[0])),_e.each(F.a.SieveActionDescList,(function(t){e.appendChild(LI(A({tag:t.type,tabindex:-1,href:"javascript:void 0"},I({class:"fa "+t.icon}),SPAN({style:"margin-left: 10px;"},Object(k.a)(t.label),t.paid?" *":""))))})),e.appendChild(LI({class:"disabled"},A({href:"#"},"* "+Object(k.a)("m_premium_only")))),we(e).find("a").click(this.onAddActionMenuClick),this.actions.each(this.addOne),this.$emptyEl[0==this.actions.length?"removeClass":"addClass"]("hide"),this},reset:function(){_e.each(this.actionGroups,(function(e){e.remove()})),this.actionGroups={},this.dels=[]}}),Fe=N.a.ActionProvider.extend({name:"SieveIntervalScheduleEditor",convertToSlider:function(e){return Math.log(e)},convertToModel:function(e){return Math.round(Math.pow(Math.E,e))},focus:function(){this.textInput.focus()},getSliderValue:function(){return this.convertToModel(this.$slider.val())},setSliderValue:function(e){this.$slider.slider("setValue",this.convertToSlider(e))},remove:function(){this.$slider.data("slider")&&this.$slider.slider("destroy"),Fe.__super__.remove.call(this)},render:function(){var e=this.model.get("schedule"),t=e.get("params").get("interval"),n=this.convertToSlider(t);return this.$el.empty().append(DIV({style:"display:flex;min-width:420px;margin-bottom:25px;"},this.slider=INPUT({style:"width:100%;",value:n}),this.textInput=INPUT({class:"xschdlr-input"})),SPAN({class:"help"},this.constraint=SPAN({style:"color: red; display: none;"},Object(k.a)("h_schedule_constraint_1"),Object(k.a)(e.formatInterval(USER.constraint.interval,!1)+"."),BR(),Object(k.a)("h_schedule_constraint_2"),A({href:"https://distill.io/pricing",target:"_blank"},"Upgrade Account"))),P({class:"help"},Object(k.a)("h_schedule_interval"))),this.$constraint=we(this.constraint),this.$slider=we(this.slider).slider({min:1.6,max:14.78,step:.05,tooltip:"hide",value:n,ticks:[1.6,3.4,5.7,8.3,11.55,14.78],ticks_positions:[0,13.657,31.107,50.834,75.493,100],ticks_labels:["5s","30s","5m","1h","1d","Never"],ticks_snap_bounds:0}).on("slide",this.updateValue).on("slideStop",this.updateModel),this.$textInput=we(this.textInput).on("change",this.textInputChanged).on("focus",(function(){this.select()})),this.updateValue(),this},textInputChanged:function(){var e=Dt(this.$textInput,"m",3600);this.setSliderValue(e),this.updateValue(),this.updateModel()},updateModel:function(){this.updateValue();var e=this.model.get("schedule");this.model.trigger("change"),this.model.trigger("change:schedule",e)},updateValue:function(){var e=this.getSliderValue(),t=this.model.get("client_id"),n=this.model.get("schedule"),i=n.get("params"),a=USER&&USER.constraint,s=a&&a.interval||5;t==$.a.Clients.webAppId&&e<s?(i.set("interval",USER.constraint.interval),this.$constraint.css("display","block")):(i.set("interval",e),this.$constraint.css("display","none")),this.$textInput.val(n.getShortDisplayText())}}),He=N.a.ActionProvider.extend({name:"SieveLiveScheduleEditor",render:function(){return this.$el.append(DIV("Use it only if page auto-updates content using JavaScript."),DIV({class:"help"},Object(k.a)("l_schedule_live_desc"))),this}}),Ye=N.a.ActionProvider.extend({name:"SieveRandomScheduleEditor",render:function(){var e=this.model.get("schedule").get("params");return this.$el.empty().append(DIV(SPAN("Min: "),this.minInput=INPUT({class:"xschdlr-input"}),SPAN({style:"margin-left: 20px;"},"Max: "),this.maxInput=INPUT({class:"xschdlr-input"})),SPAN({class:"help"},this.constraint=SPAN({style:"color: black; display: none;"},Object(k.a)("h_schedule_constraint_1"),Object(k.a)(USER.constraint.interval+" seconds. "),BR(),Object(k.a)("h_schedule_constraint_2"),A({href:"https://distill.io/pricing",target:"_blank"},"Upgrade Account"))),P({class:"help"},Object(k.a)("h_schedule_random"))),this.$constraint=we(this.constraint),(this.$minInput=we(this.minInput)).val(e.get("min")),(this.$maxInput=we(this.maxInput)).val(e.get("max")),we([this.minInput,this.maxInput]).on("change",this.updateModel),this.updateValue(),this},updateModel:function(){this.updateValue();var e=this.model.get("schedule");this.model.trigger("change"),this.model.trigger("change:schedule",e)},updateValue:function(){if(Dt(this.$minInput,"s")>Dt(this.$maxInput,"s"))var e=Math.max(this.model.get("client_id")==$.a.Clients.webAppId?USER.constraint.interval:5,Dt(this.$minInput,"s")+1);else e=Math.max(this.model.get("client_id")==$.a.Clients.webAppId?USER.constraint.interval:5,Dt(this.$maxInput,"s"));var t=Math.max(this.model.get("client_id")==$.a.Clients.webAppId?USER.constraint.interval:5,Dt(this.$minInput,"s")),n=this.model.get("schedule").get("params"),i=this.model.get("client_id"),a=USER&&USER.constraint;a&&a.interval;n.set("min",t),n.set("max",e),this.$minInput.val(t),this.$maxInput.val(e),i==$.a.Clients.webAppId?this.$constraint.css("display","block"):this.$constraint.css("display","none")}}),Je=N.a.ActionProvider.extend({name:"SieveScheduleEditor",EDITORS:{INTERVAL:Fe,LIVE:He,RANDOM:Ye,CRON:je},focus:function(){},render:function(){var e,t,n=this,i=this.model.get("schedule").get("type"),a=(Q.a.agents.local,this.model.get("schedule"),new this.EDITORS[i](_e.extend({parent:this},this.options)));return this.$el.css({display:"flex","flex-direction":"row"}).empty().append(DIV(e=SELECT({style:"margin-right: 20px;"},OPTION({value:"INTERVAL"},"Interval"),OPTION({value:"RANDOM"},"Random"),OPTION({value:"LIVE"},"Live (beta)"),USER.account_id?OPTION({value:"CRON"},"Crontab *"):OPTION({value:"CRON",disabled:""},"Crontab *"),OPTION({value:"",disabled:""},"*For Enterprise"))),t=DIV({style:"flex:1"},a.render().el)),we(e).val(i).on("change",(function(){var i=e.value,s=new F.a.Schedule({type:i});"RANDOM"==i&&s.get("params").set({min:60,max:120}),"CRON"==i&&s.get("params").set({expr:"* * * * *",tz:(new Date).getTimezoneOffset()}),a.remove(),n.model.set("schedule",s),n.model.trigger("change:schedule",s),a=new n.EDITORS[i](_e.extend({parent:n},n.options)),we(t).empty().append(a.render().el)})),this}}),Qe=N.a.ActionProvider.extend({name:"HTMLSelector",render:function(){return this.selectorModal=new ae.Modal({model:this.model.clone(),parent:this,onDiscard:this.onSelectorDiscard,onSave:this.onSelectorSave}),this.selectorModal.show(),this},onSelectorDiscard:function(){this.trigger("discard"),this.selectorModal.remove()},onSelectorSave:function(e,t){e?(R.a.error("Error running visual selector: "+e),this.trigger("error",e)):this.trigger("save",_e.pick(t.toJSON(),"uri","name","config","content_type")),this.selectorModal.remove()}}),qe=N.a.ActionProvider.extend({name:"PDFSelector",postInit:function(){this.editor=C.a.create("url",{param:{label:"m_enter_pdf_url",must:!0,name:"uri"},parent:this}).render(),this.listenTo(this.editor,"change",this.save)},save:function(){var e=this.editor.getValue(),t=e.split("/"),n=t[t.length-1],i={name:n+(n.match(/\.pdf$/)?"":" pdf"),uri:e,content_type:j.a.TYPE_PDF_HTML,config:{uri:e}};this.trigger("save",i)},render:function(){return this.$el.empty().append(this.editor.el),this}}),We=N.a.ActionProvider.extend({name:"DOCSelector",postInit:function(){this.editor=C.a.create("url",{param:{label:"m_enter_doc_url",must:!0,name:"uri"},parent:this}).render(),this.listenTo(this.editor,"change",this.save)},save:function(){var e=this.editor.getValue(),t=e.split("/"),n=t[t.length-1],i={name:n+(n.match(/\.docx?$/)?"":" doc"),uri:e,content_type:j.a.TYPE_DOC,config:{uri:e}};this.trigger("save",i)},render:function(){return this.$el.empty().append(this.editor.el),this}}),ze=N.a.ActionProvider.extend({name:"SieveSourceSelector",postInit:function(){var e,t=this.model,n=this;switch(this.model.get("content_type")){case j.a.TYPE_HTML:e=new Qe({parent:this,model:t});break;case j.a.TYPE_FEED:e=new z({parent:this,model:t});break;case j.a.TYPE_XML:e=new X({parent:this,model:t});break;case j.a.TYPE_PDF_HTML:e=new qe({parent:this,model:t});break;case j.a.TYPE_DOC:e=new We({parent:this,model:t});break;default:throw new Error("Unknown content_type")}e.on("save",(function(e){n.trigger("save",e)})),e.on("discard",(function(){n.trigger("discard")})),this.view=e},render:function(){return this.$el.append(this.view.render().el),this}}),Ge=function(e,t,n){var i=C.a.create("json",{param:{label:"l_selection_config",must:!1,name:"config",type:"json"},model:new Oe.Model({config:e.get("config").toJSON()})}),a=new N.a.SaveDiscardModal({name:"SieveSourceEditor$ConfigModal",title:t,view:i});function s(t){return new(0,e.get("config").constructor)(t,{parse:!0})}a.on("save",(function(){var t=i.model.get("config");e.set({config:s(t)}),n(a)})),a.on("discard",(function(){a.remove()})),a.show(),i.$el.find("textarea").css("height",300)},Xe=N.a.ActionProvider.extend({name:"SieveSourceEditor",actions:{edit_url:{fn:"action_edit_url"},force_static:{fn:"action_force_static"},selector_config_show:{fn:"action_config_show"},selector_edit:{fn:"action_selector_edit"}},action_config_show:function(){Ge(this.model,Object(k.a)("l_selection_config"),(function(e){e.remove()}))},action_edit_url:function(){var e=this.model,t=C.a.create("url",{param:{label:"l_url",must:!0,name:"uri"},model:e.clone(),parent:this}),n=new N.a.SaveDiscardModal({name:"SieveSourceEditor$URLModal",parent:this,title:Object(k.a)("l_url"),view:t});n.show(),n.on("save",(function(){e.set({uri:t.getValue()}),n.remove()})),n.on("discard",(function(){n.remove()}))},action_force_static:function(){var e=this.model,t=e.get("config").get("selections");(t&&t.at(0)).set("dynamic",!1),this.checkURI(e),e.trigger("change")},action_selector_edit:function(){this.sourceSelector?this.onSourceSelectorDiscard():this.openSelector()},checkURI:function(e){if(e.get("content_type")==j.a.TYPE_HTML){var t=e.get("uri"),n=e.get("config").get("selections").at(0),i=Q.a.tabForXFrame,a=Q.a.tabForDynamic,s=this.elXFrameNotice;if(!t||!1===n.get("dynamic")||!Q.a.agents.local||!i&&!a)return we(s).addClass("hide");a?we(s).removeClass("hide"):i&&T.a.HTTP.get({url:t},(function(e,t,n){if(e)return R.a.error("Failed to fetch URL.");(n.getResponseHeader("x-frame-options")||/x-frame-options/i.test(t))&&we(s).removeClass("hide")}))}},onSourceSelectorSave:function(e){e.config=this.parseConfig(JSON.parse(e.config)),this.model.get("name")&&delete e.name,this.model.set(e),this.sourceSelector.remove(),this.sourceSelector=null},onSourceSelectorDiscard:function(){this.sourceSelector.remove(),this.sourceSelector=null,this.model.isNew()&&App.navBack()},openSelector:function(){this.sourceSelector=new ze({parent:this,model:this.model}),this.listenTo(this.sourceSelector,"save",this.onSourceSelectorSave),this.listenTo(this.sourceSelector,"discard",this.onSourceSelectorDiscard),this.sourceSelector.render(),this.elSelector.appendChild(this.sourceSelector.el),this.sourceSelector.$el.css({padding:10})},parseConfig:function(e){return new(0,this.model.get("config").constructor)(e,{parse:!0})},postInit:function(){var e=this.model;this.listenTo(e,"change:config change:uri",this.render),e.isEmpty()&&_e.defer(this.openSelector),this.elXFrameNotice=DIV({class:"alert alert-info hide",style:"margin: 5px 0; padding: 5px;"},Object(k.a)("m_xframe_notice")," ",BUTTON({class:"btn btn-default btn-xs","data-action":"force_static"},Object(k.a)("a_static_load"))," ",A({href:"https://distill.io/help/new-tab-chrome-extension"},Object(k.a)("Learn More"))),this.listenTo(e,"change:uri",this.checkURI),this.checkURI(e)},render:function(){return this.$el.empty().append(DIV(DIV({class:"btn-group",role:"group"},BUTTON({type:"button",class:"btn btn-default","data-action":"selector_edit",title:Object(k.a)("h_selector_edit")},Object(k.a)("a_open_selector")),BUTTON({class:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},SPAN({class:"caret"})),UL({class:"dropdown-menu"},LI(A({"data-action":"selector_config_show",href:"javascript:void 0"},Object(k.a)("h_config_show")))))," ",BUTTON({class:"btn btn-default","data-action":"edit_url"},Object(k.a)("a_edit")," ",this.model.get("uri"))),this.elXFrameNotice,this.elSelector=DIV()),this}}),Ze=N.a.Base.extend({name:"TagsEditor",events:{"click :checkbox":"event_check"},event_check:function(e){var t=e.target,n=t.dataset.id,i=t.checked,a=App.labels.get(n);i?this.tags.push(a):this.tags=_e.without(this.tags,a),this.model.set("tags",_e.pluck(this.tags,"id").join(","))},postInit:function(){this.tags=this.model.getTags(App.labels)},render:function(){var e=this;return App.labels.length>0?this.$el.append(_e.map(App.labels.models,(function(t){var n=INPUT({type:"checkbox",style:"vertical-align: top;","data-id":t.id}),i=LABEL({style:"font-weight:normal;margin-right:8px; "},n,t.get("name"));return e.tags.indexOf(t)>=0&&(n.checked=!0),i}))):this.$el.append("No label found."),this}}),Ke=N.a.ActionProvider.extend({name:"SieveOptions",actions:{sieve_save:{fn:"action_save"}},action_save:function(e,t){var n=this,i=this.model;R.a.start("sieve:save",{info:"saving"}),we(t).button("loading"),ye.series([function(e){var t=n.rulesEditor.model;if(n.rulesEditor.updateModel(),t.isNew()&&t.isEmpty())return e();R.a.start("sieve:rule:save",{info:"l_loading"}),t.save(null,{error:function(t,n){R.a.stop("sieve:rule:save",{error:"e_req"}),e({msg:"Failed to save conditions",err:n})},success:function(){i.get("rule_id")!=t.id&&i.set({rule_id:t.id},{silent:!0}),R.a.stop("sieve:rule:save"),e()}})},function(e){var t=_e.omit(i.toJSON(),"err","text","ts","ts_data","ts_mod","ts_view","user_id");t.state==j.a.STATE_INIT&&(t.state=j.a.STATE_READY),i.save(null,{data:t,patch:!0,silent:!0,wait:!0,error:function(t,n){R.a.stop("sieve:save",{error:"Failed to save changes to server"}),e({msg:"Failed to save changes",err:n})},success:function(t){R.a.stop("sieve:save"),e(null)}})},function(e){var t=n.actionEditor.getChanges();U.a.syncBatch(t,e)||e()}],(function(e,i){we(t).button("reset"),e?R.a.error("Failed to save data. Please check console for more info."):(n.trigger("save"),App.navBack())}))},duplicate:function(e){var t=this.collection.get(e),n=_e.pick(t.toJSON(),"name","uri","config","client_id","content_type","schedule","tags");n.name="Copy of "+n.name,this.setModel(new this.collection.model(n,{parse:!0}),{defaultsModel:t,editURL:!0,skipSelector:!0})},edit:function(e){var t=this;this.fetch(e,(function(e,n){e?(t.action_discard(),R.a.error("Failed to get data")):t.setModel(n)}))},editNew:function(e){var t=0;switch(e){case"page":t=j.a.TYPE_HTML;break;case"feed":t=j.a.TYPE_FEED;break;case"xml":t=j.a.TYPE_XML;break;case"pdf":t=j.a.TYPE_PDF_HTML;break;case"doc":t=j.a.TYPE_DOC;break;default:throw R.a.error("Unknown monitor type: "+e),new Error("Unknown monitor type: "+e)}this.setModel(new F.a.Sieve({content_type:t},{parse:!0}))},fetch:function(e,t){new F.a.Sieve({id:e}).fetch({error:function(e,n){t(n)},success:function(e,n){e.changed={},t(null,e)}})},initEditors:(Ee=r()(a.a.mark((function e(t,n){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new F.a.SieveActions(null,{parent:t}),s=new F.a.SieveRule({id:t.get("rule_id")||void 0}),this.sourceEditor=new Xe({model:t,parent:this,className:"controls"}).render(),this.clientSelector=new Y.a.ClientSelector({model:t,parent:this}).render(),this.nameEditor=C.a.create("text",{model:t,param:{label:"l_name",must:!0,name:"name",type:"text"},parent:this}).render(),this.scheduleEditor=new Je({model:t,parent:this}).render(),this.actionEditor=new Be({actions:i,sieve:t,parent:this}).render(),this.rulesEditor=new Me({model:s,parent:this}).render(),this.tagsEditor=new Ze({model:t,parent:this}).render(),e.next=11,Promise.all([i.fetch(),s.fetch()]);case 11:this.loadDefaults(t,i,n);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ee.apply(this,arguments)}),createDefaults:function(e,t,n){var i=this,a=e.get("uri"),s=a&&new URL(a).hostname,r=new F.a.Sieves;if(_e.isEmpty(e.get("name"))&&a&&(e.set("name",Object(k.a)("l_loading")),we.get(URL_ROOT+"/v1/http/get?html_css_filter=title&url="+encodeURIComponent(a),(function(t){t&&e.set("name",we(t).text().trim()||"Untitled")}))),n)return o(n,!0);function o(n,a){var s=new F.a.SieveActions(null,{parent:n});s.fetch({data:{state:0},success:function(){s.each((function(e){var n=e.omit("id","sieve_id","ts","ts_mod");t.add(new F.a.SieveAction[n.type](n,{parse:!0}))})),i.onChanges()}});var r=n.get("schedule");"LIVE"==r.get("type")&&(r=new F.a.Schedule({type:"INTERVAL"})),e.set("schedule",r),i.scheduleEditor.render();var o=n.get("rule_id");a&&o&&i.rulesEditor.duplicate(o)}r.fetch({data:{"uri.like":"%"+s+"%","state.in":[j.a.STATE_READY,j.a.STATE_PAUSED],_opt:{limit:1,order:["-ts"],only:["id","schedule","tags"]}},success:function(){if(r.length>0)return o(r.at(0),!1);r.fetch({data:{"state.in":[j.a.STATE_READY,j.a.STATE_PAUSED],_opt:{limit:1,order:["-ts"],only:["id","schedule","tags"]}},success:function(){r.length>0?o(r.at(0),!1):(_e.each(F.a.SieveActionDescList,(function(e){e.addByDefault(Q.a)&&t.add(new F.a.SieveAction[e.type])})),i.onChanges())}})}})},loadDefaults:function(e,t,n){e.isNew()||e.get("state")==j.a.STATE_INIT?this.createDefaults(e,t,n):t.fetch({data:{state:0}})},postInit:function(e){this.clients=e.clients},showProgress:function(){this.$(".xprogress").show()},removeProgress:function(){this.$(".xprogress").hide()},render:function(){return this.$el.empty().append(DIV({class:"xtbar xvbar-margin"},BUTTON({class:"btn btn-default","data-action":"go_back"},I({class:"fa fa-chevron-left"})," ",Object(k.a)("a_discard")," ",this.elUnsavedMsg=SPAN())),DIV({class:"xpage-header"},H3(this.elHeading=SPAN())),DIV({class:"xprogress",style:"margin-top: -2px;position:absolute;"},DIV({class:"xindeterminate"})),DIV({class:"form-horizontal",style:"padding: 10px;"},this.elContent=DIV())),this},renderOptions:function(){var e=this.model;this.model.getTags(App.labels);we(this.elHeading).empty().append(Object(k.a)("l_options")," - ",e.isNew()?Object(k.a)("l_add_monitor"):e.get("name")),we(this.elContent).empty().append(DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(k.a)("l_source")),DIV({class:"col-md-10"},this.sourceEditor.el,P({class:"help"},Object(k.a)("h_sieve_source")))),DIV({class:"form-group"},LABEL({class:"control-label col-md-2",for:"sieve-device"},Object(k.a)("l_device")),DIV({class:"col-md-10"},this.clientSelector.el,P({class:"help"},Object(k.a)("h_sieve_device")))),DIV({class:"form-group"},LABEL({class:"control-label col-md-2",for:"sieve-name"},Object(k.a)("l_name")),DIV({class:"col-md-10"},this.nameEditor.el,P({class:"help"},Object(k.a)("h_sieve_name")))),DIV({class:"form-group"},LABEL({class:"control-label col-md-2",for:"sieve-schedule"},Object(k.a)("l_schedule")),DIV({class:"col-md-10"},this.scheduleEditor.el)),DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(k.a)("l_actions")),DIV({class:"col-md-10"},this.actionEditor.el,P({class:"help"},Object(k.a)("h_sieve_actions")))),DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(k.a)("l_conditions")),DIV({class:"col-md-10"},this.rulesEditor.el,P({class:"help"},Object(k.a)("h_sieve_rules")))),DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(k.a)("l_label")),DIV({class:"col-md-10"},this.tagsEditor.el)),DIV({class:"form-group"},DIV({class:"col-md-offset-2 col-md-10 xtbar-form"},BUTTON({class:"btn btn-primary xbtn-default","data-action":"sieve_save"},Object(k.a)("a_save")),BUTTON({class:"btn btn-default","data-action":"go_back"},Object(k.a)("a_discard")))))},onChanges:function(){},onModelSelect:function(e){var t=(App.sieveList.routePrefix||"").split("/"),n=App.labels.findByName(decodeURIComponent(t[1])),i=new this.collection.model(_e.defaults(e,{client_id:this.clients.defaultId,schedule:{type:"INTERVAL",params:{interval:10800}},tags:n?n.id:null,version:1}),{parse:!0});this.setModel(i,{skipSelector:!0})},onSourceSelectorDiscard:function(){this.sourceSelector.remove(),App.navBack()},setModel:(Te=r()(a.a.mark((function e(t){var n,i,s,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{skipSelector:!1,defaultsModel:null,editURL:!1},this.showProgress(),i={},this.model&&this.stopListening(this.model),this.model=t,this.sourceSelector&&this.sourceSelector.remove(),this.listenTo(t,"change",this.onChanges),we(this.elUnsavedMsg).text(""),e.prev=8,e.next=11,Object(K.a)(1);case 11:i=e.sent,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(8),console.error(e.t0),i={isOverLimit:!1};case 18:if(!this.model.isNew()||!i.isOverLimit){e.next=24;break}this.sieveConstraints=new Z.a({model:i,parent:this,url:URL_ROOT}).render(),we(this.elHeading).text(Object(k.a)("m_monitor_limit")),we(this.elContent).empty().append(this.sieveConstraints.el),e.next=37;break;case 24:if(!t.isEmpty()||!0===n.skipSelector){e.next=33;break}(s=new ze({parent:this,model:t}).render()).on("save",this.onModelSelect),s.on("discard",this.onSourceSelectorDiscard),this.sourceSelector=s,we(this.elHeading).text(Object(k.a)("l_source")),we(this.elContent).empty().append(s.el),e.next=37;break;case 33:return e.next=35,this.initEditors(t,n.defaultsModel);case 35:this.renderOptions(),n.editURL&&this.sourceEditor.action_edit_url();case 37:this.removeProgress();case 38:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e){return Te.apply(this,arguments)})}),et=N.a.Base.extend((te={initialize:function(e){et.__super__.initialize.call(this,e),this.oldModel=e.oldModel},getDiffCount:function(){return[0,0]}},f()(te,"getDiffCount",(function(){return[0,0]})),f()(te,"setState",(function(e){this.state=e,this.show(e)})),f()(te,"show",(function(e){if(!e.diff)return this.render();var t=this.model;R.a.start("diff",{info:"l_loading"});try{var n=new be,i=t.get("data"),a=this.oldModel.get("data"),s=n.diff_main(a,i);n.diff_cleanupSemantic(s),this.$el.empty().append(n.diff_prettyHtml(s))}catch(e){this.$el.empty().append("Error showing diff: ",e.message).append(e.stack)}R.a.stop("diff")})),f()(te,"showDiffModal",(function(){throw new Error("Not implemented")})),te)),tt=et.extend({name:"SieveFeedView",tagName:"iframe",attributes:{frameborder:0,style:"width:100%;height:80px"},onFrameLoad:function(){this.el.style.height=this.el.contentDocument.documentElement.scrollHeight+"px",this.frame_loaded=!0,this.trigger("frame_loaded")},getDiffCount:function(){return[this.newFeedCount,this.updatedFeedCount]},postInit:function(){this.el.onload=this.onFrameLoad},show:function(e){var t=this;if(this.frame_loaded){var n,i=JSON.parse(this.model.get("data")),a=this.oldModel&&JSON.parse(this.oldModel.get("data")),s={},r=(new DOMParser,document.createElement("style"));this.el.contentDocument;s.newHashedFeed=i,s.oldHashedFeed=a,n=".inserted{background-color:#b7fdcb;}",n+=".removed{background-color:#ff9494;}",n+="img{margin-top:2px;margin-bottom:5px;}",n+=e.removed?".removed{display:inline}":".removed{display:none}",n+="body{width:700px;margin:0 auto;padding:0 10px;}",n+=".summary{padding-top:5px;}",r.type="text/css",we(r).attr("class","xdistill").text(n),Se.getUpdatedEntries(Tt,s,t.model.id,(function(e,n){if(e)return console.error("Error in update feed: ",e),void R.a.error("Error finding changes in feed");0==n.changes.length?n.changes=s.newHashedFeed.entries:n.changes=n.newEntries.concat(n.updatedEntries),t.newFeedCount=n.newEntries.length,t.updatedFeedCount=n.updatedEntries.length;var i=new J.a.FeedEntryList({model:new H.a.FeedEntryCollection(n.changes)}).render();i.$el.append(r),t.once("frame_loaded",(function(){t.bubbleEvent("sieve:data:loaded")})),t.el.setAttribute("srcdoc",i.el.outerHTML)}))}else this.once("frame_loaded",(function(){t.show(e)}))}}),nt=et.extend({name:"SieveXMLView",postInit:function(e){nt.__super__.postInit.call(this,e),this.show({diff:!0}),_e.defer((function(){self.bubbleEvent("sieve:data:loaded")}))}}),it=et.extend({name:"SieveHTMLView",attributes:{src:window.IE?"javascript:document.write('<script>document.open();document.domain=\""+document.domain+"\";document.close();<\/script>')":"about:blank",frameborder:0,style:"width:100%;height:40px"},tagName:"iframe",getDiffCount:function(){return[we(this.doc).find(".inserted").length,we(this.doc).find(".removed").length]},postInit:function(){this.showingDiff=!1,this.el.onload=this.onFrameLoad,this.sieve=this.model.parent;this.model.get("text");this.el.style.height="40px"},onFrameLoad:function(){this.frameReady=!0,this.trigger("frame_ready"),we(this.el.contentDocument).on("click",(function(e){"javascript:"==(e.target.href||"").slice(0,11)&&e.preventDefault()}))},onFrameReady:function(e){try{this.frameReady?e():this.once("frame_ready",e)}catch(e){console.error("Error calling frame ready callback",e)}},renderHTML:function(e,t){var n=this,i=(this.model.id,0),a=this.el,s=a.contentWindow.document,r=s.documentElement,o=this.sieve.get("uri");Et(s,o,e),ye.map(we(r).find("link[rel=stylesheet]").toArray(),(function(e,t){var n=s.createElement("img");n.onerror=function(){t()},n.src=e.href}),(function(e,t){n.syncIntervalId&&clearInterval(n.syncIntervalId),n.syncIntervalId=setInterval((function(){try{var e=a.contentWindow;if(!e||!e.document)return void clearInterval(n.syncIntervalId);var t=e.document.body||r,s=Math.min(1e4,Math.max(r.scrollHeight,t.scrollHeight));s>e.innerHeight&&(a.style.height=s+"px"),(i+=1)>10&&clearInterval(n.syncIntervalId)}catch(e){throw clearInterval(n.syncIntervalId),e}}),100)})),setTimeout((function(){n.$("span").css({left:0,position:"relative"}),we(r).find("a[href]").attr("target","_blank").attr("rel","noopener"),n.bubbleEvent("sieve:data:loaded")}),200)},show:function(e){if(this.state=e,this.shown)return this.doc&&this.showDoc(e);this.shown=!0;var t=this;R.a.start("diff",{info:"l_loading"});var n=t.model.get("data"),i=t.oldModel.get("data"),a=new DOMParser;Date.now();if(n==i)return s(n);function s(e){t.markedHTML=e,t.doc=a.parseFromString(e,"text/html"),0==t.doc.querySelectorAll(".inserted,.removed").length&&(t.markedHTML=n,t.doc=a.parseFromString(n,"text/html")),t.showDoc(t.state),R.a.stop("diff")}Tt(i,n,t.model.id,(function(e,t){s(e?n:t)}))},showDoc:function(e){var t,n=this,i=this.doc,a=this.styleSheet||i.createElement("style"),s="";s=".inserted{background-color:#b7fdcb;}",s+=".removed{background-color:#ff9494;}",s+="span.inserted, span.removed{padding: 1px 4px;}",s+="a.removed, a .removed{color: #008}",s+="img.inserted{border: solid 2px green; background-color: transparent; padding: 2px;}",s+="img.removed{border: solid 2px red; background-color: transparent; padding: 2px;}",s+=e.removed?".removed{display:inline}":".removed{display:none}",e.snipped?(s+=".nonDiffHide {display:none}",this.srcStylesheet=i.querySelectorAll("link[rel=stylesheet], style:not(.xdistill)"),we(this.srcStylesheet).remove(),n.styledElements2=we(i).find("[style]").each((function(){this.dataset.oldStyle2=this.getAttribute("style"),this.removeAttribute("style")})),this.snippedHeight&&this.$el.height(this.snippedHeight)):(this.snippedHeight=this.snippedHeight||this.$el.height(),we(i).find("head").append(this.srcStylesheet),n.styledElements2&&n.styledElements2.each((function(){this.setAttribute("style",this.dataset.oldStyle2)}))),we(i).find('link[rel="stylesheet"], style:not(.xdistill)').length||(s+="body {padding: 10px;}",s+="td {padding: 10px}",s+="body {font-size: 0.94em}"),a.type="text/css",we(a).attr("class","xdistill").text(s),i.body.appendChild(a),this.styleSheet=a,t=i.documentElement.outerHTML,n.onFrameReady((function(){n.renderHTML(t,e)}))},showDiffModal:function(){this.diffModal=new ct({title:Object(k.a)("Highlighted Changes"),parent:this.getRoot(),model:this.model,html:this.markedHTML,width:"100%",height:"100%"}),this.diffModal.show()}}),at=N.a.ContextMenu.extend({name:"DiffPrefMenu",events:{"change input":"event_change"},event_change:function(e){e.stopPropagation(),this.save()},getPrefs:function(){var e={};return this.$(":checkbox").each((function(t,n){e[n.name]=n.checked?1:0})),e},load:function(){var e=this;M.a.api("/users/prefs/ui_diff","GET",(function(t,n){t?(console.error("Failed to get prefs",t),e.showApiErr()):e.showPrefs(n),e.show()}))},renderMenu:function(){this.load(),this.$el.empty().append(LI({class:"xview"},DIV(Object(k.a)("l_loading"),"...")))},save:function(){var e=this.getPrefs();M.a.api("/users/prefs/ui_diff","PUT",e,(function(t,n){t?R.a.error("e_req"):(USER.prefs.ui_diff=e,Q.a.agents.local&&T.a.SyncMan.get(T.a.store.UserStore,(function(){})))}))},showApiErr:function(e){this.$el.empty().append(LI({class:"xview error"},DIV("Couldn't get prefs. ",A({href:"/ui/settings.html#general"},"Sign in to account."))))},showPrefs:function(e){var t=Date.now()*Math.random()|0;_e.defaults(e,Re),this.$el.empty().append(LI({class:"xview"},DIV({style:"font-size: 1.1em; "},Object(k.a)("Defaults")),DIV(INPUT({id:"removed"+t,name:"removed",type:"checkbox",style:"position: relative; top: 2px;"}),LABEL({for:"removed"+t,style:"margin:0 4px;padding:0;font-size:.9em; user-select: none;"},Object(k.a)("Deleted"))),DIV(INPUT({id:"snipped"+t,name:"snipped",type:"checkbox",style:"position: relative; top: 2px;"}),LABEL({for:"snipped"+t,style:"margin:0 4px;padding:0;font-size:.9em; user-select: none;"},Object(k.a)("Snipped"))))),this.$(":checkbox").each((function(t,n){e[n.name]&&(n.checked=1)}))}}),st=N.a.Base.extend({event_settings:function(e){De&&De.el.parentNode?(De.remove(),De=null):(De=new at({parent:this})).toggle(this.name,e.currentTarget)}}),rt=st.extend({name:"FeedBar",events:{"click .xsettings":"event_settings","click .xremoved":"event_show_removed"},event_show_removed:function(e){this.state.removed=e.target.checked,this.updateState()},postInit:function(e){this.state=_e.extend({},Re,USER.prefs.ui_diff),this.view=e.view,this.view.setState(this.state)},render:function(){var e,t=Date.now()*Math.random()|0;return this.$el.css((e={position:"absolute",right:1,borderBottom:"solid 1px #ddd",backgroundColor:"#f3f3f3"},f()(e,"backgroundColor","#f0f0f0"),f()(e,"marginTop","-4px"),f()(e,"padding",0),e)).append(DIV({class:"inline-block"},DIV({class:"btn",style:"padding:0 6px;",title:"Shows the number of new and updated feeds"},SPAN({style:"font-weight: bold;"},this.elNewFeed=SPAN(0)," new, ")," ",SPAN({style:"font-weight: bold;",title:"Shows the number of new and updated feeds"},this.elChangedFeed=SPAN(0)," updated. ")),INPUT({class:"xremoved",type:"checkbox",id:"show-del"+t}),LABEL({for:"show-del"+t,style:"margin:0 4px;font-size:.9em; user-select: none;",title:"Shows deleted content in changed feed entry"},"Deleted"),BUTTON({class:"btn btn-default btn-sm xsettings",style:"min-width:20px;padding:0;margin:0;"},I({class:"fa fa-cog"})))),this},setDiffCount:function(e){this.elNewFeed.textContent=Math.min(e[0],999),this.elChangedFeed.textContent=Math.min(e[1],999)},updateState:function(){this.$(".xremoved").prop("checked",this.state.removed),this.view.setState(this.state)}}),ot=st.extend({name:"DiffBar",events:{"click .xpopup":"event_popup","click .xsettings":"event_settings","click .xsnipped":"event_show_snipped","click .xremoved":"event_show_removed"},event_popup:function(e){this.popWindow(e)},event_show_removed:function(e){this.state.removed=e.target.checked,this.updateState()},event_show_snipped:function(e){this.state.snipped=e.target.checked,this.updateState()},postInit:function(e){this.state=_e.extend({},Re,USER.prefs.ui_diff),this.view=e.view,this.view.setState(this.state)},render:function(){var e,t=this,n=Date.now()*Math.random()|0;return this.$el.css((e={position:"absolute",right:1,borderBottom:"solid 1px #ddd",backgroundColor:"#f3f3f3"},f()(e,"backgroundColor","#f0f0f0"),f()(e,"marginTop","-4px"),f()(e,"padding",0),e)).append(DIV({class:"inline-block"},A({class:"btn btn-default btn-sm xpopup",style:"padding:0 6px; margin-right: 4px;"},Object(k.a)("Explore diff (beta)")," ",SPAN({style:"color: green;font-weight: bold;"},this.elPlus=SPAN(0),"+")," ",SPAN({style:"color: red;font-weight: bold;"},this.elMinus=SPAN(0),SPAN({style:"font-size: 1.1em; line-height: 1.1"},""))),INPUT({id:"removed"+n,class:"xremoved",name:"removed",type:"checkbox",style:"position: relative; top: 2px;"}),LABEL({for:"removed"+n,style:"margin:0 4px;padding:0;font-size:.9em; user-select: none;"},Object(k.a)("Deleted")),INPUT({id:"snipped"+n,class:"xsnipped",name:"snipped",type:"checkbox",style:"position: relative; top: 2px;"}),LABEL({for:"snipped"+n,style:"margin:0 4px;padding:0;font-size:.9em; user-select: none;"},Object(k.a)("Snipped")),BUTTON({class:"btn btn-default btn-sm xsettings",style:"min-width:20px;padding:0;margin:0;"},I({class:"fa fa-cog"})))),this.$(":checkbox").each((function(e,n){t.state[n.name]&&(n.checked=!0)})),this},setDiffCount:function(e){this.elPlus.textContent=Math.min(e[0],999),this.elMinus.textContent=Math.min(e[1],999),e[0]+e[1]==0&&this.$(".xpopup,.xsnipped,.xremoved").attr("disabled",1)},updateState:function(){this.$(".xsnipped").prop("checked",this.state.snipped),this.$(".xremoved").prop("checked",this.state.removed),this.view.setState(this.state)},popWindow:function(e){this.view.showDiffModal()}}),lt=N.a.Base.extend({attributes:{style:"width: 100%;"},getScrollHeight:function(){return this.frameReady?this.iframe.contentWindow.document.body.scrollHeight:400},toggleStyle:function(e){var t=this;this.onFrameReady((function(){var n=t.iframe.contentWindow.document;e?(t.styleSheets=n.querySelectorAll("link[rel=stylesheet],style:not(.xdistill)"),we(t.styleSheets).remove(),t.styledElements=we(n).find("[style]").each((function(){this.dataset.oldStyle=this.getAttribute("style"),this.removeAttribute("style")}))):(we(n.head).append(t.styleSheets),t.styledElements.each((function(){this.setAttribute("style",this.dataset.oldStyle)})))}))},hideRemoved:function(){var e=this;this.onFrameReady((function(){we(e.iframe.contentWindow.document).find(".removed").addClass("xdistill-hide")}))},hideInserted:function(){var e=this;this.onFrameReady((function(){we(e.iframe.contentWindow.document).find(".inserted").addClass("xdistill-hide")}))},moveToNextDiff:function(){for(var e=0,t=this.options.scrollCt,n=t.scrollTop,i=we(t).height(),a=we(this.iframe.contentWindow.document).find(".diffMark:visible");e<a.length&&a.eq(e++).offset().top-n<i;);return!!a[e-=1]&&(a[e].scrollIntoView({behavior:"smooth"}),!0)},moveToPrevDiff:function(){for(var e=this.options.scrollCt,t=e.scrollTop,n=(we(e).height(),we(this.iframe.contentWindow.document).find(".diffMark:visible")),i=n.length;--i>0&&n.eq(i).offset().top+n.eq(i).height()>t;);n[i].scrollIntoView({behavior:"smooth"})},onFrameReady:function(e){try{this.frameReady?e():this.once("frame_ready",e)}catch(e){console.error("Error calling frame ready callback",e)}},onViewReady:function(e){try{this.viewReady?e():this.once("view_ready",e)}catch(e){console.error("Error calling view ready callback",e)}},render:function(){var e=this,t=IFRAME({class:"data-pad",width:"100%",scrolling:"no",style:"border: none;"});return this.iframe=t,this.$el.append(t),t.onload=function(){e.frameReady=!0,e.trigger("frame_ready")},this.onFrameReady(this.renderFrameContent),this},renderFrameContent:function(){var e=this,t=this.options.model.parent,n=this.options.html,i=this.iframe.contentWindow.document,a=i.createElement("style");Et(i,t.get("uri"),n),we(a).attr({class:"xdistill",type:"text/css"}).text(".removed {background-color:#ff9494; display:inline !important}a.removed, a .removed {color: #008}.inserted {background-color:#b7fdcb; display:inline !important}span.inserted, span.removed{padding: 1px 4px;}.xdistill-hide {display: none !important} img.inserted{border: solid 2px green; background-color: transparent; padding: 2px;}img.removed{border: solid 2px red; background-color: transparent; padding: 2px;}"),we(i).find("body").append(a);var s=we(i).find('link[rel="stylesheet"]');ye.each(s,(function(e,t){e.addEventListener("load",t)}),(function(t,n){e.viewReady=!0,e.trigger("view_ready")}))},scrollFirstDiffIntoView:function(){var e=we(this.iframe.contentWindow.document).find(".diffMark:visible")[0];return!!e&&(e.scrollIntoView({behavior:"smooth"}),!0)},setFrameHeight:function(e){we(this.iframe).css("height",e)},showDiff:function(){var e=this;this.onFrameReady((function(){we(e.iframe.contentWindow.document).find(".inserted").removeClass("xdistill-hide"),we(e.iframe.contentWindow.document).find(".removed").removeClass("xdistill-hide")}))}}),ct=N.a.Modal.extend({events:{"click .xdiff-toggle-mode":"toggleMode","click .xdiff-toggle-style":"toggleStyle","click .xleft-frame-up":"moveToPrevDiffLeftEle","click .xleft-frame-down":"moveToNextDiffLeftEle","click .xright-frame-up":"moveToPrevDiffRightEle","click .xright-frame-down":"moveToNextDiffRightEle"},headerClass:"panel-heading xpanel-heading-alt",showSplitView:function(){this.view1.$el.parent().css("width","50%"),this.view2.$el.parent().css("width","50%"),we(this.elView2).show(),this.view1.hideRemoved(),this.view2.hideInserted(),we(this.toolbarView1).css("right","51%"),this.syncHeight()},showInlinedView:function(){this.view1.$el.parent().css("width","100%"),we(this.elView2).hide(),this.view1.showDiff(),we(this.toolbarView1).css("right","10px"),this.syncHeight()},syncHeight:function(){var e=Math.max(this.view1.getScrollHeight(),this.view2.getScrollHeight());this.view1.setFrameHeight(e),this.view2.setFrameHeight(e),we(this.scrollCt).css("height",we(window).height()-this.scrollCt.getBoundingClientRect().y)},toggleMode:function(e){this.isModeInlined=!this.isModeInlined,this[this.isModeInlined?"showInlinedView":"showSplitView"]();var t=we(e.currentTarget);t.find(".active").removeClass("active").removeClass("btn-primary"),t.find(this.isModeInlined?".xdiff-mode-inlined":".xdiff-mode-sbs").addClass("active btn-primary"),this.syncHeight()},toggleStyle:function(e){this.isStyleRemoved=!this.isStyleRemoved,this.view1.toggleStyle(this.isStyleRemoved),this.view2.toggleStyle(this.isStyleRemoved);var t=we(e.currentTarget);t.find(".active").removeClass("active").removeClass("btn-primary"),t.find(this.isStyleRemoved?".xdiff-style-restore":".xdiff-style-remove").addClass("active btn-primary"),this.syncHeight()},moveToPrevDiffLeftEle:function(){this.view1.moveToPrevDiff()},moveToNextDiffLeftEle:function(){this.view1.moveToNextDiff()},moveToPrevDiffRightEle:function(){this.view2.moveToPrevDiff()},moveToNextDiffRightEle:function(){this.view2.moveToNextDiff()},renderHeader:function(){return DIV(DIV({class:"xtbar xvbar-margin pull-right"},BUTTON({class:"close","data-action":"modal close",title:Object(k.a)("a_window_close")},"")),DIV({class:"xtbar xvbar-margin"},DIV({class:"btn-group btn-toggle xdiff-toggle-mode"},BUTTON({class:"btn btn-default xdiff-mode-sbs btn-primary active"},Object(k.a)("Side-by-side diff")),BUTTON({class:"btn btn-default xdiff-mode-inlined"},Object(k.a)("Inlined diff"))),DIV({class:"btn-group btn-toggle xdiff-toggle-style"},BUTTON({class:"btn btn-default xdiff-style-remove btn-primary active"},Object(k.a)("Styled Page")),BUTTON({class:"btn btn-default xdiff-style-restore"},Object(k.a)("Unstyled Page"))),A({href:this.model.parent.get("uri"),class:"btn btn-default",target:"_blank",rel:"noopener"},I({class:"fa fa-external-link"}))))},renderView:function(){var e=this,t=DIV({style:"overflow-y: scroll;"},this.elView1=DIV({style:"width: 50%; height: 100%; float: left"},this.toolbarView1=DIV({class:"btn-group",style:"position: fixed; right: 51%"},BUTTON({class:"btn btn-default xleft-frame-up"},I({class:"fa fa-chevron-up"})),BUTTON({class:"btn btn-default xleft-frame-down"},I({class:"fa fa-chevron-down"})))),this.elView2=DIV({style:"width: 50%; height: 100%; float:right;"},DIV({class:"btn-group",style:"position: fixed; right: 15px;"},BUTTON({class:"btn btn-default xright-frame-up"},I({class:"fa fa-chevron-up"})),BUTTON({class:"btn btn-default xright-frame-down"},I({class:"fa fa-chevron-down"})))));function n(){e.view1.frameReady&&e.view2.frameReady&&(e.syncHeight(),we(e.view2.iframe).css("border-left","solid 1px #666"),console,e.view1.scrollFirstDiffIntoView()||e.view2.scrollFirstDiffIntoView()),we(window).resize(e.syncHeight),e.on("remove",(function(){we(window).off("resize",e.syncHeight)}))}return this.scrollCt=t,this.view1=new lt({parent:this.parent,model:this.model,html:this.options.html,scrollCt:t}).render(),this.elView1.appendChild(this.view1.el),this.view2=new lt({parent:this.parent,model:this.model,html:this.options.html,scrollCt:t}).render(),this.elView2.appendChild(this.view2.el),this.view1.hideRemoved(),this.view2.hideInserted(),this.view1.onViewReady(n),this.view2.onViewReady(n),t}}),dt=N.a.Base.extend({name:"SieveDataView",className:"xsieve-data-item",createView:function(){var e=this.model,t=this.options.oldModel,n={index:this.options.index,parent:this,model:e,oldModel:t};switch(e.get("data_type")){case j.a.TYPE_HTML:return new it(n);case j.a.TYPE_FEED:return new tt(n);case j.a.TYPE_XML:return new nt(n);case j.a.TYPE_PDF_HTML:case j.a.TYPE_DOC:return new it(n);default:return new Oe.View({el:SPAN("ERR! Unknown data type")})}},onViewLoad:function(){this.bubbleEvent("sieve:data:loaded"),this.diffBar&&this.diffBar.setDiffCount(this.view.getDiffCount())},postInit:function(){this.view=this.createView(),this.view.on("sieve:data:loaded",this.onViewLoad),this.model.get("data_type")==j.a.TYPE_FEED&&(this.diffBar=new rt({parent:this,view:this.view})),this.model.get("data_type")==j.a.TYPE_HTML&&(this.diffBar=new ot({parent:this,view:this.view})),this.model.get("data_type")==j.a.TYPE_DOC&&(this.diffBar=new ot({parent:this,view:this.view})),this.model.get("data_type")==j.a.TYPE_PDF_HTML&&(this.diffBar=new ot({parent:this,view:this.view})),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=xe(this.model.get("ts_mod"));return this.$el.empty().append(this.diffBar?this.diffBar.render().el:"",DIV({style:"display:flex;margin:4px 0;"},DIV({style:"margin-right:10px;",title:e.format()},STRONG(e.format("hh:mm A")),DIV(e.format("MMM DD"))),DIV({style:"flex:1;background-color:#fff;border-bottom:solid 1px #ccc;"},DIV({style:"flex:1;background-color:#fff;border-bottom:solid 1px #ccc;"},this.view.render().el)))),this}}),ht=N.a.Base.extend({name:"Work",render:function(){var e=this.model.attributes,t=e.err,n=this;return t?this.$el.append(A({href:"#",class:"error"},SPAN(St(e.ts))," ",SPAN(t.code||"EUNKOWN"))).find("a").popover({placement:"left",html:!0,trigger:"click|focus",content:function(){return DIV(DIV(LABEL("Code:")," ",SPAN(t.code||"NA")),DIV(LABEL("Msg:")," ",SPAN(t.msg||t.message||JSON.stringify(t))),DIV({style:"padding-top: 5px;"},STRONG("Recommended Actions"),n.getSuggestions(t)),DIV({style:"padding-top: 5px;"},STRONG("Need help?"),DIV("Contact us at support@distill.io"))).outerHTML}}).click((function(e){e.preventDefault()})):this.$el.append(SPAN(St(e.ts))),this},getSuggestions:function(e){switch(e.code||"NA"){case"SELECTION_EMPTY":return UL({style:"padding-left:14px;"},LI("Ensure that seleced elements has text content."),LI("If website needs login, make sure that you are logged in."));case"TIMEOUT":case"ENOTFOUND":case"EREQUEST":case"ETIMEDOUT":case"ECONNREFUSED":return DIV("Please ensure that the webpage is accessible.");case"JAVASCRIPT":return DIV("Ensure that JavaScript is working in the page.");default:return 0===e.status?DIV("Ensure that internet connection is working."):DIV("There is no information about this error.")}}}),ut=N.a.Collection.extend({name:"Works",postInit:function(){this.sieve=this.collection.parent,this.collection.fetch(),this.collection.on("sync",this.onSync)},addOne:function(e){var t=new ht({model:e,parent:this});return this.$msg.empty(),this.$list.append(t.render().el),t},onSync:function(){0==this.collection.length&&(this.sieve.get("client_id")==App.clients.defaultId?this.$msg.text(Object(k.a)("m_log_na")):this.$msg.text(Object(k.a)("Log for this monitor will be available on device that runs this monitor")))},renderBase:function(){this.$msg=we(DIV(Object(k.a)("l_loading"))),this.$list=we(DIV()),this.$el.append(this.$msg,this.$list)}}),pt=N.a.ActionProvider.extend({render:function(){return this.$el.empty().append(DIV({class:"form-actions btn-toolbar centered",style:"padding-top:6px;"},BUTTON({class:"btn btn-default ","data-action":"sieve more data"},Object(k.a)("Show More")),BUTTON({class:"btn btn-default ","data-action":"sieve edit"},Object(k.a)(Object(k.a)("a_edit_options"))),BUTTON({class:"btn btn-default","data-action":"sieve view close"},Object(k.a)("Close")))),this}}),ft=N.a.ActionProvider.extend({name:"SieveDataList",fetch:function(){var e=this,t=this.$('[data-action="sieve more data"]'),n=this.$(".xmsg"),i=!this.lastData,a=i&&this.options.initialFetchCount||2,s={_opt:{limit:a}};i||(s["ts.lt"]=this.lastData.ts),t.button("loading"),R.a.start("sieve:data:fetch",{info:"l_loading"}),M.a.api("/sieves/"+this.model.id+"/data","GET",s,(function(s,r){if(t.button("reset"),s)return e.removeProgress(),R.a.stop("sieve:data:fetch",{error:"err:sieve:data:fetch"});var o=e.data,l=r.data,c=[];if(R.a.stop("sieve:data:fetch"),i&&0==r.count)return e.$data.append(DIV({class:"xinfo"},Object(k.a)("m_history_empty"))),void e.removeProgress();n.removeClass("hide").find(".info > span").text(r.count),i?(c=l.slice(0)).length>a-1&&c.pop():(e.lastData.id!=e.lastDisplayedData.id&&c.push(o[o.length-1]),l.length>1&&(c=c.concat(l)).pop()),l.length>0&&(e.lastData=l[l.length-1]);for(var d=0;d<c.length;d+=1)e.addDataView(c[d],c[d+1]||e.lastData,d);c.length>0&&(e.lastDisplayedData=c[c.length-1]),e.data=o.concat(l),r.count}))},addDataView:function(e,t,n){var i=new Oe.Model(e);i.parent=this.model;var a=new dt({index:n,model:i,oldModel:t&&new Oe.Model(t),parent:this}).render();this.listenTo(a,"sieve:data:loaded",this.removeProgress),this.$(".xinfo").remove(),this.$data.append(a.el)},postInit:function(e){this.listenTo(this.model,"change:ts_data",this.renderUpdateMsg),this.resetData()},removeProgress:function(){this.$(".xprogress").remove()},render:function(){var e=this.model.get("err"),t=A({href:"https://distill.io/help/check-log","data-action":"sieve log menu","data-action-param":this.model.id},"View log for details."),n=e&&DIV({class:"xinfo"},SPAN({class:"error"},Object(k.a)("Error encountered checking for updates. It may correct automatically on next check.")," ",t)," ",A({href:"https://distill.io/help/contact"},"Get help."))||"",i=DIV({class:"xprogress",style:"margin-top: -2px;position:absolute;"},DIV({class:"xindeterminate"})),a=DIV({class:"xsieve-data"},n),s=DIV({class:"xmsg centered hide"},SPAN({class:"info"}));return this.$el.append(DIV({class:"xview-body"},i,a),s).css({margin:"4px 0"}),this.$data=we(a),this},resetData:function(){delete this.lastData,delete this.lastDisplayedData,this.data=[],this.removeChildren(),this.fetch()},renderUpdateMsg:function(){var e=we(DIV({style:"text-align:center;"},"Updated. Reloading now... "));_e.delay(this.resetData,100),_e.delay((function(){e.remove()}),1400)}}),mt=N.a.ActionProvider.extend({name:"SieveDetail",actions:{"sieve edit":{fn:"action_edit"},"sieve more data":{fn:"action_more"},"sieve view close":{fn:"action_close"}},action_close:function(){this.parent.route()},action_edit:function(){App.edit(this.model.id)},action_more:function(){this.list.fetch()},postInit:function(){this.toolbar=new pt({parent:this}),this.list=new ft({parent:this,model:this.model,initialFetchCount:3})},render:function(){return this.$el.empty().append(this.list.render().el,this.toolbar.render().el),this}}),vt=N.a.Base.extend({name:"SieveRow",className:"xitem",tagName:"tr",events:{"click :checkbox":"event_check"},event_check:function(){this.model.prop("select",this.$("input[type=checkbox]:checked").length>0)},onSelect:function(e){this.$el[e?"addClass":"removeClass"]("active")},postInit:function(e){var t=this.model,n=t.id;this.listenTo(t,"change",this.renderRow),this.listenTo(t,"destroy",this.remove),this.listenTo(t,"remove",this.remove),this.listenTo(t,"sync",this.onSync),this.listenTo(t,"prop:select",this.onSelect),this.elDetail=TR(TD({colspan:8})),this.listenTo(se.a,"sieves:"+n,this.onSieveUpdate),this.listenTo(se.a,"sieves:run_state:"+n,this.onSieveRunState)},reattach:function(){var e=this.el.parentNode;e&&e.removeChild(this.el),e&&e.appendChild(this.el),this.elDetail.parentNode&&(e.removeChild(this.elDetail),e.appendChild(this.elDetail))},isSelected:function(){return this.model.prop("select")},markRead:function(){if(!this.model.isRead()){var e=this.model.getTags(App.labels).map((function(e){return e.id}));this.model.save({tags:e.join(","),ts_view:It(new Date)},{patch:!0})}},onSieveRunState:function(e){this.runState=e.doc.state,this.renderRow()},onSieveUpdate:function(e){e.doc?(this.model.set(this.model.parse(e.doc),{silent:!0}),this.model.trigger("change")):this.model.fetch()},onSync:function(){this.render()},remove:function(){vt.__super__.remove.call(this),we(this.elDetail).remove()},removeDetail:function(){this.$el.removeClass("active"),this.detail&&this.detail.remove(),we(this.elDetail).remove(),this.setSelected(!1),delete this.detail},render:function(){return this.renderRow(),this.detail&&this.showDetail(this.detail),this.setSelected(this.isSelected()),this},renderRow:function(){var e=this,t=this.runState;Object(le.c)(function(n){return Object(le.b)(ue(),(function(t){return e.markRead()}),n.attributes.uri||"#",n.attributes.name,URL_ROOT+"/v1/getfavicon?url="+escape(n.attributes.uri),n.attributes.name||Object(L.a)("l_untitled"),n.id,n.attributes.state==j.a.STATE_DISCARD||n.attributes.state==j.a.STATE_DEL?Object(le.b)(he()):Object(le.b)(de()),_e.map(n.getTags(App.labels),(function(e){return Object(le.b)(ce(),e.get("name"))})),null!=n.attributes.text?n.attributes.text||"<"+Object(L.a)("h_sieve_empty")+">":"<"+Object(L.a)("h_sieve_new")+">",n.attributes.schedule?n.attributes.schedule.getFrequencyClass():"error",n.attributes.schedule?n.attributes.schedule.getShortDisplayText():"err: unset","xtd xdata xaction xsieve-ts-data "+(n.attributes.err&&JSON.parse(n.attributes.err)?"xsieve-err":""),t==j.a.RUN_STATE_WAIT?"Waiting":t==j.a.RUN_STATE_WIP?"Checking":St(n.attributes.ts_data,!0)||"NA",App.clients.get(n.attributes.client_id)?App.clients.get(n.attributes.client_id).getIcon():" error fa-question","xtd btn btn-xs "+(n.attributes.state==j.a.STATE_READY?"btn-success":"btn-default")+(n.attributes.state==j.a.STATE_DISCARD?" disabled":""),n.attributes.state==j.a.STATE_READY?"ON ":"OFF")}(this.model),this.el),this.model.attributes._state&&0!=this.model.attributes._state?this.$el.addClass("xdirty").attr("title",Object(k.a)("m_sync_to_save")):this.$el.removeClass("xdirty").removeAttr("title"),this.$('[data-toggle="tooltip"]').tooltip({delay:{show:400}}),this.model.isRead()?this.$el.addClass("xfade").removeClass("xunread"):this.$el.addClass("xunread").removeClass("xfade")},setSelected:function(e){this.$("input[type=checkbox]:checked").length>0!==e&&(this.$("input[type=checkbox]").prop("checked",e),this.model.prop("select",e))},showDetail:function(e){if(this.detail!=e){var t=this;this.listenTo(e,"remove",(function(){this.detail==e&&(delete this.detail,this.removeDetail())}),this),this.elDetail.children[0].appendChild(e.el),this.detail=e,this.$el.addClass("active"),this.$el.after(this.elDetail),e.listenTo(e,"remove",(function(){t.markRead()})),this.setSelected(!0)}}}),gt=N.a.ContextMenu.extend({name:"LogMenu",actions:{"log menu close":{fn:"hide"},"clear-error":{fn:"clear_error"}},clear_error:function(){this.collection.get(this.id).save("err",null,{error:function(){R.a.error("e_err")}})},onSync:function(){this.show()},postInit:function(e){this.collection=this.options.collection},renderMenu:function(){var e=this.collection.get(this.id),t=new F.a.Works(null,{parent:e});this.$el.empty().append(LI(BUTTON({class:"btn xbtn-light pull-right","data-action":"log menu close"},I({class:"fa fa-times"})),SPAN({style:"margin-left: 18px;"},I(Object(k.a)("l_changed_on")))),LI({class:"xview"},SPAN(St(e.get("ts_data"))),I(Object(k.a)("l_check_log")),new ut({parent:this,collection:t}).render().el),LI({class:e.get("err")?"xview":"hide"},A({"data-action":"clear-error"},Object(k.a)("a_clear_error")))),this.listenTo(t,"sync",this.onSync)}}),bt=N.a.ContextMenu.extend({name:"ScheduleMenu",actions:{"schedule menu close":{fn:"hide"}},postInit:function(e){this.collection=this.options.collection},onScheduleChange:function(e){var t=this.collection.get(this.id);R.a.start("save","l_loading"),t.set("schedule",e,{silent:!0}),t.save(null,{patch:!0,silent:!0,data:{schedule:JSON.stringify(e)},error:function(){R.a.stop("save",{error:"e_req"})},success:function(){R.a.stop("save",{info:"m_saved_schedule"})}})},renderMenu:function(){var e=this.collection.get(this.id).clone();if(!e)return this.$el.text("Model not found:"+this.id),this;this.editedModel=e;var t=new Je({model:e,parent:this});this.$el.empty().append(LI(BUTTON({class:"btn xbtn-light pull-right","data-action":"schedule menu close"},I({class:"fa fa-times"})),SPAN({style:"margin-left: 18px;"},I(Object(k.a)("l_schedule")))),LI({class:"xview"},t.render().el)),this.off(),this.listenTo(e,"change:schedule",this.onScheduleChange),setTimeout((function(){t.focus()}),10)}}),wt=N.a.ContextMenu.extend({name:"SieveClientMenu",actions:{"menu client change":{fn:"action_client_change"},"menu client settings":{fn:"action_client_settings"}},action_client_change:function(e){var t=this,n=this.collection.get(this.id);R.a.start("save","l_loading"),n.save("client_id",e,{wait:!0,error:function(){R.a.stop("save",{error:"e_req"})},success:function(){R.a.stop("save"),t.hide()}})},action_client_settings:function(){new N.a.Modal({parent:this.getRoot(),title:"l_devices",view:new Y.a.ClientManager({parent:this.getRoot(),collection:App.clients})}).show()},postInit:function(e){this.collection=this.options.collection},renderMenu:function(){var e=this.collection.get(this.id);if(!e)return this.$el.text("Model not found:"+this.id),this;this.$el.empty(),this.$el.append(LI({class:"xview"},SPAN(Object(k.a)("a_select_device"),1!=this.collection.length?SPAN(" (Sync devices to see them)"):"")),LI({class:"divider"})).append(App.clients.map((function(t){return LI(t.id==e.get("client_id")?A({style:"font-weight:bold;"},I({class:"fa fa-check"})," ",t.getInfo()):A({"data-action":"menu client change","data-action-param":t.id},I({class:t.getIcon()})," ",t.getInfo()))}))).append(LI({class:"divider"}),LI(A({"data-action":"menu client settings"},I({class:"fa fa-edit"})," ",Object(k.a)("a_edit"))))}}),_t=N.a.ContextMenu.extend({name:"SieveContextMenu",actions:{"menu check changes":{fn:"action_check_for_changes"},"menu del":{fn:"action_del"},"menu del permanent":{fn:"action_del_permanent"},"menu duplicate":{fn:"action_duplicate"},"menu edit":{fn:"action_edit"},menu_create_tpl:{fn:"action_create_tpl"}},action_check_for_changes:function(){var e=this.collection.get(this.id),t=[this.id];e.get("client_id")==App.clients.defaultId?T.a.service.checkNow(t):R.a.info("m_check_local_only"),this.hide()},action_create_tpl:function(){App.nav("add-tpl/"+this.id),this.hide()},action_del:function(){var e=this,t=this.collection.get(this.id);R.a.start("discard","l_loading"),t.save("state",j.a.STATE_DISCARD,{patch:!0,error:function(){R.a.stop("discard",{error:"e_req"})},success:function(){t.collection.remove(t),R.a.stop("discard"),e.hide()}})},action_duplicate:function(){App.nav("edit-dup/"+this.id),this.hide()},action_del_permanent:function(){var e=this,t=this.collection.get(this.id);R.a.start("destroy","l_loading"),t.destroy({error:function(){R.a.stop("destroy",{error:"e_req"})},success:function(){R.a.stop("destroy"),e.hide()}})},action_edit:function(){App.edit(this.id),this.hide()},onActionAdd:function(e){e.id||(R.a.start("save","m_saving"),e.save(null,{error:function(){R.a.stop("save",{error:"e_req"})},success:function(){R.a.stop("save",{info:"m_saved_action"})}}))},onActionChange:function(e){if(e.id)R.a.start("save","m_saving"),e.save(null,{silent:!0,error:function(){R.a.stop("save",{error:"e_req"})},success:function(){R.a.stop("save",{info:"m_saved_action"})}});else{var t=e.changed;e.once("sync",(function(){e.set(t)}),this)}},onActionRemove:function(e){e.id&&(R.a.start("save","m_saving"),e.destroy({error:function(){R.a.stop("save",{error:"e_req"})},success:function(){R.a.stop("save",{info:"m_deleted_action"})}}))},postInit:function(e){this.collection=this.options.collection},renderMenu:function(){var e=this.collection.get(this.id),t=new F.a.SieveActions(null,{parent:e});if(!e)return this.$el.text("Model not found:"+this.id),this;t.fetch({data:{state:0}}),this.actionEditor=new Be({actions:t,sieve:e,parent:this}),this.$el.empty(),Q.a.agents.local&&this.$el.append(LI(A({"data-action":"menu check changes"},Object(k.a)("a_check_changes")))),this.$el.append(LI(A({"data-action":"menu edit"},Object(k.a)("a_edit_options"))),LI(A({"data-action":"menu duplicate"},Object(k.a)("a_duplicate"))),LI(A({"data-action":"menu_create_tpl"},Object(L.a)("a_action_object","a_create","l_tpl"))),LI({class:"divider"}),LI({class:"xview"},this.actionEditor.render().el),LI({class:"divider"}),LI(A({"data-action":"menu del"},Object(k.a)("a_move_to_trash"))),LI(A({"data-action":"menu del permanent"},Object(k.a)("a_del_permanent")))),this.listenTo(this.actionEditor.actions,"add",this.onActionAdd),this.listenTo(this.actionEditor.actions,"change",this.onActionChange),this.listenTo(this.actionEditor.actions,"remove",this.onActionRemove)}}),yt=N.a.ContextMenu.extend({name:"SievesListMenu",renderMenu:function(){var e=this;this.$el.empty().append(LI({class:"xview"},DIV(LABEL(Object(k.a)("l_sort_by"),": "),this.selSort=SELECT({class:"pull-right"},OPTION({value:"-ts_data"},Object(k.a)("l_time_changed_on")),OPTION({value:"name"},Object(k.a)("l_name")),OPTION({value:"client_id"},Object(k.a)("l_device"))))),LI({class:"xview"},DIV(LABEL(Object(k.a)("l_page_size"),": "),this.selPageSize=SELECT({class:"pull-right"},OPTION({value:5},5),OPTION({value:20},20),OPTION({value:50},50),OPTION({value:100},100),OPTION({value:200},"200!!"),OPTION({value:500},"500!!!")))),LI({class:"xview"},DIV(LABEL(Object(k.a)("l_device_filter"),": "),this.selClientFilter=SELECT({class:"pull-right"},OPTION({value:1},Object(k.a)("l_devices_all")),OPTION({value:2},Object(k.a)("l_device_this")))))),this.selSort.value=App.store.get("ui.list.sortby")||"-ts_data",this.selPageSize.value=App.store.get("ui.list.pagesize")||"50",this.selClientFilter.value=App.store.get("ui.list.clientfilter")||"1",we(this.selSort).change((function(){App.store.set("ui.list.sortby",e.selSort.value),e.parent.fetchAndShow()})),we(this.selPageSize).change((function(){var t=parseInt(e.selPageSize.value);App.store.set("ui.list.pagesize",t),e.parent.fetchAndShow()})),we(this.selClientFilter).change((function(){App.store.set("ui.list.clientfilter",e.selClientFilter.value),e.parent.fetchAndShow()}))}}),xt=N.a.ContextMenu.extend({name:"SievesPageMenu",actions:{"menu topage":{fn:"action_topage"}},action_topage:function(e){this.parent.goTo(parseInt(e,10)),this.hide()},renderMenu:function(){var e=this.parent.collection.info(),t=e.perPage;this.$el.empty().append(_e.map(_e.range(1,e.totalPages+1),(function(n){return LI(A({"data-action":"menu topage","data-action-param":n},(n-1)*t+1+" - "+Math.min(n*t,e.totalRecords)))}))).css({maxHeight:600,overflowY:"auto",fontSize:".8em"})}}),Ot=N.a.Entities.extend({name:"Sieves",actions:{action_be_action_add:{fn:"action_be_action_add"},action_be_action_remove:{fn:"action_be_action_remove"},action_be_config:{fn:"action_be_config"},action_be_device:{fn:"action_be_device"},action_be_schedule:{fn:"action_be_schedule"},action_be_switch_on:{fn:"action_be_switch_on"},action_be_switch_off:{fn:"action_be_switch_off"},"sieve c4c":{fn:"action_check_for_changes"},"sieve client menu":{fn:"action_client_menu"},"sieve context menu":{fn:"action_context_menu"},"sieve del":{fn:"action_del",doc:"Delete sieve"},"sieve del permanent":{fn:"action_del_permanent"},"sieve label apply":{fn:"action_apply_label"},"sieve list menu":{fn:"action_list_menu"},"sieve log menu":{fn:"action_log_menu"},"sieve mark_read":{fn:"action_mark_read"},"sieve mark_unread":{fn:"action_mark_unread"},"sieve nav next":{fn:"action_next"},"sieve nav prev":{fn:"action_prev"},"sieve nav topage":{fn:"action_topage"},"sieve restore":{fn:"action_restore"},"sieve schedule menu":{fn:"action_schedule_menu"},"sieve select all":{fn:"action_select_all"},"sieve select none":{fn:"action_select_none"},"sieve select read":{fn:"action_select_read"},"sieve select unread":{fn:"action_select_unread"},"sieve switch":{fn:"action_switch_on_off"},"sieve sync":{fn:"action_sync"},"sieve view":{fn:"action_view",doc:"View sieve details"},toggle_slidebar:{fn:"action_toggle_slidebar"}},events:{"click .xselect-all":"event_check"},ViewClass:mt,action_apply_label:function(e,t){var n=this.getSelectedModels();R.a.info("l_loading"),ye.eachSeries(n,(function(t,n){var i=t.get("tags");if(i){if(i.indexOf(e)>=0)return n();i+=","+e}else i=e;t.save("tags",i,{patch:!0,error:function(){n("e_req")},success:function(){n()}})}),(function(e){e?R.a.error("e_req"):R.a.reset()}))},action_be_action_add:function(){var e=this,t=new Oe.Model,n=new F.a.SieveActions(null,{parent:t}),i=new Be({actions:n,sieve:t,parent:this}).render(),s=new N.a.SaveDiscardModal({name:"BatchEdit$ActionAddModal",parent:this,title:"Add Actions - Batch Editor",view:i});s.on("save",r()(a.a.mark((function t(){var n,r,o,l;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.getSelectedIds(),r=i.getPosts(),t.prev=2,o=0;case 4:if(!(o<r.length)){t.next=11;break}return l=r[o].toJSON(),t.next=8,M.a.api("/batch/sieves/actions","POST",ge({},l,{ids:n}));case 8:o+=1,t.next=4;break;case 11:s.remove(),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(2),console.error(t.t0),R.a.error("Please try again later - error in batch action ".concat(t.t0.message||t.t0.msg));case 18:case"end":return t.stop()}}),t,null,[[2,14]])})))),s.on("discard",(function(){s.remove()})),s.show(),setTimeout((function(){return i.$(".dropdown-toggle").click()}),10)},action_be_action_remove:function(){var e=this,t=new N.a.PromptModal({name:"BatchEdit$ActionRemoveModal",parent:this.getRoot(),title:"Remove Actions - Batch Edit",a_save:"Remove",msg:"This action will remove all actions for selected monitors. Remove all actions?"});t.on("save",r()(a.a.mark((function n(){var i;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.getSelectedIds(),n.prev=1,n.next=4,M.a.api("/batch/sieves/actions","PUT",{ids:i,state:100});case 4:t.remove(),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(1),console.error(n.t0),R.a.error("Please try again later - error in batch action ".concat(n.t0.message||n.t0.msg));case 11:case"end":return n.stop()}}),n,null,[[1,7]])})))),t.show()},action_be_config:function(){var e=this,t=this.getSelectedModels(),n=new F.a.Sieve({content_type:j.a.TYPE_HTML,config:t[0].get("config").clone(),uri:t[0].get("uri")});Ge(n,"Config - Batch Edit",function(){var t=r()(a.a.mark((function t(i){var s,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R.a.info("l_loading"),i.remove(),s=e.getSelectedIds(),r=n.toJSON().config,t.prev=4,t.next=7,M.a.api("/batch/sieves","PUT",{ids:s,config:r});case 7:R.a.reset(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(4),console.error(t.t0),R.a.error("Please try again later - error in batch action ".concat(t.t0.message||t.t0.msg));case 14:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(e){return t.apply(this,arguments)}}())},action_be_device:function(){var e=this,t=this.getSelectedModels();if(0!=t.length){var n=t[0],i=new F.a.Sieve({content_type:j.a.TYPE_HTML,client_id:n.get("client_id")}),s=new Y.a.ClientSelector({model:i,parent:this}).render(),o=new N.a.Base({el:DIV({style:"margin: 5px;"},s.el)}),l=new N.a.SaveDiscardModal({name:"BatchEdit$Device",parent:this,title:"Device - Batch Editor",view:o});l.on("save",r()(a.a.mark((function t(){var n,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=e.getSelectedIds(),s=i.get("client_id"),t.next=5,M.a.api("/batch/sieves","PUT",{ids:n,client_id:s});case 5:l.remove(),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error(t.t0),R.a.error("Please try again later - error in batch action ".concat(t.t0.message||t.t0.msg));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))),l.on("discard",(function(){l.remove()})),l.show()}},action_be_schedule:function(){var e=this,t=new Oe.Model({schedule:new F.a.Schedule}),n=new Je({model:t,parent:this}).render(),i=new N.a.SaveDiscardModal({name:"BatchEdit$ActionAddModal",parent:this,title:"Schedule - Batch Editor",view:n});i.on("save",r()(a.a.mark((function n(){var s,r;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=e.getSelectedIds(),r=t.toJSON().schedule,n.prev=2,n.next=5,M.a.api("/batch/sieves","PUT",{ids:s,schedule:r});case 5:i.remove(),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(2),console.error(n.t0),R.a.error("Please try again later - error in batch action ".concat(n.t0.message||n.t0.msg));case 12:case"end":return n.stop()}}),n,null,[[2,8]])})))),i.on("discard",(function(){i.remove()})),i.show()},action_be_switch_on:function(){var e=this.getSelectedIds(),t=new N.a.PromptModal({name:"BatchEdit$ActionRemoveModal",parent:this.getRoot(),title:"Switch On Monitors - Batch Edit",a_save:"Switch ON",msg:"".concat(e.length," monitors will be switched ON.")});t.on("save",r()(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,M.a.api("/batch/sieves","PUT",{ids:e,state:j.a.STATE_READY});case 3:t.remove(),n.next=10;break;case 6:n.prev=6,n.t0=n.catch(0),console.error(n.t0),R.a.error("Please try again later - error in batch action ".concat(n.t0.message||n.t0.msg));case 10:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.show()},action_be_switch_off:function(){var e=this.getSelectedIds(),t=new N.a.PromptModal({name:"BatchEdit$ActionRemoveModal",parent:this.getRoot(),title:"Switch Off Monitors - Batch Edit",a_save:"Switch OFF",msg:"".concat(e.length," monitors will be switched OFF.")});t.on("save",r()(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,M.a.api("/batch/sieves","PUT",{ids:e,state:j.a.STATE_PAUSED});case 3:t.remove(),n.next=10;break;case 6:n.prev=6,n.t0=n.catch(0),console.error(n.t0),R.a.error("Please try again later - error in batch action ".concat(n.t0.message||n.t0.msg));case 10:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.show()},action_check_for_changes:function(e){if(Q.a.agents.local){var t=this.getSelectedModels(),n=_e.pluck(_e.filter(t,(function(e){return e.get("client_id")==App.clients.defaultId})),"id");T.a.service.checkNow(n),t.length>n.length&&R.a.info("m_check_local_only")}},action_client_menu:function(e,t){this.clientMenu||(this.clientMenu=new wt({parent:this,collection:this.collection})),this.clientMenu.toggle(e,"I"==t.nodeName?t.parentNode:t)},action_context_menu:function(e,t){this.contextMenu||(this.contextMenu=new _t({parent:this,collection:this.collection})),this.contextMenu.toggle(e,"I"==t.nodeName?t.parentNode:t)},action_del:function(){var e=this,t=this.getSelectedModels();return ye.map(t,(function(e,t){e.save("state",j.a.STATE_DISCARD,{patch:!0,error:function(){t(new Error("sieve:del:err"))},success:function(){e.collection.remove(e),t()}})}),(function(n){if(n)R.a.error("sieve:del:err");else{var i=t.length,a=E.a.translate("m_del_item").ifPlural(i,Object(k.a)("m_del_items")).fetch(i);R.a.info(a),e.route()}})),!0},action_del_permanent:function(){var e=this,t=this.getSelectedModels();ye.eachLimit(t,5,(function(e,t){e.destroy({error:function(){t(new Error("sieve:del:err"))},success:function(){t()}})}),(function(t){t?R.a.error("sieve:del:err"):(R.a.info("Permanently deleted selected items."),e.route())}))},action_list_menu:function(e,t){this.listMenu||(this.listMenu=new yt({parent:this})),this.listMenu.toggle("list",we(t).parent(".btn-group")[0])},action_log_menu:function(e,t){this.logMenu||(this.logMenu=new gt({parent:this,collection:this.collection})),this.logMenu.toggle(e,t||this.getRow(e).$el.find(".xsieve-ts-data")[0])},action_mark_read:function(){var e=this.getSelectedModels();ye.map(e,(function(e,t){e.save({ts_view:It(Date.now())},{patch:!0,error:function(){t(new Error("sieve:update:err"))},success:function(){t()}})}),(function(e){e&&R.a.error("sieve:update:err")}))},action_mark_unread:(ke=r()(a.a.mark((function e(){var t,n,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.getSelectedModels(),n=0;case 3:if(!(n<t.length)){e.next=11;break}return i=t[n],s=It(0),e.next=7,M.a.api("/sieves/".concat(i.id),"PATCH",{ts_view:s});case 7:i.set({ts_view:s});case 8:n+=1,e.next=3;break;case 11:case"end":return e.stop()}}),e,this)}))),function(){return ke.apply(this,arguments)}),action_next:function(){R.a.info("l_loading"),this.collection.nextPage({sort:!1,data:_e.extend({_opt:{order:[this.getSortField()]}},this.getQuery()),success:function(e,t,n){_e.each(n.previousModels,(function(e){e.trigger("remove")})),R.a.reset()}})},action_prev:function(){R.a.info("l_loading"),this.collection.prevPage({sort:!1,data:_e.extend({_opt:{order:[this.getSortField()]}},this.getQuery()),success:function(e,t,n){_e.each(n.previousModels,(function(e){e.trigger("remove")})),R.a.reset()}})},action_topage:function(e,t){this.pageMenu||(this.pageMenu=new xt({parent:this})),this.pageMenu.toggle("list",t)},action_restore:(Ae=r()(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,n=this.getSelectedModels(),i={},e.prev=3,e.next=6,Object(K.a)(n.length);case 6:i=e.sent,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.log(e.t0),i={isOverLimit:!1};case 13:if(!i.isOverLimit){e.next=16;break}return R.a.error("m_monitor_limit"),e.abrupt("return");case 16:ye.map(n,(function(e,t){e.save("state",j.a.STATE_READY,{patch:!0,error:function(){t(new Error("sieve:restore:err"))},success:function(){e.collection.remove(e),t()}})}),(function(e){e?R.a.error("sieve:restore:err"):(R.a.info("m_restored_from_trash"),t.route())}));case 17:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return Ae.apply(this,arguments)}),action_schedule_menu:function(e,t){this.scheduleMenu||(this.scheduleMenu=new bt({parent:this,collection:this.collection})),this.scheduleMenu.toggle(e,t)},action_select_all:function(){this._select(_e.identity,!0)},action_select_none:function(){this._select(_e.identity,!1)},action_select_read:function(){this.action_select_none(),this._select((function(e){return e.model.isRead()}),!0)},action_select_unread:function(){this.action_select_none(),this._select((function(e){return!e.model.isRead()}),!0)},action_switch_on_off:function(e){var t=this.collection.get(e),n=t.get("state")==j.a.STATE_READY?j.a.STATE_PAUSED:j.a.STATE_READY;R.a.start("sieve:save",{info:"l_saving"}),t.save(null,{data:{state:n},patch:!0,err:function(e,t){R.a.stop("sieve:save",{error:"e_req"})},success:function(){R.a.stop("sieve:save"),t.set("state",n)}})},action_sync:function(){if(Q.a.agents.local){R.a.info("l_syncing");var e=!1;T.a.service.SyncMan.sync(!0,(function(t){e=!0,t?T.a.service.initSync((function(e){e&&R.a.error(t.msg||t.message||JSON.stringify(t))})):R.a.reset()})),setTimeout((function(){e||R.a.info("l_syncing_wait")}),5e3)}},action_toggle_slidebar:function(){App.toggleSlidebar()},action_view:function(e){this.modelView&&this.modelView.model.id==e?this.route():this.route(e)},event_check:function(e){this._select(_e.identity,e.target.checked)},_select:function(e,t){_e.each(this.views,(function(n){e(n)&&n.setSelected(t)}))},addOne:function(e,t){if(this.$list){var n=new vt({model:e,parent:this}),i=this.collection.indexOf(e);return this.$list[!0===t||0==i?"prepend":"append"](n.render().el),n}},close_edit:function(){this.optsPanel.remove(),this.opts=null},recentFetchAndShow:function(e){var t=this,n=this.collection.length>0?this.collection.max((function(e){return new Date(e.get("ts_mod")).valueOf()})).get("ts_mod"):new Date(0).toISOString(),i=new F.a.Sieves;R.a.start("fetch",{info:"l_loading"}),i.fetch({data:_e.extend({"ts_mod.gt":n,_opt:{}},this.getQuery()),success:function(){R.a.stop("fetch"),t.collection.add(i.models,{merge:!0,at:0})}})},fetchAndShow:function(e){var t=this,n=App.store.get("ui.list.pagesize");R.a.start("fetch",{info:"l_loading"}),this.tbar.setAttribute("context",this.routePrefix+(Q.a.agents.local?" local":"cloud")),this.collection.perPage!=n&&(this.collection.currentPage=0,this.collection.perPage=n),this.collection.fetch({sort:!1,data:_e.extend({_opt:{order:[this.getSortField()]}},this.getQuery()),error:function(e){R.a.stop("fetch",e&&{error:"err:fetch"})},success:function(){R.a.stop("fetch"),e?t.show(e):(t.removeModelView(),t.el.scrollIntoView()),t.onSelectionChange(),0==t.collection.length?t.renderEmpty():t.removeEmpty()}})},getQuery:function(){var e=App.store.get("ui.list.clientfilter"),t=this._query;return 2==e&&(t=_e.extend({client_id:this.clients.defaultId},t)),t},getRow:function(e){return _e.find(this.views,(function(t){return t.model.id==e}))},getSelectedIds:function(){return _e.chain(this.children).select((function(e){return e.isSelected&&e.isSelected()})).map((function(e){return e.model.id})).value()},getSelectedModels:function(){var e=this;return _e.chain(this.children).select((function(e){return e.isSelected&&e.isSelected()})).map((function(t){return e.collection.get(t.model.id)})).value()},getSortField:function(){var e=App.store.get("ui.list.sortby")||"-ts_data";return this.collection.sortField=e,"name"==e&&Q.a.agents.local?"name nocase":e},goTo:function(e){R.a.info("l_loading"),this.collection.goTo(e?e-1:0,{sort:!1,data:_e.extend({_opt:{order:[this.getSortField()]}},this.getQuery()),success:function(e,t,n){_e.each(n.previousModels,(function(e){e.trigger("remove")})),R.a.reset()}})},labelAddOne:function(e){this.$labelList.append(LI(A({href:"#","data-action":"sieve label apply","data-action-param":e.id},e.get("name"))))},labelRemoveOne:function(e){},labelReset:function(){this.$labelList.empty(),this.labels.each(this.labelAddOne)},onChangeUnreadError:function(e){var t=this.errorUnreadModel.get("error"),n=this.errorUnreadModel.get("unread");this.errorUnreadModel.set(e);var i=e.error,a=e.unread;t<i&&"filter/error"==this.routePrefix&&0==this.collection.currentPage&&this.recentFetchAndShow(),n<a&&"filter/unread"==this.routePrefix&&0==this.collection.currentPage&&this.recentFetchAndShow()},onClientsUpdate:function(e){"I"==e.op&&(this.clients.get(e.id)||this.clients.fetch())},onSelectionChange:function(){this.getSelectedModels().length>0?we(this.tbar).addClass("xselected"):we(this.tbar).removeClass("xselected")},onSieveInsert:_e.debounce((function(){this.fetchAndShow()}),15e3,!0),onSieveUpdate:function(e){"I"==e.op&&(this.collection.get(e.id)||this.onSieveInsert())},onSort:function(){var e=this.collection.pluck("id"),t=_e.keys(this.views);_e.isEqual(e,t)||this.collection.each((function(e){this.views[e.id].reattach()}),this)},postInit:function(e){this.listenTo(this.collection,"sort",this.onSort),this.listenTo(this.collection,"sync",this.updatePageInfo),this.listenTo(this.collection,"prop:select",this.onSelectionChange),this.clients=e.clients,this.labels=e.labels,this.labels.on("add",this.labelAddOne),this.labels.on("remove",this.labelRemoveOne),this.labels.on("reset",this.labelReset),this.listenTo(se.a,"sieves",this.onSieveUpdate),this.listenTo(se.a,"clients",this.onClientsUpdate),this.errorUnreadModel=new Oe.Model,this.listenTo(se.a,"user_states",this.onChangeUnreadError)},removeOne:function(e){N.a.Entities.prototype.removeOne.call(this,e),this.model&&this.model.id==e.id&&this.removeModelView(),e.trigger("remove")},renderBase:function(){var e,t,n=UL({class:"dropdown-menu",style:"overflow-y:auto;max-height:"+(we(window).height()-120)+"px"});this.$el.append(this.tbar=DIV({class:"xtbar xvbar-margin xtbar-padded xalt"+(Q.a.agents.local?" xlocal":"")},DIV({class:"btn-group"},INPUT({class:"xselect-all",type:"checkbox",style:"margin: 0 6px 0 0;"}),BUTTON({type:"button",class:"dropdown-toggle xbtn-light","data-toggle":"dropdown"},SPAN({class:"caret"}),SPAN({class:"sr-only"},"Dropdown Toggle")),UL({class:"dropdown-menu",role:"menu"},LI(A({href:"#","data-action":"sieve select all"},Object(k.a)("l_all"))),LI(A({href:"#","data-action":"sieve select none"},Object(k.a)("l_none"))),LI(A({href:"#","data-action":"sieve select read"},Object(k.a)("l_read"))),LI(A({href:"#","data-action":"sieve select unread"},Object(k.a)("l_unread"))))),BUTTON({"data-action":"sieve c4c",class:"btn btn-default",context:"selected local notrash nocloud",title:Object(k.a)("a_check_changes")},I({class:"im-run"})),BUTTON({"data-action":"sieve restore",class:"btn btn-default",context:"trash"},Object(k.a)("a_restore")),USER.account_id?DIV({class:"btn-group",context:"selected all notrash"},A({"data-action":"sieve mark_read",class:"btn btn-default",context:"selected all notrash",title:Object(k.a)("a_mark_read")},I({class:"fa fa-check"})),BUTTON({class:"btn btn-default dropdown-toggle","data-toggle":"dropdown",style:"min-width: 20px"},I({class:"caret"})),UL({class:"dropdown-menu",role:"menu"},LI(A({tabindex:-1,href:"#","data-action":"sieve mark_unread"},Object(k.a)("Mark as unread"))))):BUTTON({"data-action":"sieve mark_read",class:"btn btn-default",context:"selected all notrash",title:Object(k.a)("a_mark_read")},I({class:"fa fa-check"})),BUTTON({"data-action":"sieve del",class:"btn btn-default",context:"selected all notrash",title:Object(k.a)("a_move_to_trash")},I({class:"im-trash"})),BUTTON({"data-action":"sieve del permanent",class:"btn btn-default",context:"trash"},Object(k.a)("a_del_permanent")),DIV({class:"btn-group",context:"selected all notrash",title:Object(k.a)("l_label")},BUTTON({class:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},I({class:"fa fa-tags"})," ",SPAN({class:"caret"})),n),BUTTON({class:"btn btn-default",context:"all nocloud","data-action":"sieve sync",title:Object(k.a)("l_sync")},I({class:"fa fa-refresh"})),DIV({class:"btn-group",context:"all"},BUTTON({class:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},I({class:"fa fa-bars"})," ",SPAN({class:"caret"})),UL({class:"dropdown-menu",role:"menu"},LI({class:"dropdown-submenu"},A({href:"#"},Object(k.a)("a_export")),UL({class:"dropdown-menu",role:"menu"},LI(A({href:"#export_json"},"JSON")),LI(A({href:"#export_csv"},"CSV")))),LI({class:"dropdown-submenu"},A({href:"#"},Object(k.a)("a_import")),UL({class:"dropdown-menu",role:"menu"},LI(A({href:"#import_csv"},"CSV")),LI(A({href:"#import_json"},"JSON")))),LI(A({href:"#feeds",class:Q.a.agents.local&&"hide"},Object(k.a)("a_feeds"))),LI(A({href:"#tpls"},Object(k.a)("l_sieve_tpl_list"))),USER.account_id&&"demo"==USER.name?LI(A({href:"#sieve-sources"},Object(k.a)("Websites"))):"","")),DIV({class:"btn-group",context:"selected all"},BUTTON({class:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"".concat(Object(k.a)("a_bulk_edit")," "),SPAN({class:"caret"})),USER.id?UL({class:"dropdown-menu",role:"menu"},LI({class:"dropdown-submenu"},A({href:"#"},"Actions"),UL({class:"dropdown-menu",role:"menu"},LI(A({href:"#","data-action":"action_be_action_add"},"Add")),LI({class:"divider"}),LI(A({href:"#","data-action":"action_be_action_remove",style:"color: red"},"Remove All")))),LI(A({href:"#","data-action":"action_be_config"},Object(k.a)("Config"))),LI(A({href:"#","data-action":"action_be_device"},Object(k.a)("l_device"))),LI(A({href:"#","data-action":"action_be_schedule"},Object(k.a)("l_schedule"))),LI(A({href:"#","data-action":"action_be_switch_on"},Object(k.a)("Switch ON"))),LI(A({href:"#","data-action":"action_be_switch_off"},Object(k.a)("Switch OFF"))),""):UL({class:"dropdown-menu",role:"menu"},LI(A({href:"/ui/settings.html#general"},Object(k.a)("Sign in"))))),BUTTON({class:"btn btn-default right xoptional",style:"margin-right: 0;min-width: 40px;","data-action":"toggle_slidebar"},I({class:"fa fa-caret-square-o-left"})),DIV({class:"btn-group right xoptional"},BUTTON({class:"btn btn-default","data-action":"sieve list menu"},I({class:"fa fa-cog"})," ",SPAN({class:"caret"}))),UL({class:"pagination pagination-sm right",style:"margin: 0 5px 0 0"},LI(A({href:"#","data-action":"sieve nav topage"},this.pageInfo=SPAN(Object(k.a)("l_loading"))," ",I({class:"fa fa-caret-down"}))),this.pagePrev=LI(A({href:"#","data-action":"sieve nav prev"},I({class:"fa fa-chevron-left"}))),this.pageNext=LI(A({href:"#","data-action":"sieve nav next"},I({class:"fa fa-chevron-right"}))))),TABLE({class:"xlist",cellpadding:0},COLGROUP(COL({style:"width:28px"}),COL({style:"width:28px"}),COL({style:"width:304px; padding: 0 10px;"}),COL({style:""}),COL({style:"width:72px; padding: 0 10px;"}),COL({style:"width:72px"}),COL({style:"width:42px"}),COL({style:"width:40px"})),e=TBODY()),t=DIV()),this.$empty=we(t),this.$list=we(e),this.$labelList=we(n),this.labelReset()},removeEmpty:function(){this.$empty.empty()},renderEmpty:function(){App.sieves.reset();var e="inbox"==this.routePrefix;this.$empty.empty().append(e&&!Q.a.agents.local?DIV(H3("Cloud Watchlist"),P("This is your Watchlist in cloud at distill.io accessible from any device. ","It is currently empty. To start monitoring web, get started by adding a few monitors. ","In case you have installed Distill's browser extensions and are looking for the browser extension's Watchlist, ","use Distill's button in the browser toolbar to access it. "),P(A({href:"https://distill.io/help/watchlist"},"Learn More"))):H4("No monitor found."))},renderModelView:function(e,t){var n=this.getRow(e.id);n&&n.showDetail(t.render())},setRoutePrefix:function(e){this.routePrefix=e,this.collection.currentPage=0},show404:function(){return R.a.error("err_sieve_na"),!1},showDefault:function(){this.removeModelView()},showErred:function(e){Q.a.agents.local&&T.a.ErrorActions.clearErrorUnreadList(),this._query={"state.in":[j.a.STATE_INIT,j.a.STATE_READY,j.a.STATE_PAUSED],"err.ne":"$null"},this.modelId=e,"filter/error"!=this.routePrefix?(this.setRoutePrefix("filter/error"),this.fetchAndShow(e)):e?this.show(e):this.showDefault()},showInbox:function(e){this._query={"state.in":[j.a.STATE_INIT,j.a.STATE_READY,j.a.STATE_PAUSED]},this.modelId=e,"inbox"!=this.routePrefix?(this.setRoutePrefix("inbox"),this.fetchAndShow(e)):e?this.show(e):this.showDefault()},showLabel:function(e,t){var n="label/"+encodeURIComponent(e.get("name"));this._query={"state.in":[j.a.STATE_INIT,j.a.STATE_READY,j.a.STATE_PAUSED]},this._query["tags.like"]="%"+e.id+"%",this.modelId=t,this.routePrefix!=n?(this.setRoutePrefix(n),this.fetchAndShow(t)):t?this.show(t):this.showDefault()},showModelView:function(e){return this.getRow(e.id).markRead(),Ot.__super__.showModelView.call(this,e)},showSearch:function(e,t){var n="search/"+encodeURIComponent(e),i=this;re(e,(function(e,a){i._query=i.buildQuery(a),_e.isEmpty(i._query)?(i.setRoutePrefix(n),i.renderEmpty()):i.routePrefix!=n?(i.setRoutePrefix(n),i.fetchAndShow(t)):t?i.show(t):i.showDefault()}))},showSearchWithOperators:function(e,t){var n="search/"+encodeURIComponent(e);this._query=this.assignValues(e),_e.isEmpty(this._query)?(this.setRoutePrefix(n),this.renderEmpty()):this.routePrefix!=n?(this.setRoutePrefix(n),this.fetchAndShow(t)):t?this.show(t):this.showDefault()},assignValues:function(e){var t=this,n={},i=e.split(" OR ");if(i.length>1){for(var a=!1,s=0;s<i.length;s++){var r=i[s].trim(),o=r.split(" AND "),c=r.split(" ");if(o.length>1){for(var d=[],h=0;h<o.length;h++){var u=o[h].split(" ");d=[].concat(l()(d),l()(u))}if((o=d.length>0?this.handleLabelsWithSpace(d):this.handleLabelsWithSpace(o)).length>1){var p=this.groupANDoperations(o),f=p.response||[];n=ge({},n,{$or:[].concat(l()(n.$or||[]),[l()(f)])}),p.stateInFound&&(a=!0)}else if(1==o.length){var m=this.getQueryParams(o[0])||[];n=ge({},n,{$or:[].concat(l()(n.$or||[]),[l()(m)])}),_e.contains(m,"state.in")&&(a=!0)}}else if(c.length>1){if((c=this.handleLabelsWithSpace(c)).length>1){var v=this.groupANDoperations(c),g=v.response||[];n=ge({},n,{$or:[].concat(l()(n.$or||[]),[l()(g)])}),v.stateInFound&&(a=!0)}else if(1==c.length){var b=this.getQueryParams(c[0])||[];n=ge({},n,{$or:[].concat(l()(n.$or||[]),[l()(b)])}),_e.contains(b,"state.in")&&(a=!0)}}else{var w=this.getQueryParams(r)||[];n=ge({},n,{$or:[].concat(l()(n.$or||[]),[l()(w)])}),_e.contains(w,"state.in")&&(a=!0)}}a||(n["state.in"]=[j.a.STATE_INIT,j.a.STATE_READY,j.a.STATE_PAUSED])}else oe(e,["and","or"],(function(e,i){n=t.buildQuery(i)}));return n},groupANDoperations:function(e){for(var t={},n=!1,i=0;i<e.length;i++){var a=e[i].trim(),s=this.getQueryParams(a)||[];t=ge({},t,{$and:[].concat(l()(t.$and||[]),[l()(s)])}),_e.contains(s,"state.in")&&(n=!0)}return{response:["$and",t.$and],stateInFound:n}},handleLabelsWithSpace:function(e){for(var t=new RegExp(/(\"|\').*/),n=new RegExp(/.*(\"|\')$/),i="",a="",s=!1,r=[],o=0;o<e.length;o++){var l=e[o];if(s){for(var c=o;c<e.length;c++)if(i=(i||"")+" "+(l=e[c]),l.match(n)){s=!1,o=c,i=i.replace('"',"");break}var d=a+":"+i;r.push(d),i="",a=""}else if(l.indexOf(":")>-1){a=l.split(":")[0];var h=l.split(":")[1].trim();if(h)if(h.match(t)&&h.match(n)){var u=a+":"+(i=(i||"")+h.match(t)[0].replace(/(\"|\')/gm,""));r.push(u),i="",a=""}else if(h.match(t))i=(i||"")+h.match(t)[0].replace(/(\"|\')/gm,""),s=!0;else{var p=a+":"+(i=(i||"")+h);r.push(p),i="",a=""}}else s&&(i=(i||"")+" "+h)}return r},getQueryParams:function(e){var t=[],n=e.split(":");if(n.length>1){var i=n[0],a=n[1];switch(i){case"label":var s=App.labels.where({name:a});if(!(s&&s.length>0))return void(t=[]);_e.forEach(s,(function(e){t.push("tags.ilike"),t.push("%"+e.id+"%")}));break;case"is":if(a.match(/on/i)&&!t["state.in"]){t.push("state.in"),t.push([j.a.STATE_READY]);break}if(a.match(/on/i)&&t["state.in"].indexOf(j.a.STATE_READY)>=0)break;if(a.match(/off/i)&&!t["state.in"]){t.push("state.in"),t.push([j.a.STATE_PAUSED,j.a.STATE_INIT]);break}if(a.match(/off/i)&&t["state.in"].indexOf(j.a.STATE_PAUSED)>=0)break;if(a.match(/unread/i)){t.push("ts_view.lt"),t.push({name:"ts_data",type:"field"});break}if(a.match(/read/i)){t.push("ts_view.gt"),t.push({name:"ts_data",type:"field"});break}return void(t={});case"has":if(a.match(/error/i)){t.push("err.ne"),t.push("$null");break}return void(t={});case"keyword":t.push("$or"),t.push({"uri.ilike":"%"+a+"%","name.ilike":"%"+a+"%"});break;case"in":if(a.match(/trash/i)&&!t["state.in"])t.push("state.in"),t.push([j.a.STATE_DISCARD]);else if(!a.match(/trash/i)||!t["state.in"])return void(t={});break;default:t.push("state.ne"),t.push(j.a.STATE_DEL),t.push("$or"),t.push({"uri.ilike":"%"+i+":"+a+"%","name.ilike":"%"+i+":"+a+"%"})}}return t},buildQuery:function(e){for(var t={},n=0;n<e.length;n++){var i=e[n].name.toLowerCase();if(e[n].val){var a=e[n].val.trim();switch(i){case"label":var s=App.labels.where({name:a});if(!(s&&s.length>0))return void(t={});t["tags.ilike"]=t["tags.ilike"]||[],_e.forEach(s,(function(e){t["tags.ilike"].push(e.id)}));break;case"is":if(a.match(/on/i)&&!t["state.in"]){t["state.in"]=[j.a.STATE_READY];break}if(a.match(/on/i)&&t["state.in"].indexOf(j.a.STATE_READY)>=0)break;if(a.match(/off/i)&&!t["state.in"]){t["state.in"]=[j.a.STATE_PAUSED,j.a.STATE_INIT];break}if(a.match(/off/i)&&t["state.in"].indexOf(j.a.STATE_PAUSED)>=0)break;if(a.match(/unread/i)){t["ts_view.lt"]={name:"ts_data",type:"field"};break}if(a.match(/read/i)){t["ts_view.gt"]={name:"ts_data",type:"field"};break}return void(t={});case"keyword":t.$or={"uri.ilike":"%"+a+"%","name.ilike":"%"+a+"%"};break;case"has":if(a.match(/error/i)){t["err.ne"]="$null";break}return void(t={});case"in":if(a.match(/trash/i)&&!t["state.in"])t["state.in"]=[j.a.STATE_DISCARD];else if(!a.match(/trash/i)||!t["state.in"])return void(t={});break;default:t["state.ne"]=j.a.STATE_DEL,t.$or={"uri.ilike":"%"+i+":"+a+"%","name.ilike":"%"+i+":"+a+"%"}}}}return t["tags.ilike"]&&t["tags.ilike"].length>0&&(1==t["tags.ilike"].length?t["tags.ilike"]="%"+t["tags.ilike"].join("%")+"%":(t.$andTAGS=_e.map(t["tags.ilike"],(function(e){return["tags.ilike","%"+e+"%"]})),delete t["tags.ilike"])),_e.isEmpty(t)||t["state.in"]||(t["state.in"]=[j.a.STATE_INIT,j.a.STATE_READY,j.a.STATE_PAUSED]),t},showTrash:function(e){this._query={state:j.a.STATE_DISCARD},this.modelId=e,"trash"!=this.routePrefix?(this.setRoutePrefix("trash"),this.fetchAndShow(e)):e?this.show(e):this.showDefault()},showUnread:function(e){this._query={"state.in":[j.a.STATE_INIT,j.a.STATE_READY,j.a.STATE_PAUSED],"ts_view.lt":{name:"ts_data",type:"field"}},this.modelId=e,"filter/unread"!=this.routePrefix?(this.setRoutePrefix("filter/unread"),this.fetchAndShow(e)):e?this.show(e):this.showDefault()},updatePageInfo:function(){var e=this.collection,t=e.info(),n=t.currentPage,i=t.totalPages,a=e.length,s=e.offset,r=e.totalRecords;this.pageInfo.textContent=Object(L.a)("m_start_end_of_total",s+(a>0?1:0),s+a,r),we(this.pagePrev)[n<=0?"addClass":"removeClass"]("disabled"),we(this.pageNext)[n+1>=i?"addClass":"removeClass"]("disabled")}});t.a={SieveActionsEditor:Be,SieveDataList:ft,Sieves:Ot,SieveOptions:Ke,SieveScheduleEditor:Je,TagsEditor:Ze};function St(e,t){if(!e)return"";var n=xe(e),i=xe(),a=i.diff(n)/1e3|0;return a<60?n.format("h:mm a"):a<86400&&i.date()==n.date()?n.format("h:mm a"):a<31536e3?t?n.format("MMM DD"):n.format("MMM DD h:mm a"):t?n.format("YYYY/MM"):n.format("h:mm a, MMM DD, YYYY")}function It(e){return xe(e).format()}function Dt(e,t,n){t||(t="m"),n||(n=120);var i=e.val().trim().replace(/\s+/g,"").split(/(\d*\.*\d*)/);return(parseInt(i[1])||n)*{s:1,m:60,h:3600,d:86400,w:604800}[(i[2]||"").toLowerCase()[0]||t]}function Tt(e,t,n,i){var a=[e||"<html></html>",t||"<html></html>",n];if("undefined"!=typeof Worker){Date.now();var s=Q.a.agents.local?"/ui":window.URL_STATIC+"/scripts";Ie||(Ie=new Worker(s+"/lib/diff_html.js")).addEventListener("message",(function(e){var t=e.data,n=t[0],i=t[1],a=Ne[n];if(!a||0==a.length)throw new Error("No callback found for resCtx:"+n);try{for(var s=0;s<a.length;s+=1)a[s](null,i)}catch(e){console.error("Error calling diff callbacks",e)}delete Ne[n]}));var r=Ne[n]||[];r.push(i),Ne[n]=r,Ie.postMessage(a)}else document.getElementById("result").innerHTML="Sorry, your browser does not support Web Workers..."}function Et(e,t,n){var i,a=e.createElement("base"),s=n.match(/<base\s*href=\"(.*?)\"/);if(s)i=s[1];else{i=t;var r=n.indexOf("</head>");n=n.slice(0,r)+'<base href="'+i+'">'+n.slice(r)}a.setAttribute("href",i),we(e.head||e.documentElement).prepend(a),window.IE&&(n=n.match(/^<html.*?>([\s\S]*)<\/html>$/)[1]),e.documentElement.innerHTML=n,we(e.head||e.documentElement).prepend(a),we(e.documentElement).find("a[href]").attr("target","_blank").attr("rel","noopener")}},,function(e,t,n){var i=n(25),a=n(59);e.exports=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var i=n(60);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}},,,function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,a=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,i)}e.exports=n},,,,,,,,function(e,t,n){"use strict";n.r(t);var i=n(5),a=n.n(i),s=n(7),r=n.n(s),o=n(42),l=n(72),c=n(0),d=n(22),h=n(2),u=h.a.store.SimpleStore;var p=function(e){e||(e="_s"),this.__init__=function(e){e&&e()},this.del=function(t){t=e+t,document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},this.get=function(t){t=e+t;var n=unescape(document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*)|.*"),"$1"));return n?JSON.parse(n):void 0},this.set=function(t,n){t=e+t,document.cookie=escape(t)+"="+escape(JSON.stringify(n))+"; expires=Fri, 31 Dec 9999 23:59:59 GMT"}},f=u.storage?u:p,m=n(3),v=n(4),g=n(10),b=n(26),w=n(16);n(15);if(!window.Backbone)throw new Error("ADD Backbone");var y,x=w.a.Model.extend({}),O={Label:x,Labels:w.a.Collection.extend({model:x,url:"/tags",findByName:function(e){return this.find((function(t){return t.get("name")===e}))},getOrCreateLabels:(y=r()(a.a.mark((function e(t){var n,i,s,r,o,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.isString(t)&&(t=t.split(",").map((function(e){return e.trim()}))),n=App.labels.filter((function(e){return t.includes(e.get("name"))})).map((function(e){return e.toJSON()})),i=App.labels.pluck("name"),s=_.difference(t,i),r=0;case 5:if(!(r<s.length)){e.next=14;break}return o=s[r],e.next=9,g.a.api("/tags","POST",{name:o});case 9:l=e.sent,n.push(l);case 11:r+=1,e.next=5;break;case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})})},S=n(12),D=n(1),T=n(14);if(!window.Backbone)throw new Error("ADD Backbone");var E=w.a.Model,k=w.a.Collection,L=E.extend({defaults:{name:"",type:"text"}}),j=E.extend({encodedFields:["params","sieve_config","sieve_rule"],urlRoot:"/tpls/sieves",defaults:function(){return{desc_name:"Search Result",desc_uri:"https://www.domain.tld",desc_info:"Selection contains search result containing url and snippet. Does not contain ads.",sieve_type:D.a.TYPE_HTML,sieve_uri:null,sieve_config:{selections:[{frames:[{index:0,excludes:[],includes:[{type:"css",expr:"body"}]}],dynamic:!0}],includeStyle:!1,dataAttr:"text"},params:new k([])}},parse:function(e){return(e=j.__super__.parse.call(this,e)).params=new k(e.params),e}}),R=w.a.PagedCollection.extend({model:j,paginator_ui:{currentPage:0,perPage:50},url:"/tpls/sieves"}),N=E.extend({encodedFields:["pattern_params"],defaults:function(){return{pattern:null,uri_ref:null,pattern_params:new k}},parse:function(e){return(e=N.__super__.parse.call(this,e)).pattern_params=new k(e.pattern_params),e}}),C=k.extend({model:N,url:function(){return["/tpls/sieves",this.tpl.id,"patterns"].join("/")}}),V={Pattern:N,Patterns:C,InputParam:L,Tpl:j,Tpls:R};if(!window.domo)throw new Error("ADD domo");var M=DIV({class:"footer container-fluid"},HR(),DIV({class:"row"},DIV({class:"col-md-4"},H5(Object(c.a)("l_explore")),UL({class:"list-unstyled"},LI(A({href:URL_ROOT+"/help/gettingstarted/webapp"},Object(c.a)("l_get_started"))),LI(A({href:URL_ROOT+"/apps/web-monitor"},Object(c.a)("l_apps"))),LI(A({href:URL_ROOT+"/pricing"},Object(c.a)("l_pricing"))),LI(A({href:URL_ROOT+"/stats/availability"},Object(c.a)("l_usage_stats"))))),DIV({class:"col-md-4"},H5(Object(c.a)("l_help")),UL({class:"list-unstyled"},LI(A({href:URL_ROOT+"/help/start"},Object(c.a)("l_help_support"))))),DIV({class:"col-md-4"},H5(Object(c.a)("l_connect")),UL({class:"list-unstyled"},LI(A({href:"https://twitter.com/distill_io"},"Twitter")),LI(A({href:"https://facebook.com/distillweb"},"Facebook")),LI(A({href:"https://plus.google.com/114751872755487243849/"},"Google+"))))),DIV({class:"row",style:"margin-top:100px;font-size:small;"}," 2013-present Neemb LLC ",A({href:URL_ROOT+"/tos",target:"_blank"},Object(c.a)("l_tos")))),U=(n(13),n(9)),$=window.jQuery;if(!$)throw new Error("ADD jQuery");var B=window._;if(!B)throw new Error("ADD _");if(!window.async)throw new Error("ADD async");if(!window.domo)throw new Error("ADD domo");if(!window.moment)throw new Error("ADD moment");if(!window.Backbone)throw new Error("ADD Backbone");function F(e,t){if(!e||0==e.length)return'""';var n=e.indexOf('"')>=0,i=e.indexOf("\t")>=0,a=e.indexOf("\n")>=0;return n&&(e=e.replace(/"/g,'""')),(n||i||a||t)&&(e='"'+e+'"'),e}var H,Y=v.a.Base.extend({pageSize:500,offset:0,fields:["name","uri","config","tags","content_type","state","rule_id","schedule","ts"],load:function(){var e=this,t=this.options.sieveList._query||{"state.in":[40,45]};this.out.value=Object(c.a)("l_loading"),g.a.api("/sieves","GET",B.extend({_opt:{order:["ts"],limit:50,offset:this.offset,only:this.fields}},t),(function(t,n){e.list=e.list.concat(n.data),e.offset+=n.count,e.offset<n.total_count?e.load():e.onLoadListDone()}))},onLoadListDone:function(){}}),J=Y.extend({name:"CSV",fields:["id","uri","name","tags","text","err","ts","ts_mod"],onLoadListDone:function(){var e=B.map(this.list,(function(e){var t=e.tags;return"string"==typeof t&&(t=B.compact(t.split(",").map((function(e){var t=App.labels.get(e);return t?t.get("name"):void 0})))),[F(e.name,!0),F(e.uri),F(t?t.join(","):""),e.ts,e.ts_mod,F(e.text),F(e.err||"")].join("\t")}));e.unshift(["Name","URL","Labels","Created On","Changed On","Text","Error?"].join("\t")),this.out.value=e.join("\n")},render:function(){return this.$el.append(DIV({class:"alert alert-info",style:""},"TAB separated CSV will be generated below. Click Export button to start."),this.out=TEXTAREA({class:"from-control",style:"width: 100%; min-height: 400px;"})),this.list=[],this}}),Q=Y.extend({name:"JSON",onLoadListDone:(H=r()(a.a.mark((function e(){var t,n,i,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=function(){return(o=r()(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.rule_id){e.next=10;break}return e.prev=1,e.next=4,g.a.api("/rules/"+t.rule_id,"GET",{_opt:{only:["config"]}}).config;case 4:t.rule=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0);case 10:return(!t.tags instanceof Array||"string"==typeof t.tags)&&(t.tags=B.compact((t.tags||"").split(",").map((function(e){var t=App.labels.get(e);return t?t.get("name"):void 0})))),delete t.id,delete t.rule_id,delete t.ts_mod,delete t._state,e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)},s=function(e){return o.apply(this,arguments)},this.out.value=Object(c.a)("l_loading")+" "+Object(c.a)("l_rule"),t=this.list.slice(0),Promise.eachLimit=function(){var e=r()(a.a.mark((function e(n,i,o){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.slice(5*i,5*i+o).map(function(){var e=r()(a.a.mark((function e(n,i){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(n);case 2:t[i]=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),n=t.map((function(e){return e})),i=0;case 7:if(!(i<n.length/5)){e.next=13;break}return e.next=10,Promise.eachLimit(n,i,5);case 10:i++,e.next=7;break;case 13:this.out.value=JSON.stringify({client:U.a.agents,data:t});case 14:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)}),render:function(){return this.$el.append(DIV({class:"alert alert-info"},"Data exported in JSON format will be generated below. You can use this JSON to import monitors later.\nNote: Actions are not exported. You can create actions for all monitors when importing them.\n\nClick Export button to start."),this.out=TEXTAREA({class:"from-control",style:"width: 100%; min-height: 400px;"})),this.list=[],this}}),q=v.a.ActionProvider.extend({name:"exporter",events:{"click .btn-primary":"event_click"},event_click:function(){this.view.load()},asCSV:function(e){this.showView(new J({parent:this,sieveList:e}))},asJSON:function(e){this.showView(new Q({parent:this,sieveList:e}))},render:function(){return this.$el.append(DIV({class:"xtbar xvbar-margin"},BUTTON({class:"btn btn-default","data-action":"go_back"},I({class:"fa fa-chevron-left"})," Back"),BUTTON({class:"btn btn-primary"},Object(c.a)("a_export"))),H2({class:"xpage-header"},this.title=SPAN(""),SPAN(" - ",Object(c.a)("a_export")))),this},showView:function(e){this.view&&this.view.remove(),this.$el.append(e.render().el),$(this.title).text(e.name),this.view=e}}),W=n(8),z=n.n(W),G=n(73),X=n.n(G),Z=n(6),K=n.n(Z),ee=n(24),te=n.n(ee),ne=n(39),ie=n.n(ne),ae=n(43),se=n.n(ae),re=n(44),oe=n.n(re),le=n(51),ce=n.n(le),de=n(52),he=n.n(de),ue=n(53),pe=n.n(ue),fe=n(21),me=n(49),ve=n(45),ge=n(47);function be(){var e=te()(["<div class='error'>","</div>"]);return be=function(){return e},e}function we(){var e=te()(["\n        <div>","\n          <button class='btn btn-default' @click=",">Start Over</button>\n        </div>"]);return we=function(){return e},e}function _e(){var e=te()(["\n        <div> <span>","</span> of <span>","</span> </div>\n        <div>","</div>\n        "]);return _e=function(){return e},e}function ye(){var e=te()(["\n        <div>\n          ","\n          <div class='actions'>\n            <button class='btn btn-default' @click=",">Back</button>\n            <button class='btn btn-primary' @click=",">","</button>\n          </div>\n        </div>"]);return ye=function(){return e},e}function xe(){var e=te()(["<div class='error'>","</div>"]);return xe=function(){return e},e}function Oe(){var e=te()(["\n        <div>\n          ","\n          <div class='actions'>\n            <button class='btn btn-default' @click=",">Back</button>\n            <button class='btn btn-primary' @click=",">\n              Next - configure options and actions\n            </button>\n          </div>\n          ","\n        </div>"]);return Oe=function(){return e},e}function Se(){var e=te()(["<span>File: ","</span>"]);return Se=function(){return e},e}function Ie(){var e=te()(["\n          <div class='row'>\n            <div class='col-md-4'>\n              <input class='btn btn-default btn-lg' type='file' accept='.csv' style='display:none' @change=","></input>\n              <button class='btn btn-primary btn-lg' @click=",">\n                Select CSV file to import monitors\n              </button>\n              ","\n            </div>\n            <div class='col-md-8'>\n              Please note that the file should have columns with following headers:\n              <ul>\n                <li>Name</li>\n                <li>URL</li>\n                <li class='hide'>Config (Optional)</li>\n                <li>Labels (Optional)</li>\n              </ul>\n            </div>\n          </div>"]);return Ie=function(){return e},e}function De(){var e=te()(["\n      <style> .actions { margin: 20px 0; }</style>\n      <div class=xtbar>\n        <button class='btn btn-default' data-action='go_back'> \n          <i class='fa fa-chevron-left'> Back</i>\n        </button>\n      </div>\n      <div class='xpage-header'>\n        <h2>\n          CSV \n          ","\n        </h2>\n      </div>\n      <div class='' style='padding: 10px; background-color: #fff; border-radius: 2px;'>\n        ","\n\n        ","\n\n        ","\n\n      ","\n\n      ","\n      ","\n\n    </div>"]);return De=function(){return e},e}function Te(){var e=te()(["\n      <div class='page-header'>\n        <h3>\n          Options\n        </h3>\n      </div>\n\n      <div class='form-horizontal'>\n\n        <div class='form-group'>\n          <label class='control-label col-md-2'>Device</label>\n          <div class='col-md-10'>\n            ","\n          </div>\n        </div>\n\n        <div class='form-group'>\n          <label class='control-label col-md-2'>Schedule</label>\n          <div class='col-md-10'>\n            ","\n          </div>\n        </div>\n\n        <div class='form-group'>\n          <label class='control-label col-md-2'>Actions</label>\n          <div class='col-md-10'>\n            ","\n          </div>\n        </div>\n\n        <div class='form-group'>\n          <label class='control-label col-md-2'>Labels</label>\n          <div class='col-md-10'>\n            ","\n          </div>\n        </div>\n      </div>"]);return Te=function(){return e},e}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(n,!0).forEach((function(t){K()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ke(){var e=te()(["<td style='max-width: 200px; overflow: hidden; padding: 5px; border: solid 1px #ccc' title=",">","</td>"]);return ke=function(){return e},e}function Pe(){var e=te()(["\n            <tr style='border-bottom: solid 1px #ccc; white-space: nowrap;'>\n              ","\n            </tr>\n          "]);return Pe=function(){return e},e}function Le(){var e=te()(["<option value='","' ?selected=",">","</option>"]);return Le=function(){return e},e}function je(){var e=te()(["\n            <th style='max-width: 100px; padding: 5px; border: solid 1px #ccc;'>\n              <div><select @change=",">\n                <option></option>\n                ","\n              </select></div>\n            </th>"]);return je=function(){return e},e}function Re(){var e=te()(["\n      <div class='page-header'>\n        <h3>\n          Data\n          <small>\n            Column headers show identified column attributes. You can edit them to manually specify or correct them.\n          </small>\n        </h3>\n      </div>\n      <div style='max-height: 200px; overflow-y: scroll;'>\n        <table>\n        <thead style=''>\n          <tr style='border-top: solid 1px #ccc;'>\n            ","\n          </tr>\n        </thead>\n        <tbody>\n          ","\n        </tbody>\n      </table>\n    </div>\n\n    "]);return Re=function(){return e},e}function Ne(){var e=te()(["Loading..."]);return Ne=function(){return e},e}window.jQuery;var Ce=["name","url","labels"],Ve=function(e){function t(){return se()(this,t),ce()(this,he()(t).apply(this,arguments))}return pe()(t,e),oe()(t,[{key:"init",value:function(){var e=this;this.state.loading=!0,setTimeout((function(){for(var t=e.state.result,n=t.meta.fields,i=n.map((function(e){return e.toLowerCase()})),a=t.data,s=ie()(t.data,2),r=(s[0],s[1],{}),o=1;o<n.length;o+=1){var l=n[o];l in Ce&&(r[l]=o)}setTimeout((function(){e.setState({index:r,fields:n,normalizedFields:i,rows:a,loading:!1})}),200)}),50),this.inputFields={}}},{key:"getInputFields",value:function(){for(var e={},t=this.el.querySelectorAll("select"),n=0;n<t.length;n+=1){var i=t[n].value;i&&i.length>0&&(e[i]=this.state.fields[n])}return e}},{key:"getRows",value:function(){var e=this.getInputFields();return this.state.result.data.map((function(t){var n={};for(var i in e)n[i]=t[e[i]];return n}))}},{key:"onSelectHeader",value:function(e,t){}},{key:"createTpl",value:function(e){var t=this,n=e.loading,i=(e.index,e.fields),a=e.normalizedFields,s=e.rows;return n?Object(fe.b)(Ne()):Object(fe.b)(Re(),a.map((function(e,n){return Object(fe.b)(je(),(function(e){return t.onSelectHeader(e,n)}),Ce.map((function(t){return Object(fe.b)(Le(),t,e==t,t)})))})),s.map((function(e){return Object(fe.b)(Pe(),i.map((function(t){return Object(fe.b)(ke(),e[t],e[t])})))})))}}]),t}(fe.a),Me=function(e){function t(){return se()(this,t),ce()(this,he()(t).apply(this,arguments))}return pe()(t,e),oe()(t,[{key:"init",value:function(){this.model=new S.a.Sieve,this.actions=new S.a.SieveActions(null,{}),this.actionEditor=new me.a.SieveActionsEditor({actions:this.actions}).render(),this.clientSelector=new ve.a.ClientSelector({model:this.model}).render(),this.scheduleEditor=new me.a.SieveScheduleEditor({model:this.model}).render(),this.tagsEditor=new me.a.TagsEditor({model:this.model}).render()}},{key:"getOptions",value:function(){return Ae({},this.model.toJSON(),{actions:this.actions.toJSON()})}},{key:"createTpl",value:function(e){var t=e.inputFields;t.url,t.name,t.config,t.labels;return Object(fe.b)(Te(),this.clientSelector.el,this.scheduleEditor.el,this.actionEditor.el,this.tagsEditor.el)}}]),t}(fe.a),Ue=function(e){function t(){return se()(this,t),ce()(this,he()(t).apply(this,arguments))}var n,i,s;return pe()(t,e),oe()(t,[{key:"init",value:function(){this.reset()}},{key:"reset",value:function(){this.setState({progress:{index:0,total:0,msg:""},result:null,stage:1,errorImport:null})}},{key:"onImport",value:(s=r()(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.stage=4,e.prev=1,t=this.csvMarker.getRows(),n=this.commonOptions.getOptions(),e.prev=4,e.next=7,Object(ge.a)(t.length);case 7:i=e.sent,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(4),console.error(e.t0),i={isOverLimit:!1};case 14:if(!i.isOverLimit){e.next=17;break}return this.state.errorImport={msg:"Monitor limit exceeded"},e.abrupt("return");case 17:this.importAll(t,n),e.next=24;break;case 20:e.prev=20,e.t1=e.catch(1),console.error(e.t1),this.state.errorImport={msg:"Import failed: ".concat(e.t1.message||e.t1.msg)};case 24:case"end":return e.stop()}}),e,this,[[1,20],[4,10]])}))),function(){return s.apply(this,arguments)})},{key:"importAll",value:(i=r()(a.a.mark((function e(t,n){var i,s,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=this.state).progress={index:0,total:t.length,msg:"Importing labels..."},s=0;case 3:if(!(s<t.length)){e.next=11;break}return r=t[s],i.progress=Ae({},i.progress,{msg:"Importing ".concat(r.url)}),e.next=8,this.importOne(r,n);case 8:s+=1,e.next=3;break;case 11:i.progress=Ae({},i.progress,{msg:"Imported ".concat(t.length)});case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"importOne",value:(n=r()(a.a.mark((function e(t,n){var i,s,r,o,l,c,d,h,u,p,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.tags,s=n.actions,r=X()(n,["tags","actions"]),!t.rule){e.next=6;break}return e.next=4,g.a.api("/rules","POST",{config:t.rule});case 4:o=e.sent,t.rule_id=o.id;case 6:if(l=[],c=t.labels||"",delete t.label,!(c.length>0)){e.next=13;break}return e.next=11,App.labels.getOrCreateLabels(c);case 11:d=e.sent,l.push.apply(l,z()(d));case 13:if(i&&i.length>0)for(i=i.split(","),h=0;h<i.length;h+=1)l.push(App.labels.get(i[h]));return t.tags=l.map((function(e){return e.id})).join(","),t.uri=t.url,delete t.url,u=_.extend({client_id:App.clients.defaultId,content_type:2,config:JSON.stringify({includeStyle:!0,ignoreEmptyText:!0,dataAttr:"text",selections:[{frames:[{index:0,excludes:[],includes:[{type:"css",expr:"body"}]}],dynamic:!0,delay:2}]})},t,r),e.next=20,g.a.api("/sieves","POST",u);case 20:p=e.sent,f=0;case 22:if(!(f<s.length)){e.next=28;break}return e.next=25,g.a.api("/sieves/".concat(p.id,"/actions"),"POST",_.extend({sieve_id:p.id},s[f]));case 25:f+=1,e.next=22;break;case 28:this.state.progress=Ae({},this.state.progress,{index:this.state.progress.index+1});case 29:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onBack",value:function(){this.state.stage-=1}},{key:"onFileChange",value:function(e){var t=this,n=e.target.files[0],i=new FileReader;i.readAsText(n,"utf-8"),i.onload=function(e){return t.onFileRead(e.target.result)},i.onerror=function(e){return t.onFileReadError(e)},this.state.filename=n.name}},{key:"onFileRead",value:function(e){var t=this;Papa.parse(e,{header:!0,skipEmptyLines:!0,complete:function(e){t.showData(e)}})}},{key:"onFileReadError",value:function(e){console.error("error reading file",e),this.state.errorFile=e.message}},{key:"onFileSelect",value:function(e){this.el.querySelector("[type=file]").click()}},{key:"onNextToOptions",value:function(){var e,t=this.csvMarker.getInputFields();if(null==!t.name)e={key:"name",msg:"Missing name"};else if(t.url){var n=ie()(this.state.resultOrig.data,2),i=n[0],a=n[1],s=t.url,r=i[s],o=a[s];try{new URL(r),new URL(o)}catch(t){console.error(s,i,t),e={key:"url",msg:"malformed url"}}}else e={key:"url",msg:"Missing URL"};console.log("inputFields;",t,e),e?this.setState({errorMap:e}):(this.commonOptions=new Me({inputFields:t}),this.state.stage=3)}},{key:"showData",value:function(e){this.state.resultOrig=e,this.state.stage=2,this.csvMarker=new Ve({result:e})}},{key:"createTpl",value:function(e){var t=this,n=(e.csvText,e.progress),i=e.stage,a=e.errorMap,s=e.errorImport,r=n.index<n.total-1;return Object(fe.b)(De(),Object(c.a)("a_import"),1==i?Object(fe.b)(Ie(),(function(e){return t.onFileChange(e)}),(function(e){return t.onFileSelect(e)}),i>1?Object(fe.b)(Se(),this.state.filename):""):"",2==i?Object(fe.b)(Oe(),this.csvMarker.el,(function(e){return t.onBack()}),(function(e){return t.onNextToOptions()}),a?Object(fe.b)(xe(),a.msg):""):"",3==i?Object(fe.b)(ye(),this.commonOptions.el,(function(e){return t.onBack()}),(function(e){return t.onImport()}),Object(c.a)("a_import")):"",4==i&&r?Object(fe.b)(_e(),n.index,n.total,n.msg||""):"",4!=i||r?"":Object(fe.b)(we(),n.msg||"",(function(e){return t.reset()})),s?Object(fe.b)(be(),s.msg):"")}}]),t}(fe.a);function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(n,!0).forEach((function(t){K()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fe,He,Ye,Je=window.jQuery,Qe=v.a.ActionProvider.extend({name:"importer",events:{"click .btn-primary":"event_click"},event_click:function(){this.doImport()},doImport:(Ye=r()(a.a.mark((function e(){var t,n,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.input.value,n=JSON.parse(t),i=this.actions.toJSON(),s={},e.prev=5,e.next=8,Object(ge.a)(n.data.length);case 8:s=e.sent,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),console.error(e.t0),s={isOverLimit:!1};case 15:if(!s.isOverLimit){e.next=18;break}return m.a.error("Monitor limit exceeded!"),e.abrupt("return");case 18:return e.next=20,this.importAll(n,i);case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(0),console.error(e.t1),m.a.error("Failed to parse data. Invalid JSON.");case 26:case"end":return e.stop()}}),e,this,[[0,22],[5,11]])}))),function(){return Ye.apply(this,arguments)}),fromJSON:function(){this.progress=0,this.totalCount=0,this.input.value="",this.updateStatus()},importAll:(He=r()(a.a.mark((function e(t,n){var i,s,r,o,l,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.$(".btn-primary").button("loading"),m.a.info("Importing labels..."),e.prev=2,i=_.uniq(_.flatten(_.pluck(t.data,"tags"))),e.next=6,App.labels.getOrCreateLabels(i);case 6:s=e.sent,r=_.object(_.pluck(s,"name"),_.pluck(s,"id")),this.progress=0,this.totalCount=t.data.length,this.updateStatus(),o=t.data,l=0;case 13:if(!(l<o.length)){e.next=20;break}return c=o[l],e.next=17,this.importOne(c,n,r);case 17:l+=1,e.next=13;break;case 20:m.a.info("Import completed"),this.$(".btn-primary").button("reset"),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(2),console.error("failed to import data:",e.t0),m.a.error("Error importing data: "+e.t0);case 28:case"end":return e.stop()}}),e,this,[[2,24]])}))),function(e,t){return He.apply(this,arguments)}),importOne:(Fe=r()(a.a.mark((function e(t,n,i){var s,r,o,l,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.rule){e.next=5;break}return e.next=3,g.a.api("/rules","POST",{config:t.rule});case 3:s=e.sent,t.rule_id=s.id;case 5:return t.tags&&(t.tags=_.map(t.tags,(function(e){return i[e]})).join(",")),e.next=8,g.a.api("/sieves","POST",Be({},t,{client_id:App.clients.defaultId}));case 8:r=e.sent,o=r.id,l=0;case 11:if(!(l<n.length)){e.next=18;break}return c=n[l],e.next=15,g.a.api("/sieves/".concat(o,"/actions"),"POST",Be({},c,{sieve_id:o}));case 15:l+=1,e.next=11;break;case 18:this.progress+=1,this.updateStatus();case 20:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return Fe.apply(this,arguments)}),updateStatus:function(){Je(this.counter).text(this.progress),Je(this.total).text(this.totalCount),this.totalCount>0&&this.progress==this.totalCount?Je(this.msgStatus).text(" - Complete!"):Je(this.msgStatus).text("")},postInit:function(){this.actions=new S.a.SieveActions(null,{}),this.actionEditor=new me.a.SieveActionsEditor({actions:this.actions,parent:this})},render:function(){return this.$el.append(DIV({class:"xtbar  xvbar-margin"},BUTTON({class:"btn btn-default","data-action":"go_back"},I({class:"fa fa-chevron-left"})," Back")),H2({class:"xpage-header"},H2(this.title=SPAN(""),SPAN(Object(c.a)("a_import")))),DIV({class:"row"},DIV({class:"col-md-5"},H4("Actions for imported monitors"),this.actionEditor.render().el),DIV({class:"col-md-7"},this.input=TEXTAREA({class:"form-control",style:"width:100%;min-height:300px",placeholder:"Paste JSON data to import and click Import."}))),DIV({style:"margin-top: 20px;"},BUTTON({class:"btn btn-primary"},Object(c.a)("a_import"))," Imported: ",this.counter=SPAN("0")," of ",this.total=SPAN("0"),this.msgStatus=SPAN()),DIV()),this}}),qe=n(77),We=n(78);if(!window.domo)throw new Error("ADD domo");var ze=window._;if(!ze)throw new Error("ADD _");if(!window.jQuery)throw new Error("ADD jQuery");var Ge=window.Backbone;if(!Ge)throw new Error("ADD Backbone");var Xe={PreRenderedForm:v.a.Form.extend({name:"PreRenderedForm",fields:[],postInit:function(){this.model||(this.model=new Ge.Model),this.initEditors()},getFieldEl:function(e){var t=e.name.replace("[","\\[").replace("]","\\]");return this.$el.find("[name="+t+"]")},initEditors:function(){this.editors=ze.map(this.fields,(function(e){return T.a.create(e.type,{param:e,parent:this,model:this.model,el:this.getFieldEl(e).parent()[0]}).acquire()}),this)},validateFields:function(){return ze.filter(this.editors,(function(e){return!e.isValid()}),this)}})},Ze=window.jQuery;if(!Ze)throw new Error("ADD jQuery");var Ke=window._;if(!Ke)throw new Error("ADD _");var et=Xe.PreRenderedForm.extend({name:"SearchForm",events:{"input input":"event_input"},fields:[{name:"q",type:"text"}],event_input:function(){this.search()},postInit:function(){var e=this,t=["is:\n on,off,read,unread","has:\nerror","label:\ncustom labels","in:\ndeleted items"],n=["on","off","read","unread"],i=Ke.map(n,(function(e,t){return{id:t,name:e}})),a=Ke.map(t,(function(e,t){return{id:t,name:e}}));Ze(this.el.q).atwho({at:"has:",data:["error"]}).atwho({at:"in:",data:["trash"]}).atwho({at:"is:",callbacks:{filter:function(e,t,n){var i,a,s,r;for(i=[],a=0,r=t.length;a<r;a++)0!=(s=t[a])[n].toLowerCase().indexOf(e.toLowerCase())&&""!==e||i.push(s);return i}},data:i}).atwho({at:"label:",limit:10,callbacks:{matcher:function(e,t,n,i){var a,s,r;return e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n&&(e="(?:^|\\s)"+e),a=decodeURI("%C3%80"),s=decodeURI("%C3%BF"),(r=new RegExp(e+"([A-Za-z"+a+"-"+s+"0-9_"+(i?" ":"")+"\"'.+-]*)$|"+e+"([^\\x00-\\xff]*)$","gi").exec(t))?r[2]||r[1]:null},filter:function(t,n,i){var a,s,r,o;a=[];var l=e.options.labels.map((function(e,t){var n=e.get("name").replace(/"/g,escape('"'));return{id:t,name:n.indexOf(" ")>=0?'"'+n+'"':n}}));for(s=0,o=l.length;s<o;s++){var c=(r=l[s])[i].toLowerCase();0!=c.replace('"',"").replace("'","").indexOf(t.toLowerCase())&&0!=c.indexOf(t.toLowerCase())&&""!==t||a.push(r)}return a}},data:[]}).atwho({at:"",startWithSpace:!0,callbacks:{filter:function(e,t,n){var i,a,s,r;for(i=[],a=0,r=t.length;a<r;a++)s=t[a],0!=new String(s[n]).toLowerCase().indexOf(e.toLowerCase())&&""!==e||i.push(s);return i},tplEval:function(e,t){return"<li data-name='"+Ke.escape(t.name.split("\n")[0])+"'>"+Ke.escape(t.name.split("\n")[0])+"      <span style='color:grey;'>"+Ke.escape(t.name.split("\n")[1])+"</span></li>"},beforeInsert:function(e,t){return t.data("name")}},data:a,suffix:""}).on("inserted.atwho",(function(t,n,i){var a=n.data("name");a&&":"===a[a.length-1]||e.search(),Ze(this).atwho("run")})),this.model||(this.model=new Backbone.Model),et.__super__.postInit.apply(this,arguments)},search:Ke.debounce((function(){var e=this.el.q.value.trim();App.nav("search/"+encodeURIComponent(e))}),600),submit:function(){return this.search(),!1}}),tt=et,nt=window.jQuery;if(!nt)throw new Error("ADD jQuery");var it=window._;if(!it)throw new Error("ADD _");if(!window.async)throw new Error("ADD async");if(!window.domo)throw new Error("ADD domo");if(!window.Backbone)throw new Error("ADD Backbone");var at=v.a.Base.extend({name:"label",tagName:"li",postInit:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove",this.remove)},render:function(){var e=this.model.get("name");return this.$el.empty().append(A({href:"#","data-path":"label/"+encodeURIComponent(e)},e),DIV({class:"dropdown",style:"position:absolute;top:2px;right:0;"},BUTTON({class:"btn btn-mini xbtn-light dropdown-toggle","data-toggle":"dropdown"},I({class:"fa fa-caret-down"})),UL({class:"dropdown-menu dropdown-menu-right"},LI(A({"data-action":"nav label rename","data-action-param":this.model.id},I({class:"fa fa-pencil","aria-hidden":!0}),"  ",Object(c.a)("a_rename"))),LI(A({"data-action":"nav label del","data-action-param":this.model.id},I({class:"fa fa-trash-o","aria-hidden":!0}),"  ",Object(c.a)("a_del")))))).css({postion:"relative"}),this}}),st=v.a.Entities.extend({name:"LabelNavList",className:"nav nav-list",tagName:"ul",actions:{"nav label add":{fn:"action_add"},"nav label del":{fn:"action_del"},"nav label rename":{fn:"action_rename"}},events:{"click a[data-path]":"action_route"},action_add:function(){var e=this,t=T.a.create("text"),n=new v.a.PromptModal({title:"l_label",parent:this.getRoot(),view:t,width:500});n.show(),nt(t.field).focus(),n.on("save",(function(){var i=t.getValue();it.isEmpty(i)?n.showAlert("e_value_incorrect_check"):(n.remove(),e.collection.create({name:i},{wait:!0}))}))},action_del:function(e){var t=this.collection.get(e);t&&confirm("Delete label - "+t.get("name")+"?")&&t.destroy()},action_rename:function(e){var t=this.collection.get(e),n=T.a.create("text",{param:{label:"l_label",must:!0,name:"name"},model:t.clone(),parent:this}),i=new v.a.PromptModal({title:"l_label",parent:this.getRoot(),view:n,width:500});i.on("save",(function(){var e=n.getValue();i.showProgress(),t.save({name:e},{patch:!0,wait:!0,error:function(e,t){i.showProgress(!1),e.showAlert("e_req")},success:function(e,t){i.showProgress(!1),i.remove()}})})),i.show()},action_route:function(e){var t=e.target,n=nt(t).attr("data-path");e.preventDefault(),e.stopPropagation(),App.nav(n,{trigger:!0})},addOne:function(e,t){var n=new at({model:e,parent:this}).render();this.$divider.before(n.el)},removeOne:function(e){e.trigger("remove")},renderBase:function(){this.$divider=this.$el.find(".divider").last()},select:function(e,t){e+=t?"/"+encodeURIComponent(t):"",this.currentPath=e,this.$el.find("li.active").removeClass("active");var n=this.$el.find('li a[data-path="'+e+'"]');n.parents("li").addClass("active"),n.length>1&&new v.a.Modal({title:"Duplicate Labels",parent:this,view:new v.a.Base({el:DIV("There are duplicate labels present in your list. When labels from other devices are synced together, all of them are collected in one place. If you synced data, it may be the reason for duplicate labels. In any case, you should rename or delete one of them.")})}).show()}}),rt=at.extend({render:function(){this.$el.append(INPUT({type:"chechbox"}),LABEL({},this.model.get("name")))}}),ot=st.extend({addOne:function(){var e=new rt({model:model,parent:this}).render();this.$list.append(e.el)},getSelections:function(){},onAdd:function(){},postInit:function(){},renderBase:function(){var e,t;this.$el.append(e=INPUT({type:"textbox",class:"hide"}),LI({class:"divider"}),t=UL({class:"nav nav-list"}),LI({class:"divider"}),LI(BUTTON({class:"btn hide"},Object(c.a)("a_add")))),(void 0).onclick=this.onAdd,this.$input=nt(e),this.$list=nt(t)}}),lt={LabelNavList:st,LabelSelectionList:ot},ct=window.async;if(!ct)throw new Error("ADD async");if(!window.domo)throw new Error("ADD domo");var dt=window.jQuery;if(!dt)throw new Error("ADD jQuery");if(!window.moment)throw new Error("ADD moment");var ht=v.a.ActionProvider.extend({className:"panel form form-horizontal",load:function(e){var t=this;window.USER?ct.parallel({user:function(e){g.a.api("/users/self",e)},subscription:function(e){g.a.api("/subscriptions?state=40&_opt[limit]=1",(function(t,n){e(t,n&&n.data[0])}))}},(function(e,n){t.renderAccountDetails(n.user,n.subscription)})):(dt(this.body).text(Object(c.a)("m_sign_in_req")),e())},render:function(){return this.$el.append(DIV({class:"panel-heading"},H3(Object(c.a)("l_account"))),this.body=DIV({class:"panel-body"},Object(c.a)("l_loading"))),this},renderAccountDetails:function(e,t){dt(this.body).empty().append(DIV({class:"form-group"},LABEL({class:"col-sm-3"},Object(c.a)("l_email")),DIV({class:"col-sm-9"},e.email)),DIV({class:"form-group"},LABEL({class:"col-sm-3"},Object(c.a)("l_username")),DIV({class:"col-sm-9"},e.name)),DIV({class:"form-group"},LABEL({class:"col-sm-3"},Object(c.a)("l_subscription")),DIV({class:"col-sm-9"},A({href:"/settings/billing"},ut[t.plan_id]))),DIV({class:"form-group"},LABEL({class:"col-sm-3"},Object(c.a)("l_credit")),DIV({class:"col-sm-9"},"$",SPAN({class:"xcredit"},e.credit/100))))}}),ut={"00000000-0000-0000-0000-000000000000":"Free","11111111-1111-1111-1111-111111111111":"Basic","22222222-2222-2222-2222-222222222222":"Pro","33333333-3333-3333-3333-333333333333":"Flexi","44444444-4444-4444-4444-444444444444":"Free trial"},pt=ht;if(!window.domo)throw new Error("ADD domo");var ft=window.jQuery;if(!ft)throw new Error("ADD jQuery");var mt=v.a.ActionProvider.extend({className:"panel",load:function(e){var t=this;window.USER?g.a.api("/users/usage/monthly?_opt[limit]=1",(function(n,i){if(n);else{var a;a=0==i.data.length?{run:0,email:0,sms:0}:i.data[0],g.a.api("/users/constraints",(function(e,n){t.renderUsage(a,n)}))}e(n)})):(ft(this.body).text(Object(c.a)("m_sign_in_req")),e())},render:function(){return this.$el.append(DIV({class:"panel-heading"},H3(Object(c.a)("l_usage"))),this.body=DIV({class:"panel-body form form-horizontal"},Object(c.a)("l_loading"))),this},renderProgress:function(e,t,n){var i=Math.min(100,100*t/n|0);return t>0?DIV({class:"form-group"},LABEL({class:"col-sm-2"},e),DIV({class:"col-sm-10"},DIV({class:"progress",role:"progressbar"},DIV({class:"progress-bar"+(i>95?"progress-bar-danger":""),"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":n,style:"min-width: 40px;width: "+i+"%"},SPAN(t))))):""},renderUsage:function(e,t){ft(this.body).empty().append(this.renderProgress("Checks",e.run,t.run),this.renderProgress("Emails",e.email,t.email),this.renderProgress("SMSes",e.sms,t.sms))}}),vt=window.async;if(!vt)throw new Error("ADD async");var gt=v.a.ActionProvider.extend({load:function(e){var t=this;vt.parallel([function(e){t.account.load(e)},function(e){t.usage.load(e)}],e)},postInit:function(){this.account=new pt({parent:this}),this.usage=new mt({parent:this})},render:function(){return this.$el.append(this.account.render().el,this.usage.render().el,I()),this}}),bt=n(38);if(!window.domo)throw new Error("ADD domo");var wt=window.jQuery;if(!wt)throw new Error("ADD jQuery");var _t=window._;if(!_t)throw new Error("ADD _");var yt=window.async;if(!yt)throw new Error("ADD async");if(!window.moment)throw new Error("ADD moment");var xt=window.Backbone;if(!xt)throw new Error("ADD Backbone");function Ot(e){return e.replace(/[[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function St(e){var t={};return e.searchParams.forEach((function(e,n){t[n]=e})),t}var It=v.a.Base.extend({name:"SieveTplRow",tagName:"li",className:"list-group-item",onDel:function(){this.model.destroy()},render:function(){var e,t=this.model.attributes;return this.$el.empty().attr({"data-id":t.id}).append(DIV(DIV({style:"float: left"},e=BUTTON({class:"btn btn-default xbtn-light",title:Object(c.a)("a_del")},I({class:"fa fa-trash-o"}))),DIV(DIV(t.desc_name),DIV(t.desc_uri)))),e.onclick=this.onDel,this}}),Dt=v.a.Collection.extend({name:"TplCollection",tagName:"ul",className:"list-group",addOne:function(e){var t=new It({model:e,parent:this});return this.$el.append(t.render().el),t}}),Tt=v.a.ActionProvider.extend({postInit:function(){U.a.agents.local&&!U.a.isSignedIn()?this.view=new xt.View({el:DIV("Please sign in to your account and try again")}):this.view=new Dt({collection:this.collection=new V.Tpls,parent:this})},render:function(){return this.$el.empty().append(DIV({class:"xtbar xvbar-margin"},BUTTON({class:"btn btn-default","data-action":"go_back"},I({class:"fa fa-chevron-left"})," ")),DIV({class:"xpage-header"},H3(Object(c.a)("l_sieve_tpl_list")," ",SMALL("(beta)"))),this.view.render().el),this},showList:function(){this.collection&&this.collection.fetch({data:{user_id:USER.id}})}}),Et=v.a.ActionProvider.extend({postInit:function(e){var t=this.model;this.fields={name:T.a.create("text",{parent:this,model:t,param:{name:"desc_name",help:"h_tpl_desc_name"}}),info:T.a.create("textarea",{parent:this,model:t,param:{name:"desc_info",help:"h_desc"}})}},render:function(){var e=this.fields;return this.$el.empty().append(_t.map(["name","info"],(function(t){return DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(c.a)("l_tpl_desc_"+t)),DIV({class:"col-md-10"},e[t].render().el))}))),this}}),At=v.a.ActionProvider.extend({name:"SimpleTplEditor",actions:{tpl_save:{fn:"action_save"}},action_save:function(e,t){var n=this,i=this.model.clone();function a(){n.patterns.tpl=i,yt.each(n.patterns.models,s,(function(e,n){e?r(e):(wt(t).button("reset"),App.nav("tpls"))}))}function s(e,t){e.save(null,{error:function(){t(new Error("Failed to save pattern"))},success:function(){t()}})}function r(e){console.error("Error saving template",e),wt(t).button("reset"),m.a.error("Failed to save template")}wt(t).button("loading"),i.save({sieve_config:JSON.parse(this.sieve.config),sieve_type:this.sieve.content_type},{error:r,success:function(e){m.a.info("Template saved!"),setTimeout(a,0)}})},handleNetworkError:function(){var e="Failed to load data. Please check network connection and try again.";U.a.agents.local&&!U.a.isSignedIn()&&(e="Please sign in to your account and try again"),this.$elLoad.addClass("error").text(e)},postInit:function(e){var t=this.model;this.patterns=new V.Patterns,this.pattern=new V.Pattern,this.patterns.add(this.pattern),this.views={patternURIEditor:new T.a.create("text",{parent:this,model:this.pattern,param:{name:"pattern",help:"h_tpl_url_pattern"}}),desc:new Et({parent:this,model:t}).render()},this.$el.addClass("form-horizontal"),this.$el.empty().append(DIV({class:"xpage-header"},H4(Object(c.a)("Match URL"))),DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(c.a)("l_uri_pattern")),this.elTip=DIV({class:"col-md-10 hide"},this.views.patternURIEditor.render().el),this.elLoad=DIV({class:"col-md-10"},"Loading data...")),DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},Object(c.a)("l_url")),DIV({class:"col-md-10"},this.elURL=DIV())),this.elDesc=DIV({class:"hide"},DIV({class:"xpage-header"},H4(Object(c.a)("l_desc"))),this.views.desc.el,DIV({class:"form-group"},DIV({class:"col-md-offset-2 col-md-10 xtbar-form"},BUTTON({class:"btn btn-primary xbtn-default","data-action":"tpl_save"},Object(c.a)("a_save")),BUTTON({class:"btn btn-default","data-action":"go_back"},Object(c.a)("a_discard")))))),this.$elLoad=wt(this.elLoad),this.start()},setPattern:function(e){var t=this.sieve;new URL(t.uri);wt(this.elLoad).remove(),wt(this.elTip).removeClass("hide"),wt(this.elDesc).removeClass("hide"),e?wt(this.elDesc).find("input").first().focus():wt(this.elTip).find("input").focus(),this.pattern.set({pattern:e||Ot(t.uri.split("/").slice(2).join("/"))+"$",uri_ref:t.uri}),this.model.set({desc_name:t.name,desc_info:"",desc_uri:t.uri.split("/").slice(0,3).join("/")})},start:function(){var e=this;g.a.api("/sieves/"+this.options.sieveId,"GET",{},(function(t,n){if(t)e.handleNetworkError();else{e.sieve=n;var i=n.uri;e.$elLoad.text("Finding URL pattern..."),e.elURL.textContent=i,yt.parallel({sieves:function(e){var t=new URL(i).host;g.a.api("/sieves","GET",{"uri.ne":i,"uri.like":"%"+t+"%","state.in":[40,45]},e)},patterns:function(e){g.a.api("/tpls/patterns/search","GET",{url:i},e)}},(function(t,i){t?(console.error("Failed to fetch data: ",t),e.handleNetworkError()):e.suggestOptions(n,i.sieves.data,i.patterns.data)}))}}))},suggestOptions:function(e,t,n){var i,a=this,s=e.uri;this.$elLoad.empty(),n.length>0?i=n:t.length>0&&(i=this.generatePatterns(s,t)),i?(i=_t.uniq(i,(function(e){return e.pattern})),this.$elLoad.append(DIV({class:"list-group"},_t.map(i,(function(e){return A({href:"#",class:"list-group-item"},DIV(SAMP(e.pattern)),SMALL(e.uri_ref))}))),P(),BUTTON({class:"btn btn-default"},"Or, use custom pattern")),this.$(".list-group-item").click(".list-group-item",(function(e){e.preventDefault(),a.setPattern(wt(e.currentTarget).find("samp").text())})),this.$elLoad.find("button").click((function(){a.setPattern()}))):this.setPattern()},generatePatterns:function(e,t){var n=e.split("/"),i=new URL(e),a=i.pathname.split("/"),s=St(i),r=_t.filter(t,(function(e){var t=new URL(e.uri),n=t.pathname.split("/"),i=St(t);return a.length==n.length&&_t.isEqual(_t.keys(s),_t.keys(i))}));if(r.length>0)return _t.map(r,(function(e){var t=e.uri.split("/"),a=_t.map(n,(function(e,n){return e===t[n]?Ot(e):e.length>0?"(.*)":""}));return a[2]=Ot(n[2]),{pattern:a.slice(2).join("/")+("/"==i.pathname?"$":""),uri_ref:e.uri}}))}}),kt={TplList:Tt,Editor:v.a.ActionProvider.extend({name:"TplEditor",create:function(e){this.view&&this.view.remove(),this.view=new At({parent:this,sieveId:e,model:new V.Tpl}),this.elView.appendChild(this.view.render().el)},render:function(){return this.$el.empty().append(DIV({class:"xtbar"},BUTTON({class:"btn btn-default","data-action":"go_back"},I({class:"fa fa-chevron-left"})," ",Object(c.a)("a_discard"))),DIV({class:"xpage-header"},H3(Object(c.a)("l_tpl")," ",SMALL("Templates help add monitors using preconfigured selections."))),this.elView=DIV()),this}})};if(!window.domo)throw new Error("ADD domo");var Pt=window.jQuery;if(!Pt)throw new Error("ADD jQuery");var Lt=window._;if(!Lt)throw new Error("ADD _");var jt=window.async;if(!jt)throw new Error("ADD async");if(!window.moment)throw new Error("ADD moment");var Rt=window.Backbone;if(!Rt)throw new Error("ADD Backbone");var Nt=v.a.ActionProvider.extend({name:"SieveFromTpl",actions:{add_next:{fn:"action_next"}},action_next:function(){this.createAndSaveSieve()},add:function(e,t,n){this.title=n,this.url=t,this.tpl=new V.Tpl({id:e}),this.patterns=new V.Patterns,this.patterns.tpl=this.tpl,this.loadModels([this.tpl,this.patterns],this.onLoadModels),this.$(".xbtn-default").button("loading")},build:function(e,t,n){function i(e){var i=t[e]||"";return n?encodeURIComponent(i):i}return e.replace(/#\{\{(\w*)\}\}/g,(function(e,t){return JSON.stringify(i(t))})).replace(/\{\{(\w*)\}\}/g,(function(e,t){return i(t)}))},createAndSaveSieve:function(){var e=this.tpl.id,t=this.tpl.toJSON(),n=this.model,i=Lt.extend(this.values,n.attributes),a=t.sieve_uri?this.build(t.sieve_uri,i,!0):this.url;if(!Lt.isEmpty(this.findEmptyParams(this.params,i)))return m.a.error("Please enter paramter values before proceeding.");var s={content_type:t.sieve_type,config:this.build(t.sieve_config,this.values),uri:a,schedule:JSON.stringify({type:"INTERVAL",params:{interval:3600}}),state:D.a.STATE_INIT,client_id:App.clients.defaultId},r=new S.a.Sieve(s,{parse:!0});r.get("config").set("meta",{tplId:e}),this.options.onSave(r)},findEmptyParams:function(e,t){return Lt.filter(e,(function(e){return Lt.isEmpty(t[e.name])}))},loadModels:function(e,t){jt.each(e,(function(e,t){e.fetch({error:function(e,n){t(n)},success:function(){t(null,e)}})}),t)},onLoadModels:function(e){if(e)return m.a.error("Failed to fetch models");var t=this.patterns.at(0),n=t?this.pickValues(this.url,t):{},i=this.tpl.get("params").toJSON(),a=this.findEmptyParams(i,n);if(this.params=i,this.model=new Rt.Model,this.values=n,a.length>0){var s=Lt.map(a,(function(e){return T.a.create(e.type,{parent:this,model:this.model,param:{name:e.name,help:e.desc||""}})}),this);this.renderEditors(s),this.$(".xbtn-default").button("reset")}else this.createAndSaveSieve()},pickValues:function(e,t){var n=t.get("pattern_params").toJSON(),i=new RegExp(t.get("pattern")).exec(e)||[],a={};return Lt.each(n,(function(e){a[e.name]=i[e.index+1]})),a},render:function(){var e=this.options.renderNavbar;return this.$el.empty().append(e?DIV({class:"xtbar xvbar-margin"},BUTTON({class:"btn btn-default","data-action":"go_back"},I({class:"fa fa-chevron-left"})," ",Object(c.a)("a_discard"))):"",DIV({style:"padding: 10px;"},e?DIV({class:"xpage-header"},H3(Object(c.a)("l_add_monitor"))):"",DIV({class:"form-horizontal"},this.elContent=DIV(),DIV({class:"form-group"},DIV({class:"col-md-offset-2 col-md-10 xtbar-form"},BUTTON({class:"btn btn-primary xbtn-default","data-action":"add_next"},Object(c.a)("a_next")," ",I({class:"fa fa-chevron-right"}))))))),this},renderEditors:function(e){this.editors&&Lt.each(this.editors,(function(e){e.remove()})),this.editors=e,Pt(this.elContent).empty().append(DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},"Source URL"),DIV({class:"col-md-10"},SPAN(this.url||"None")))).append(Lt.map(e,(function(e){return DIV({class:"form-group"},LABEL({class:"control-label col-md-2"},e.param.name),DIV({class:"col-md-10"},e.render().el))})))}});n(54);if(!window.domo)throw new Error("ADD domo");if(!window.jQuery)throw new Error("ADD jQuery");if(!window._)throw new Error("ADD _");if(!window.Backbone)throw new Error("ADD Backbone");v.a.Base.extend({name:"DeviceView",postInit:function(){var e=this;window.addEventListener("message",(function(t){console.log(t,t.data,t.origin),"event"==t.data.type&&e.trigger("frame:"+t.data.data)})),this.on("frame:ready",(function(){e.postMessage({type:"request",data:{action:"login"}})}))},postMessage:function(e){this.iframe.contentWindow.postMessage(e,h.a.CFG.URL.ROOT)},render:function(){this.$el.empty().append(DIV({name:"device-manager"},this.iframe=IFRAME({src:h.a.CFG.URL.ROOT+"/frame-devices",style:"width: 80%; height: 100vh",frameborder:"none"})))}});var Ct=n(79),Vt=n(76),Mt=n(74),Ut=window.async;if(!Ut)throw new Error("ADD async");var $t=window.jQuery;if(!$t)throw new Error("ADD jQuery");var Bt=window.Backbone;if(!Bt)throw new Error("ADD Backbone");t.default=function(){Object(l.a)(),!h.a.auth.isReady()&&(location.href=h.a.service.serviceLoginUrl);var e=window.USER,t=new b.a.Clients,n=new O.Labels,i=new S.a.Sieves(null,{comparator:function(e){return-e.get("ts_data")}}),s=new f,u="inbox";function p(){h.a.service.active?m.a.reset():m.a.error("Checks are paused. You may resume checks from menu popup.")}function w(){m.a.start("init",{info:"l_loading"}),m.a.showHelp(),$t("#topbar").removeClass("hide"),$t("#topbar-user").html('<div class="xnav-item"><a href='.concat(USER.name?'"'.concat(Vt.a.settings,'">').concat(USER.name):'"'.concat(Vt.a.login,'">Sign In'),"</a></div>")),Object(o.b)(Object(Ct.a)(),document.getElementById("x-vsidebar")),$t("#x-vsidebar").find('[data-toggle="tooltip"]').tooltip({placement:"right"}),$t("#x-vsidebar").find(".vbar-tooltip").tooltip({placement:"right"}),Ut.parallel([function(e){t.fetch({data:{"state.in":[0,30],_opt:{order:["ts"]}},error:function(){e(new Error("Failed to fetch clients' list."))},success:function(){t.defaultId=h.a.store.Prefs.get("client.id"),e()}})},function(){var e=r()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(USER.id){e.next=3;break}return USER.constraint={interval:5},e.abrupt("return",t());case 3:return e.prev=3,e.next=6,g.a.api("/users/constraints");case 6:n=e.sent,USER.constraint=n,t(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(3),console.error("Error fetching constraint:",e.t0),USER.constraint={interval:5},t();case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),function(e){n.fetch({data:{"state.ne":100,_opt:{order:["name"],limit:1e3}},error:function(){e(new Error("Failed to fetch labels."))},success:function(){e()}})}],(function(e){m.a.stop("init",e?{error:"err:fetch"}:void 0),Bt.history.start({root:ROUTE_ROOT,pushState:PUSH_STATE}),!e&&$t("#content").removeClass("hide"),h.a.service.active||p()}))}USER.prefs||(USER.prefs={}),s.__init__(),bt.a.on("clients",(function(){t.fetch({data:{"state.in":[0,30],_opt:{order:["ts"]}}})})),bt.a.on("tags",(function(){n.fetch({data:{"state.ne":100,_opt:{order:["name"],limit:1e3}}})})),bt.a.on("service:state",p);var _=v.a.RoutedRoot.extend({actions:{go_back:{fn:"action_go_back"}},events:{"click .xsidebar a":"event_nav"},action_go_back:function(e){App.navBack()},event_nav:function(e){u=location.hash.slice(1)},onChangeError:function(e){this.$(".xbadge-error").text(e)[e>0?"show":"hide"]()},onChangeUnread:function(e){this.$(".xbadge-unread").text(e)[e>0?"show":"hide"]()},postInit:function(e){_.__super__.postInit.call(this,e),this.listenTo(bt.a,"change:unread",this.onChangeUnread),this.listenTo(bt.a,"change:error",this.onChangeError)},render:function(){return this.$el.append(DIV({id:"planbar",style:"position:fixed;top:40px;width:100%;height:0;text-align:center;"}),DIV({class:"xsidebar"},DIV({class:"btn-group",style:"margin-bottom:20px;width:100%"},BUTTON({class:"btn btn-success dropdown-toggle","data-toggle":"dropdown",style:"width:100%"},Object(c.a)("a_add")),UL({class:"dropdown-menu",role:"menu"},LI(A({tabindex:-1,href:"#add/type-page"},Object(c.a)("l_webpage"))),LI(A({tabindex:-1,href:"#add/type-feed"},Object(c.a)("l_feed"))))),UL({class:"nav nav-pills nav-stacked",style:"margin-bottom:10px;"},LI(A({href:"#","data-path":"inbox"},Object(c.a)("l_all"))),LI(A({href:"#","data-path":"filter/unread"},SPAN({class:"badge xbadge-unread",style:"float: right"},""),Object(c.a)("l_unread"))),LI(A({href:"#","data-path":"filter/error"},SPAN({class:"badge xbadge-error",style:"float: right"},""),Object(c.a)("l_error"))),LI(A({href:"#","data-path":"trash"},Object(c.a)("l_trash"))),LI({class:"divider",style:"border:solid 1px #ccc"}),LI({class:"divider"}),LI(A({class:"btn btn-default","data-action":"nav label add"},Object(c.a)("a_add_label"))))),DIV({class:"xcontainer"},DIV({id:"list",class:"hide"}),DIV({id:"tpl-editor",class:"hide"}),DIV({id:"tpls",class:"hide"}),DIV({id:"sieve-editor",class:"hide"}),DIV({id:"sieve-from-tpl",class:"hide"}),DIV({id:"exporter",class:"hide"}),DIV({id:"importer-csv",class:"hide"}),DIV({id:"importer-json",class:"hide"}),DIV({style:""},M)),DIV({id:"summaries",class:"xslidebar"},DIV({class:"xhandle",role:"button"},I({class:"xvertical-middle fa fa-chevron-left"}),I({class:"xvertical-middle fa fa-chevron-right"})),DIV({class:"xcontent"}))),this},route:function(e){App.nav(e)}});window.App=new function(a){var r=Bt.Router.extend({routes:{"":"index","add/type-:type":"add","add/tpl-:id/url-:url(/:name)":"add_using_tpl_for_url","add-tpl/:from_id":"add_template","edit/:id":"edit","edit-dup/:id":"duplicate","edit-tpl/:id":"edit_tpl",export_csv:"export_csv",export_json:"export_json","filter/error(/:id)":"filter_error","filter/unread(/:id)":"filter_unread",import_csv:"import_csv",import_json:"import_json","inbox(/:id)":"inbox","label/:name(/:id)":"label","search/(:query)(/:id)":"search","tpls(/:id)":"tpls","trash(/:id)":"trash"},add:function(e){g.editNew(e),O(g)},add_template:function(e){w.create(e),O(w)},add_using_tpl_for_url:function(e,t,n){v.add(e,t,n),O(v)},duplicate:function(e){g.duplicate(e),O(g)},edit:function(e){g.edit(e),O(g)},edit_tpl:function(e){},export_csv:function(){l.asCSV(p),O(l)},export_json:function(){l.asJSON(p),O(l)},filter_error:function(e){p.showErred(e),O(p),f.select("filter","error")},filter_unread:function(e){p.showUnread(e),O(p),f.select("filter","unread")},import_csv:function(){c.reset(),O(c)},import_json:function(){h.fromJSON(),O(h)},index:function(){App.nav("/inbox")},inbox:function(e){p.showInbox(e),O(p),f.select("inbox")},label:function(e,t){var i=n.where({name:e});i.length>0?(p.showLabel(i[0],t),O(p),f.select("label",e)):m.a.error("e_label_na")},search:function(e,t){null!=e&&0!=e.length?(p.showSearch(e,t),O(p),f.select("search")):App.nav("/inbox")},tpls:function(e){y.showList(),O(y),f.select("tpls")},trash:function(e){p.showTrash(e),O(p),f.select("trash")}});this.clients=t,this.labels=n,this.sieves=i,this.store=s,this.user=e,this.router=new r,this.edit=function(e,t){this.nav("edit/"+e,t)},this.nav=function(e,t){if(!0!==t){var n=location.hash.slice(1),i=n.split("/"),a=(u||"/").split("/");i[0]==a[0]&&i[1]==a[1]||(u=n)}Bt.history.navigate(e,{trigger:!0})},this.navBack=function(){this.nav(u,!0)},this.toggleSlidebar=function(){var e=$t("#summaries"),t=e.hasClass("xslidebar-open");e.toggleClass("xslidebar-open"),t||b.load((function(e){e&&console.error("Failed to load summaries:",e)}))},$t(".btn").button();var o=this.root=new _({el:$t("#content")[0],router:this.router}).render(),l=new q({el:$t("#exporter")[0]}).render(),c=(new qe.a.FeedbackAnchor({el:$t("#feedback")[0],parent:o}).render(),new Ue({},{el:$t("#importer-csv")[0]})),h=new Qe({el:$t("#importer-json")[0],parent:o}).render(),p=(new We.a({el:$t("#langs")[0]}).render(),new tt({el:document.getElementById("form-search"),labels:n}),this.sieveList=new me.a.Sieves({clients:t,collection:i,labels:n,el:$t("#list")[0],parent:o,routePrefix:"inbox"}).render()),f=this.labelNavList=new lt.LabelNavList({collection:n,el:$t(".xsidebar > ul")[0],parent:o}).render(),v=new Nt({el:$t("#sieve-from-tpl")[0],parent:o,onSave:function(e){e.save(null,{error:function(e,t){console.error("Failed to save monitor. Error: ",t),m.a.error("Failed to save monitor, check console for more info.")},success:function(){App.edit(e.id,!0)}})}}).render(),g=new me.a.SieveOptions({clients:t,collection:i,el:$t("#sieve-editor")[0],parent:o}).render(),b=new gt({el:$t("#summaries > .xcontent")[0],parent:o}).render(),w=new kt.Editor({el:$t("#tpl-editor")[0],parent:o}).render(),y=new kt.TplList({el:$t("#tpls")[0],parent:o}).render();$t("#summaries > .xhandle").click(this.toggleSlidebar);var x=null;function O(e){e!=x&&(m.a.reset(),x==p&&(p.currentScrollTop=$t("#content").scrollTop()),$t("#"+e.name).show(),x&&x.el.classList.add("hide"),e.el.classList.remove("hide"),x=e,d.a.Acts.setActions(o.getActions()),e==p?$t("#content").scrollTop(p.currentScrollTop||0):$t("#content").scrollTop(0))}},bt.a.init(),$t((function(){Object(Mt.a)({app:service.CFG.CLIENT.NAME,url:service.CFG.URL.ER,version:service.CFG.VERSION,id:USER.id}),h.a.service.ready&&h.a.auth.isReady()?w():h.a.service.once("init",(function(){try{w()}catch(e){console.error("Error rendering app after init",e)}}))}))}},,,,function(e,t,n){"use strict";var i=n(0),a=window.jQuery;if(!a)throw new Error("ADD jQuery");t.a=function(){a("[data-placeholder]").each((function(){this.placeholder=Object(i.a)(this.getAttribute("data-placeholder"))})),a("[data-text]").each((function(){this.textContent=Object(i.a)(this.getAttribute("data-text"))})),a("[data-title]").each((function(){this.title=Object(i.a)(this.getAttribute("data-title"))}))}},function(e,t,n){var i=n(75);e.exports=function(e,t){if(null==e)return{};var n,a,s=i(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i,a=n(6),s=n.n(a),r=n(25),o=n.n(r),l=n(73),c=n.n(l);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e){var t=e.url,n=c()(e,["url"]);i=t,window.addEventListener("unhandledrejection",(function(e){var t=e.reason;f("object"==o()(t)?h({},t,{},n):h({file_url:"",message:JSON.stringify(t)},n))})),window.onerror=function(e,t,i,a,s){e.toLowerCase().indexOf("script error")>-1||f(h({message:e,file_url:t,app_url:document.URL,line:i,column:a,stack:s.stack},n));return!1}}var p=function(){var e=new WeakSet;return function(t,n){if("object"===o()(n)&&null!==n){if(e.has(n))return;e.add(n)}return n}};function f(e){fetch(i,{method:"POST",mode:"cors",body:JSON.stringify(e,p())}).then((function(e){})).catch((function(e){console.error("Request failure: ",e)}))}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,i,a={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}},function(e,t,n){"use strict";var i=n(2).a.CFG.URL.ROOT;t.a={api:"".concat(i,"/api/v1"),static:"/ui",error_reporter:"https://reporter.distillweb.net",error_reporter_local:"error-reporter-local",website:"https://distill.io",watchlist:"/ui/inbox.html#inbox",template:"/ui/inbox.html#tpls",availability:"".concat(i,"/analytics/availability"),settings:"/ui/settings.html#general",billing:"".concat(i,"/settings/billing"),login:"".concat(i,"/service-login?redirect=app://ui/inbox.html#inbox"),logout:"".concat(i,"/logout")}},function(e,t,n){"use strict";var i=n(0),a=n(4),s=n(10),r=window._;if(!r)throw new Error("ADD _");var o=window.Backbone;if(!o)throw new Error("ADD Backbone");var l=window.jQuery;if(!l)throw new Error("ADD jQuery");if(!window.domo)throw new Error("ADD domo");var c=a.a.Base.extend({name:"FeedbackForm",events:{"click button":"send_feedback","change input":"event_change","keypress textarea":"event_change"},event_change:function(e){var t=this;r.defer((function(){var n=e.target,i=n.name,a=n.value;a=a.trim(),t.model.set(i,a)}))},send_feedback:function(e){var t=this;e.preventDefault();var n=this.model.get("message"),i=this.model.get("emotion"),a=document.URL;n&&(s.a.api("/feedbacks","POST",{message:n,emotion:i,context:a},(function(e){})),l(this.form).addClass("hide").removeClass("form"),l(this.success).removeClass("hide"),window.setTimeout((function(){t.hide()}),2e3),this.model.set({message:"",emotion:""}))},hide:function(){l(window).off("mousedown",this.onAClick).off("keypress",this.onKeyup),this.remove()},removeChildren:function(){r.each(this.children.slice(0),(function(e){e.remove(),this.trigger("child:remove")}),this)},onAClick:function(e){var t=e.target;!l.contains(document.documentElement,t)&&document.documentElement!=t||l.contains(this.form,t)||this.hide()},onKeyup:function(e){console.log(e.keyCode),27==e.keyCode&&this.hide()},postInit:function(){r.defer((function(e){l(window).mousedown(e.onAClick).keyup(e.onKeyup)}),this)},render:function(){var e=this;return this.$el.append(DIV({class:"popover",style:"display: flex;\n        flex-wrap:wrap;\n        text-align:center;\n        top: auto;\n        left: 60px;\n        bottom: 50px;\n        width: 300px"},this.form=FORM({class:"form",role:"form"},TEXTAREA({type:"text",name:"message",placeholder:Object(i.a)("m_send_feedback"),style:"width: 100%; height: 120px; padding: 5px 10px 10px"},this.model.get("message")||""),DIV({style:"margin:0px 0px 2px 0px; width:auto;",class:"btn-group btn-group-toggle","data-toggle":"buttons"},r.map([{emo:"",title:Object(i.a)("l_happy")},{emo:"",title:Object(i.a)("l_suggestion")},{emo:"",title:Object(i.a)("l_sad")},{emo:"",title:Object(i.a)("l_confused")},{emo:"",title:Object(i.a)("l_dissatisfied")}],(function(t){return LABEL({class:"btn btn-secondary "+(t.emo==e.model.get("emotion")?"active":""),title:t.title},INPUT({type:"radio",value:t.emo,name:"emotion"}),t.emo)}))),BUTTON({type:"submit",class:"btn btn-primary pull-right ",style:"min-width:0"},Object(i.a)("a_send"))),this.success=DIV({class:"hide",style:"width:100%; ma-width: 30%; margin:20% 30%; "},Object(i.a)("m_thank_you"),"       "))),this.focus(),this}}),d=a.a.Base.extend({name:"FeedbackAnchor",events:{"click a":"event_click"},postInit:function(){this.model=new o.Model({emotion:""})},event_click:function(){var e=new c({model:this.model,parent:this}).render();l(this.popoverCt).append(e.el)},render:function(){return this.$el.append(A({class:"ripple",id:"feedAnchor",href:"#","data-toggle":"tooltip","data-html":"true",title:"<b>Feedback</b>"},I({class:"fa fa-comment","aria-hidden":"true"})),this.popoverCt=DIV({id:"feedPop"})),this}});t.a={FeedbackAnchor:d}},function(e,t,n){"use strict";var i=n(2),a=(n(0),n(9)),s=n(4),r=[{locale:"en-US",label:"English (US)"},{locale:"de",label:"Deutsch"},{locale:"fr",label:"Franais"},{locale:"ru",label:""},{locale:"ja",label:""},{locale:"zh",label:""},{locale:"es",label:"Espaol"},{locale:"it",label:"Italiano"},{locale:"pl",label:"Polskie"},{locale:"pt",label:"Portugus do Brasil"},{locale:"sr",label:""}],o=n(10),l=window._;if(!l)throw new Error("ADD _");if(!window.jQuery)throw new Error("ADD jQuery");var c=window.location,d=s.a.Dropdown.extend({getLocale:function(){return USER&&USER.locale||LOCALE},getLabel:function(e){return l.findWhere(r,{locale:e}).label},postInit:function(e){this.menu=new s.a.Menu({items:l.map(r,(function(e){return{label:e.label,data:{locale:e.locale}}}))}),this.menu.on("click",this.onClick),this.setLabel(""),this.$el.attr({"data-toggle":"tooltip","data-html":"true",title:"<b>Language</b>"})},onClick:function(e){var t=e.locale;if(a.a.agents.local){var n=i.a.auth.getId();i.a.store.Prefs.set("locale",t),n?o.a.api("/users","PUT",{id:n,locale:t},(function(){i.a.service.SyncMan._syncStore(i.a.store.UserStore,(function(){c.reload()}))})):c.reload()}else USER&&o.a.api("/users","PUT",{locale:t},(function(){c.reload()}));return!0},renderAction:function(){return A({class:"ripple vbar-tooltip",href:"#","data-toggle":"dropdown","data-html":"true"},I({class:"fa fa-language","aria-hidden":"true"}))}});t.a=d},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var i=n(24),a=n.n(i),s=n(2),r=n(9),o=n(21),l=n(77),c=n(78),d=n(0),h=n(76);function u(){var e=a()(["<li role='presentation'><a href=\"/admin/users\" role='menuitem'>","</a></li>"]);return u=function(){return e},e}function p(){var e=a()(["<li role='presentation'><a href=\"",'" target="_blank" role=\'menuitem\'>',"</a></li>"]);return p=function(){return e},e}function f(){var e=a()(["\n                  <li class='login' role='presentation'><a href="," role='menuitem'>","</a></li>\n                "]);return f=function(){return e},e}function m(){var e=a()(["\n                  <li class='logout' role='presentation'><a href="," @click="," role='menuitem'>"," (<em>","</em>)</a></li>\n                "]);return m=function(){return e},e}function v(){var e=a()(['\n            <a class=\'xripple\' href=\'/groups/\' data-toggle="tooltip" data-html="true" title="<b>Manage Teams</b>">\n              <i class="fa fa-users" aria-hidden="true"></i>\n            </a>']);return v=function(){return e},e}function g(){var e=a()(["\n    <div class='vbar'>\n        <a class='xripple xside-logo' target=\"_blank\" rel=\"noopener\" href='",'\' data-toggle="tooltip" data-html="true" title="<b>Distill.io</b>"><img height=38 alt=\'distill-logo\' src=\'',"/img/distill_logo_inverted.svg'/></a>\n        <a class='xripple' href='",'\' data-toggle="tooltip" data-html="true" title="<b>Watchlist</b>"><i class="fa fa-list" aria-hidden="true"></i></a>\n        <a class=\'xripple\' href=\'','\' data-toggle="tooltip" data-html="true" title="<b>Analytics</b>"><i class="fa fa-bar-chart-o" aria-hidden="true"></i></a>\n        <a class=\'xripple\' href=\'','\' data-toggle="tooltip" data-html="true" title="<b>Templates</b>"><i class="fa fa-file-text" aria-hidden="true"></i></a>\n        ',"\n        <i style='flex: 1'></i>\n        ","\n        ",'\n        <div class=\'dropdown\' data-toggle="tooltip" data-html="true" title="<b>Settings</b>">\n            <a class=\'xripple vbar-tooltip dropdown-toggle\' data-toggle="dropdown" href=\'#\'>\n              <i class="fa fa-cog" aria-hidden="true"></i>\n            </a>\n            <ul class=\'dropdown-menu\' role=\'menu\'>\n              ','\n              <li class=\'divider\'></li>\n              <li><a target="_blank" rel="noopener" href="https://distill.io/kb/">',"</a></li>\n              <li role='presentation'><a href=\"","\" role='menuitem'>","</a></li>\n              ","\n              ","\n            </ul>\n        </div>\n    </div>\n  "]);return g=function(){return e},e}window._;if(!window.jQuery)throw new Error("ADD jQuery");var b=(new c.a).render(),w=(new l.a.FeedbackAnchor).render();function _(e){r.a.agents.local&&(e.preventDefault(),s.a.auth.logout(),location.href=h.a.logout)}function y(){return Object(o.b)(g(),h.a.website,h.a.static,h.a.watchlist,h.a.availability,h.a.template,USER.account_id?Object(o.b)(v()):"",w.el,b.el,USER.name?Object(o.b)(m(),h.a.logout,_,Object(d.a)("a_sign_out"),USER.name):Object(o.b)(f(),h.a.login,Object(d.a)("a_signin")),Object(d.a)("l_support"),h.a.settings,Object(d.a)("l_settings"),USER.account_id?"":Object(o.b)(p(),h.a.billing,Object(d.a)("l_billing")),"admin"==USER.role?Object(o.b)(u(),Object(d.a)("l_admin")):"")}}])]);
//# sourceMappingURL=10.js.map