(window.webpackJsonp=window.webpackJsonp||[]).push([[14,25],{25:function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},50:function(e,t){e.exports=function(e){throw new Error('"'+e+'" is read-only')}},6:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},70:function(e,t,n){"use strict";n.r(t);var r=n(72),o=n(1),i=n(12),a=n(0),s=(n(15),n(3),n(4)),c=n(14),l=(n(23),n(25)),d=n.n(l);var u=function e(t,n,r,o){var i=this;if(i==window||null==i)return new e(t,n,r,o);if("object"==d()(t))if(t.nodeType){var a=t.getBoundingClientRect();o=a.bottom-a.top,r=a.right-a.left,n=a.top,t=a.left}else o=t.height,r=t.width,n=t.top,t=t.left;this.x=function(){return t},this.y=function(){return n},this.width=function(){return r},this.height=function(){return o},this.add=function(i){var a=i.x(),s=i.y(),c=i.width(),l=i.height(),d=Math.min(t,a),u=Math.min(n,s),p=Math.max(a+c,t+r)-d,h=Math.max(s+l,n+o)-u;return new e(d,u,p,h)},this.area=function(){return r*o},this.clipTo=function(i){var a=i.x(),s=i.y(),c=i.width(),l=i.height(),d=f(a,t,a+c),u=f(s,n,s+l),p=f(a,t+r,a+c)-d,h=f(s,n+o,s+l)-u;return new e(d,u,p,h);function f(e,t,n){return t>e?t<n?t:n:e}},this.clone=function(){return new e(t,n,r,o)},this.move=function(i,a){return new e(t+i,n+a,r,o)},this.subtract=function(a){if(0==(a=a.clipTo(i)).area())return[i];var s,c,l,d,u=[],p=a.x(),h=a.y(),f=a.width(),m=a.height();return s=t,c=n,(l=r)*(d=h-n)>0&&u.push(new e(s,c,l,d)),s=p+f,c=h,(l=t+r-(p+f))*(d=n+o-h)>0&&u.push(new e(s,c,l,d)),s=t,c=h+m,(l=p+f-t)*(d=n+o-h-m)>0&&u.push(new e(s,c,l,d)),s=t,c=h,(l=p-t)*(d=m)>0&&u.push(new e(s,c,l,d)),u},this.toString=function(){return"["+[t,n,r,o].join(", ")+"]"},this.toJSON=function(){return[t,n,r,o]}},p=window._;if(!p)throw new Error("ADD _");s.a.ActionProvider.extend({className:"xmodal xoverview",name:"overview",close:function(){this.remove(),this.trigger("close")},initialize:function(e){s.a.ActionProvider.prototype.initialize.call(this,e),this.markers=e.markers,$(window).on("resize",this.render)},render:function(){var e=this;return setTimeout((function(){e.$el.empty(),e.$el.append(DIV({class:"xbg"}),DIV({class:"panel centered"})),e.contentRect=null,p.each(e.markers,e.renderMarker),e.renderButton()}),0),this},renderButton:function(){var e=100;this.options.btnTop?e=this.options.btnTop:this.contentRect&&(e=this.contentRect.y()+this.contentRect.height()+40);var t=A({class:"btn btn-primary xlarge"},Object(a.a)("a_get_set_go"));this.$(".panel").append(t).css({top:e}),$(t).click(this.close)},renderMarker:function(e){var t,n,r,o,i,a=e.pos,s=e.mark?u(e.mark):p.result(e,"rect");if(s){this.$el.append(t=DIV({class:"popover "+e.pos},DIV({class:"arrow"}),e.title?DIV({class:"popover-title"},e.title):I(),n=DIV({class:"popover-content"})),r=DIV({class:"xoutline"})),$(n).append(e.content),$(r).css({left:s.x(),top:s.y(),width:s.width(),height:s.height()});var c=$(t).outerWidth(),l=$(t).outerHeight();"top"==a||"bottom"==a?(o=Math.max(s.x()+s.width()/2-c/2,0),i="top"==a?s.y()-l:s.y()+s.height()):(o=Math.max(0,"left"==a?s.x()-c:s.x()+s.width()),i=s.y()+s.height()/2-l/2),$(t).css({left:o,top:i});var d=new u(o,i,c,l);this.contentRect=this.contentRect?this.contentRect.add(d):d}}}),n(16);var h=window.jQuery;if(!h)throw new Error("ADD jQuery");var f=window._;if(!f)throw new Error("ADD _");if(!window.async)throw new Error("ADD async");if(!window.domo)throw new Error("ADD domo");if(!window.moment)throw new Error("ADD moment");if(!window.Backbone)throw new Error("ADD Backbone");var m=s.a.Base.extend({name:"SieveLocator",className:"row",onTypeChange:function(){this.model.set("type",this.selType.value),this.renderParams()},postInit:function(){this.model.on("change",this.updateDOM)},render:function(){var e,t=f.map(i.a.LocatorDescList,(function(e){return OPTION({value:e.type},Object(a.a)(e.label))}));return this.$el.append(DIV({class:"col-md-2"},this.selType=SELECT({style:"margin:0 5px 0 0;width: auto;"})),DIV({class:"col-md-10"},e=DIV())),this.$elParams=h(e),h(this.selType).append(t).change(this.onTypeChange),this.updateDOM(),this},renderParams:function(){var e=this.$elParams,t=this.selType.value,n=f.findWhere(i.a.LocatorDescList,{type:t});e.empty();var r=f.map(n.params,(function(e){return c.a.create(e.type,{param:e,parent:this,model:this.model}).render().el}),this);e.append(r)},updateDOM:function(){this.selType.value=this.model.get("type"),this.renderParams()}}),g=s.a.Collection.extend({name:"SieveLocators",addOne:function(e){h(this.help).hide();var t=new m({model:e,parent:this});return this.list.appendChild(t.render().el),t},removeOne:function(){g.__super__.removeOne.apply(this,arguments),0==this.collection.length&&h(this.help).show()},renderBase:function(){this.$el.append(this.help=DIV({class:"info"},Object(a.a)("l_none")),DIV(this.list=DIV()))}}),w=s.a.Base.extend({name:"SieveConfigFrame",render:function(){var e=this.model.attributes;return this.$el.append(H5(e.index>0?"Selections in child frame "+e.index:""),DIV({class:"row"},LABEL({class:"col-md-2",style:"text-align:right"},Object(a.a)("l_el_selected")),DIV({class:"col-md-10"},(this.includes=new g({model:e.includes,parent:this,op:"INCLUDE"}).render()).el)),DIV({class:"row"},LABEL({class:"col-md-2",style:"text-align:right"},Object(a.a)("l_el_deselected")),DIV({class:"col-md-10"},(this.excludes=new g({model:e.excludes,parent:this,op:"EXCLUDE"}).render()).el))),this}}),y=s.a.Collection.extend({name:"SieveConfigFrames",addOne:function(e){var t=new w({model:e,parent:this});return this.$list.append(t.render().el),t},renderBase:function(){return this.$list=this.$el,this}}),v=s.a.Base.extend({name:"SieveConfigPage",render:function(){return this.frames=new y({model:this.model.get("frames"),parent:this}),this.$el.append(this.frames.render().el),this}}),x=s.a.Collection.extend({name:"SieveConfigPages",addOne:function(e){var t=new v({model:e,parent:this});return this.$list.append(t.render().el),t},renderBase:function(){this.$list=this.$el}}),b=s.a.Base.extend({name:"SieveConfigHTML",className:"form form-horizontal",postInit:function(e){b.__super__.postInit.call(this,e),this.pages=this.model.get("selections"),this.viewPages=new x({model:this.pages,parent:this}),this.regexpEditor=c.a.create("regexp",{param:{help:"h_regexp_filter",must:!1,name:"regexp",type:"regexp"},parent:this,model:this.model})},render:function(){return this.$el.append(this.help=DIV({class:"alert-info small",style:"padding: 4px 12px;margin-bottom: 4px;"},Object(a.a)("m_vs_help")),DIV({class:"row"},LABEL({class:"col-md-2",style:"text-align:right;"},Object(a.a)("l_text_filter")),DIV({class:"col-md-10"},this.regexpEditor.render().el)),this.viewPages.render().el),this},hideHelp:function(){this.model.isEmpty()?h(this.help).show():h(this.help).remove()}}),O={SieveConfigHTML:b},D=n(74),E=window._;if(!E)throw new Error("ADD _");var _=window.jQuery;if(!_)throw new Error("ADD jQuery");var S=window.Backbone;if(!S)throw new Error("ADD Backbone");t.default=function(){Object(r.a)();var e,t,n,a=2,s=3,c=(e=1,function(){return e++}),l=[],d=!1,u={},p=new i.a.Sieve({},{parse:!0}),h=p.get("config"),f=h&&h.get("selections"),m=new i.a.SieveConfigHTML({selections:[],regexp:h?h.get("regexp"):void 0},{parse:!0}),g=(new O.SieveConfigHTML({el:_("#config")[0],model:m}).render(),!1),w=chrome.runtime.connect({name:"selector:{}"});function y(e,t){t&&"program"===t.source||v(e.collection.frame.get("index"),{path:"picker_select_call",data:{method:"setLocator",id:e.id,args:[E.pick(e.attributes,"expr","type")]}},(function(e){e&&console.error("Failed to setLocator:",e),C()}))}function v(e,t,n){!function(e,t,n){var r=c();u[r]=n,w.postMessage({_id:r,type:s,path:e,data:t})}("loader/port_request",{portSelector:e,data:t},n)}function x(e,t){g=!1,t||(t=function(e){e&&console.error("ERR:SELECTOR:portReset:",e)}),b(e,(function(){v(e,{path:"picker_reset"},t)}))}function b(e,t){t||(t=function(e){e&&console.error("ERR:SELECTOR:portSetMode:",e)}),v(e,{path:"picker_setMode",data:g?"SELECT":"NOOP"},(function(n){t(n),g&&0==e&&!n&&L("Selector is on. Click elements on page that you woulld like to monitor for changes.")}))}function k(e){w.postMessage({type:a,data:e})}function j(){_(".alert,textarea").show(),_(".alert,textarea").hide(),setTimeout((function(){_(".alert,textarea").show()}),100)}function L(e){v(0,{path:"showMsg",data:{msg:e}},(function(){}))}function C(){t&&(_("#preview").val("loading..."),async.mapSeries(t.get("frames"),(function(e,t){v(e.get("index"),{path:"getText",data:{includes:e.get("includes").toJSON(),excludes:e.get("excludes").toJSON()}},t)}),(function(e,t){if(e)console.error("error updating preview:",e),_("#preview").val(e.toString());else{var n=m.get("regexp"),r=t.join("");if(n&&n.expr){var o=r.match(new RegExp(n.expr,n.flags||""));r=o&&o.length>0?o.join(" "):""}_("#preview").val(r)}})))}function I(){var e=document.getElementById("a_expand_size"),t=document.getElementById("a_toggle_selection_mode").children[0];document.getElementsByTagName("body")[0];e.children[0].className=d?"fa fa-compress":"fa fa-expand",t.className=g?"fa fa-pause":"fa fa-play",window.parent.postMessage({type:"show",data:d?300:27},"*"),_("#content")[d?"removeClass":"addClass"]("hide"),setTimeout(j,500)}w.onMessage.addListener((function(e){var r,o,c=e.data;switch(e.type){case"load":p=new i.a.Sieve(c.model,{parse:!0}),h=p.get("config"),f=h&&h.get("selections"),h&&m.set("regexp",h.get("regexp")),g=!!c.state.selectorOn,d=!!c.state.expanded,I();break;case"loader:load":r=c.index,o=n&&n.get("frames").findWhere({index:r}),l.push(r),v(r,{path:"require",data:["picker","pickerui"]},(function(e){e?console.error("ERR:Loading picker for port ",r,e):(o&&function(e){var t=e.get("index"),n=e.get("includes").models,r=e.get("excludes").models;n.length>0&&async.each(n,(function(e,n){v(t,{path:"picker_select_new",data:{locator:e.toJSON(),op:"INCLUDE"}},n)})),r.length>0&&async.each(r,(function(e,n){v(t,{path:"picker_select_new",data:{locator:e.toJSON(),op:"EXCLUDE"}},n)}))}(o),b(r))}));break;case"loader:reset":!function(e){var r=e.uri==p.get("uri"),o=m.get("selections");t=r&&o.at(0)||new i.a.Page(e,{parse:!0}),l.splice(0),o.reset([t]),n=f&&r&&f.at(0)}(c);break;case"loader:port:window:select:close":!function(e){t.removeLocator(e.index,e.data.id),C()}(c);break;case"loader:port:window:select:display":!function(e){var n=t.getLocator(e.index,e.data.id),r=E.extend({id:e.data.id},e.data.locator);E.isEqual(r,n.attributes)||(n.set(r,{source:"program"}),C())}(c);break;case"loader:port:window:select:new":!function(e){var n=E.extend({id:e.data.id},e.data.locator),r=t.addLocator({index:e.index,title:e.title,uri:e.uri},e.data.op,n);S.listenTo(r,"change",y)}(c);break;case a:console.warn("Unhandled event: ",e);break;case s:console.error("Unhandled request: ",e),w.postMessage({_id:e._id,type:4,err:{msg:"Request not handled"}});break;case 4:var x=e._id,O=u[x];O?(delete u[x],O(e.err,e.data)):console.error("Unhandled response: ",e);break;default:console.warn("Unhandled msg type: ",e)}})),w.onDisconnect.addListener((function(){})),Object(D.a)({url:service.CFG.URL.ER,app:service.CFG.CLIENT.NAME,version:service.CFG.VERSION,id:USER.id}),I(),m.on("change:regexp",C),_("[action]").click((function(){var e=_(this).attr("action"),t=App[e];t?t():console.error("action not found",e,App)})),window.App={close:function(){async.each(l,x,(function(){k({type:"close"})}))},save:function(){if(m.isEmpty())L("Please select elements to monitor before saving selections.");else{p.set({name:t.get("title"),uri:t.get("uri"),config:m,content_type:o.a.TYPE_HTML});var e=p.toJSON();async.each(l,x,(function(){k({type:"save",data:e})}))}},toggleExpanded:function(){k({type:"uistate",data:{expanded:d=!d}}),I()},toggleSelector:function(){g=!g,async.each(l,b),I()}}}},72:function(e,t,n){"use strict";var r=n(0),o=window.jQuery;if(!o)throw new Error("ADD jQuery");t.a=function(){o("[data-placeholder]").each((function(){this.placeholder=Object(r.a)(this.getAttribute("data-placeholder"))})),o("[data-text]").each((function(){this.textContent=Object(r.a)(this.getAttribute("data-text"))})),o("[data-title]").each((function(){this.title=Object(r.a)(this.getAttribute("data-title"))}))}},73:function(e,t,n){var r=n(75);e.exports=function(e,t){if(null==e)return{};var n,o,i=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}},74:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r,o=n(6),i=n.n(o),a=n(25),s=n.n(a),c=n(73),l=n.n(c);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e){var t=e.url,n=l()(e,["url"]);r=t,window.addEventListener("unhandledrejection",(function(e){var t=e.reason;f("object"==s()(t)?u({},t,{},n):u({file_url:"",message:JSON.stringify(t)},n))})),window.onerror=function(e,t,r,o,i){e.toLowerCase().indexOf("script error")>-1||f(u({message:e,file_url:t,app_url:document.URL,line:r,column:o,stack:i.stack},n));return!1}}var h=function(){var e=new WeakSet;return function(t,n){if("object"===s()(n)&&null!==n){if(e.has(n))return;e.add(n)}return n}};function f(e){fetch(r,{method:"POST",mode:"cors",body:JSON.stringify(e,h())}).then((function(e){})).catch((function(e){console.error("Request failure: ",e)}))}},75:function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}}}]);
//# sourceMappingURL=14.js.map